<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">
    <meta name="theme-color" content="#0B65C6">
    <meta name="description" content="Trust Wallet - Crypto Wallet">
    
    <title>Trust Wallet</title>
    
    <!-- Preload fonts for faster rendering -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- For PWA support -->
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Initial loading screen -->
    <div id="initial-loader" class="initial-loader" aria-hidden="true">
        <div class="spinner"></div>
    </div>

    <!-- Status bar -->
    <div class="status-bar" role="banner" aria-label="Status Bar">
        <div class="status-left">
            <time class="status-time" aria-label="Current time">9:41</time>
        </div>
        
        <div class="status-right">
            <span class="status-signal" aria-label="Network signal">
                <svg width="17" height="12" viewBox="0 0 17 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M1 9H3V12H1V9Z" fill="currentColor"/>
                    <path d="M5 7H7V12H5V7Z" fill="currentColor"/>
                    <path d="M9 4H11V12H9V4Z" fill="currentColor"/>
                    <path d="M13 1H15V12H13V1Z" fill="currentColor"/>
                </svg>
            </span>
            <span class="status-wifi" aria-label="WiFi connected">
                <svg width="15" height="11" viewBox="0 0 15 11" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M7.5 2.37305C9.34516 2.37305 11.0645 3.04633 12.3548 4.26617L13.8136 2.80743C12.1415 1.13533 9.91936 0.123047 7.5 0.123047C5.08065 0.123047 2.85847 1.13533 1.18639 2.80743L2.64519 4.26617C3.93551 3.04633 5.65484 2.37305 7.5 2.37305Z" fill="currentColor"/>
                    <path d="M7.5 6.87305C8.24675 6.87305 8.95582 7.14661 9.5 7.6955L11 6.20001C10.0164 5.24353 8.7636 4.62305 7.5 4.62305C6.2364 4.62305 5.00484 5.24352 4 6.20001L5.5 7.6955C6.04418 7.14661 6.75325 6.87305 7.5 6.87305Z" fill="currentColor"/>
                    <circle cx="7.5" cy="9.37305" r="1.25" fill="currentColor"/>
                </svg>
            </span>
            <span class="status-battery" aria-label="Battery status">
                <svg width="25" height="12" viewBox="0 0 25 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect opacity="0.35" x="0.5" y="0.833008" width="21" height="10.333" rx="2.16667" stroke="currentColor"/>
                    <path opacity="0.4" d="M23 4V8C23.8079 7.66122 24.3333 6.87313 24.3333 6C24.3333 5.12687 23.8079 4.33878 23 4Z" fill="currentColor"/>
                    <rect x="2" y="2.33301" width="18" height="7.33333" rx="1.33333" fill="currentColor"/>
                </svg>
            </span>
        </div>
    </div>

    <!-- Splash screen -->
    <div id="splash-screen" class="splash-screen" aria-label="Trust Wallet Loading" role="dialog" aria-modal="true">
        <img id="splash-logo" class="splash-logo" src="assets/logo.svg" alt="Trust Wallet Logo">
    </div>

    <!-- Passcode screen -->
    <div id="passcode-screen" class="passcode-screen" aria-label="Passcode Entry" role="dialog" aria-modal="true" aria-hidden="true">
        <img class="passcode-logo" src="assets/logo.svg" alt="Trust Wallet Logo">
        <h1 class="passcode-title">Enter Passcode</h1>
        <div class="passcode-dots" aria-live="polite">
            <div class="passcode-dot" aria-hidden="true"></div>
            <div class="passcode-dot" aria-hidden="true"></div>
            <div class="passcode-dot" aria-hidden="true"></div>
            <div class="passcode-dot" aria-hidden="true"></div>
            <div class="passcode-dot" aria-hidden="true"></div>
            <div class="passcode-dot" aria-hidden="true"></div>
        </div>
        <div class="passcode-keypad" role="group" aria-label="Passcode Keypad">
            <button class="passcode-key" aria-label="1">1</button>
            <button class="passcode-key" aria-label="2">2</button>
            <button class="passcode-key" aria-label="3">3</button>
            <button class="passcode-key" aria-label="4">4</button>
            <button class="passcode-key" aria-label="5">5</button>
            <button class="passcode-key" aria-label="6">6</button>
            <button class="passcode-key" aria-label="7">7</button>
            <button class="passcode-key" aria-label="8">8</button>
            <button class="passcode-key" aria-label="9">9</button>
            <button class="passcode-key biometric" aria-label="Use Biometric Authentication">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 12C14.76 12 17 9.76 17 7C17 4.24 14.76 2 12 2C9.24 2 7 4.24 7 7C7 9.76 9.24 12 12 12Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M20.59 22C20.59 18.13 16.74 15 12 15C7.26 15 3.41 18.13 3.41 22" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
            <button class="passcode-key" aria-label="0">0</button>
            <button class="passcode-key backspace" aria-label="Backspace">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M18.9 8.36L15.54 11.73L18.9 15.09" stroke="currentColor" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M8.91 8.36H15.54V15.09" stroke="currentColor" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M8.91 15.09V8.36" stroke="currentColor" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
        </div>
        <button class="passcode-cancel" aria-label="Cancel">Cancel</button>
    </div>

    <!-- Main wallet screen -->
    <main id="wallet-screen" class="wallet-screen" aria-hidden="true">
        <div class="wallet-header">
            <div class="wallet-top-bar">
                <div class="wallet-title" tabindex="0" role="button" aria-haspopup="true" aria-expanded="false">
                    Main Wallet
                    <svg class="wallet-dropdown-arrow" width="12" height="6" viewBox="0 0 12 6" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M1 0.5L6 5.5L11 0.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <div class="accounts-dropdown" id="accounts-dropdown" role="menu">
                        <div class="account-option active" data-account="main" role="menuitem" tabindex="-1">
                            <div class="account-dot"></div>
                            Main Wallet
                        </div>
                        <div class="account-option" data-account="second" role="menuitem" tabindex="-1">
                            <div class="account-dot"></div>
                            Account 2
                        </div>
                    </div>
                </div>
                <button class="wallet-settings" aria-label="Settings">
                    <div class="notification-badge" aria-label="1 notification">1</div>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 15C13.6569 15 15 13.6569 15 12C15 10.3431 13.6569 9 12 9C10.3431 9 9 10.3431 9 12C9 13.6569 10.3431 15 12 15Z" stroke="currentColor" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M2 12.88V11.12C2 10.08 2.85 9.22 3.9 9.22C5.71 9.22 6.45 7.94 5.54 6.37C5.02 5.47 5.33 4.29 6.24 3.78L7.97 2.79C8.76 2.32 9.78 2.6 10.25 3.39L10.36 3.58C11.26 5.15 12.74 5.15 13.65 3.58L13.76 3.39C14.23 2.6 15.25 2.32 16.04 2.79L17.77 3.78C18.68 4.29 18.99 5.47 18.47 6.37C17.56 7.94 18.3 9.22 20.11 9.22C21.15 9.22 22.01 10.07 22.01 11.12V12.88C22.01 13.92 21.16 14.78 20.11 14.78C18.3 14.78 17.56 16.06 18.47 17.63C18.99 18.54 18.68 19.7 17.77 20.22L16.04 21.21C15.25 21.68 14.23 21.4 13.76 20.61L13.65 20.42C12.75 18.85 11.27 18.85 10.36 20.42L10.25 20.61C9.78 21.4 8.76 21.68 7.97 21.21L6.24 20.22C5.33 19.7 5.02 18.53 5.54 17.63C6.45 16.06 5.71 14.78 3.9 14.78C2.85 14.78 2 13.92 2 12.88Z" stroke="currentColor" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
                <button class="wallet-scan" aria-label="Scan QR Code">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M2 9V6.5C2 4.01 4.01 2 6.5 2H9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M15 2H17.5C19.99 2 22 4.01 22 6.5V9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M22 16V17.5C22 19.99 19.99 22 17.5 22H16" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M9 22H6.5C4.01 22 2 19.99 2 17.5V15" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M10.5 7V9C10.5 10 10 10.5 9 10.5H7C6 10.5 5.5 10 5.5 9V7C5.5 6 6 5.5 7 5.5H9C10 5.5 10.5 6 10.5 7Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M18.5 7V9C18.5 10 18 10.5 17 10.5H15C14 10.5 13.5 10 13.5 9V7C13.5 6 14 5.5 15 5.5H17C18 5.5 18.5 6 18.5 7Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M10.5 15V17C10.5 18 10 18.5 9 18.5H7C6 18.5 5.5 18 5.5 17V15C5.5 14 6 13.5 7 13.5H9C10 13.5 10.5 14 10.5 15Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M18.5 15V17C18.5 18 18 18.5 17 18.5H15C14 18.5 13.5 18 13.5 17V15C13.5 14 14 13.5 15 13.5H17C18 13.5 18.5 14 18.5 15Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>
            <div class="wallet-balance-area">
                <div class="wallet-total-label">Total Balance</div>
                <div class="wallet-total-balance" aria-live="polite">$100,000,000.00</div>
                <div class="wallet-balance-change">
                    <span class="balance-up">+3.45%</span> today
                </div>
            </div>
            <div class="wallet-actions">
                <button class="wallet-action-button" aria-label="Send Cryptocurrency">
                    <div class="action-icon">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M7.92 16.25H12.08C15.83 16.25 17.08 15 17.08 11.25V7.08C17.08 3.33 15.83 2.08 12.08 2.08H7.92C4.17 2.08 2.92 3.33 2.92 7.08V11.25C2.92 15 4.17 16.25 7.92 16.25Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M2.92 10.75L6.42 10.75C7.12 10.75 7.88 11.29 8.09 11.96L8.67 13.7C9 14.77 9.63 14.77 9.96 13.7L11.12 10.21C11.38 9.36 12 9.32 12.36 10.12L12.81 11.22C13.04 11.77 13.76 12.26 14.36 12.26L17.09 12.26" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <div class="action-label">Send</div>
                </button>
                <button class="wallet-action-button" aria-label="Receive Cryptocurrency">
                    <div class="action-icon">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M7.92 16.25H12.08C15.83 16.25 17.08 15 17.08 11.25V7.08C17.08 3.33 15.83 2.08 12.08 2.08H7.92C4.17 2.08 2.92 3.33 2.92 7.08V11.25C2.92 15 4.17 16.25 7.92 16.25Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M2.92 7.58L6.42 7.58C7.12 7.58 7.88 7.04 8.09 6.37L8.67 4.63C9 3.56 9.63 3.56 9.96 4.63L11.12 8.12C11.38 8.97 12 9.01 12.36 8.21L12.81 7.11C13.04 6.56 13.76 6.07 14.36 6.07L17.09 6.07" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <div class="action-label">Receive</div>
                </button>
                <button class="wallet-action-button" aria-label="Swap Cryptocurrency">
                    <div class="action-icon">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M14.75 15.4167L11.25 18.9167L7.75 15.4167" stroke="currentColor" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M11.25 10.8333V18.75" stroke="currentColor" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M17.9915 12.9167C17.0581 17.0834 12.5831 19.7334 8.41643 18.8C5.94143 18.25 3.94143 16.9167 2.69143 15C1.85809 13.75 1.3331 12.2834 1.24977 10.75" stroke="currentColor" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M5.24976 4.58337L8.74976 1.08337L12.2498 4.58337" stroke="currentColor" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M8.75 9.16667V1.25" stroke="currentColor" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M2.0083 7.08333C2.94163 2.91666 7.41663 0.266663 11.5833 1.19999C14.0583 1.74999 16.0583 3.08333 17.3083 5.00001C18.1416 6.25001 18.6666 7.71667 18.7499 9.24999" stroke="currentColor" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <div class="action-label">Swap</div>
                </button>
            </div>
        </div>
        
        <div class="wallet-tokens-container">
            <div class="wallet-section-header">
                <div class="section-title">Tokens</div>
                <button class="network-selector" aria-label="Select Blockchain Network" aria-haspopup="true">
                    <img class="network-icon" src="assets/bnb-chain.png" alt="BNB Chain">
                    <span class="network-name">BNB Smart Chain</span>
                    <img class="network-arrow" src="assets/arrow-down.svg" alt="">
                </button>
            </div>
            
            <div class="wallet-token-list" role="list">
                <!-- USDT Token -->
                <div class="token-item touch-effect" id="usdt-token" role="listitem" tabindex="0">
                    <img class="token-icon" src="assets/usdt.png" alt="USDT">
                    <div class="token-details">
                        <div class="token-name-row">
                            <span class="token-name">Tether USD</span>
                            <span class="token-symbol">USDT</span>
                        </div>
                        <div class="token-balance">100,000,000 USDT</div>
                    </div>
                    <div class="token-value">
                        <div class="token-fiat-value">$100,000,000.00</div>
                        <div class="token-price-change">+0.03%</div>
                    </div>
                </div>
                
                <!-- BNB Token -->
                <div class="token-item touch-effect" role="listitem" tabindex="0">
                    <img class="token-icon" src="assets/bnb.png" alt="BNB">
                    <div class="token-details">
                        <div class="token-name-row">
                            <span class="token-name">BNB</span>
                            <span class="token-symbol">BNB</span>
                        </div>
                        <div class="token-balance">2.456 BNB</div>
                    </div>
                    <div class="token-value">
                        <div class="token-fiat-value">$1,234.56</div>
                        <div class="token-price-change">+2.75%</div>
                    </div>
                </div>
                
                <!-- Bitcoin Token -->
                <div class="token-item touch-effect" role="listitem" tabindex="0">
                    <img class="token-icon" src="assets/btc.png" alt="Bitcoin">
                    <div class="token-details">
                        <div class="token-name-row">
                            <span class="token-name">Bitcoin</span>
                            <span class="token-symbol">BTC</span>
                        </div>
                        <div class="token-balance">0.025 BTC</div>
                    </div>
                    <div class="token-value">
                        <div class="token-fiat-value">$1,625.00</div>
                        <div class="token-price-change token-price-down">-1.25%</div>
                    </div>
                </div>
                
                <!-- Ethereum Token -->
                <div class="token-item touch-effect" role="listitem" tabindex="0">
                    <img class="token-icon" src="assets/eth.png" alt="Ethereum">
                    <div class="token-details">
                        <div class="token-name-row">
                            <span class="token-name">Ethereum</span>
                            <span class="token-symbol">ETH</span>
                        </div>
                        <div class="token-balance">0.5 ETH</div>
                    </div>
                    <div class="token-value">
                        <div class="token-fiat-value">$1,375.00</div>
                        <div class="token-price-change">+3.12%</div>
                    </div>
                </div>
                <!-- XRP Token -->
                <div class="token-item touch-effect" role="listitem" tabindex="0">
                    <img class="token-icon" src="assets/xrp.png" alt="XRP">
                    <div class="token-details">
                        <div class="token-name-row">
                            <span class="token-name">XRP</span>
                            <span class="token-symbol">XRP</span>
                        </div>
                        <div class="token-balance">500,000,000 XRP</div>
                    </div>
                    <div class="token-value">
                        <div class="token-fiat-value">$300,000,000.00</div>
                        <div class="token-price-change">+2.45%</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Tab Bar -->
        <nav class="tab-bar" role="navigation">
            <button class="tab-item active" aria-label="Wallet" aria-current="page">
                <img class="tab-icon" src="assets/wallet-icon.svg" alt="">
                <span class="tab-label">Wallet</span>
            </button>
            <button class="tab-item" aria-label="DApp Browser">
                <img class="tab-icon" src="assets/dapp-icon.svg" alt="">
                <span class="tab-label">DApp</span>
            </button>
            <button class="tab-item" aria-label="Swap">
                <img class="tab-icon" src="assets/swap-icon.svg" alt="">
                <span class="tab-label">Swap</span>
            </button>
            <button class="tab-item" aria-label="Settings">
                <img class="tab-icon" src="assets/settings-icon.svg" alt="">
                <span class="tab-label">Settings</span>
            </button>
        </nav>
    </main>

    <!-- Token detail screen -->
    <div id="token-detail-screen" class="token-detail-screen" aria-hidden="true" role="dialog" aria-modal="true">
        <header class="token-header">
            <button class="back-button" aria-label="Back to Wallet">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
            <div class="token-header-details">
                <img class="token-header-icon" src="assets/usdt.png" alt="USDT">
                <h1 class="token-header-name">USDT</h1>
            </div>
            <button class="more-options" aria-label="More Options">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 13C12.5523 13 13 12.5523 13 12C13 11.4477 12.5523 11 12 11C11.4477 11 11 11.4477 11 12C11 12.5523 11.4477 13 12 13Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M19 13C19.5523 13 20 12.5523 20 12C20 11.4477 19.5523 11 19 11C18.4477 11 18 11.4477 18 12C18 12.5523 18.4477 13 19 13Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M5 13C5.55228 13 6 12.5523 6 12C6 11.4477 5.55228 11 5 11C4.44772 11 4 11.4477 4 12C4 12.5523 4.44772 13 5 13Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
        </header>

        <div class="token-chart-area">
            <div class="token-price" aria-live="polite">$1.00</div>
            <div class="token-24h-change" aria-live="polite">+0.03% (24h)</div>
            <div class="token-chart">
                <div class="chart-placeholder" aria-label="Price chart for USDT"></div>
            </div>
            <div class="chart-tabs" role="tablist">
                <button class="chart-tab" role="tab" aria-selected="false">1H</button>
                <button class="chart-tab" role="tab" aria-selected="false">1D</button>
                <button class="chart-tab active" role="tab" aria-selected="true">1W</button>
                <button class="chart-tab" role="tab" aria-selected="false">1M</button>
                <button class="chart-tab" role="tab" aria-selected="false">1Y</button>
                <button class="chart-tab" role="tab" aria-selected="false">ALL</button>
            </div>
        </div>

        <div class="token-info-area">
            <div class="token-holdings">
                <div>
                    <div class="holdings-amount" aria-live="polite">100,000,000 USDT</div>
                    <div class="holdings-label">Your Balance</div>
                </div>
                <div>
                    <div class="holdings-value" aria-live="polite">$100,000,000.00</div>
                    <div class="holdings-label">Value in USD</div>
                </div>
            </div>
            <div class="token-buttons">
                <button class="token-button button-send" aria-label="Send USDT">Send</button>
                <button class="token-button button-receive" aria-label="Receive USDT">Receive</button>
            </div>
        </div>

        <div class="token-history-area">
            <h2 class="history-header">Transaction History</h2>
            <div class="transaction-list" role="list" aria-label="Transaction History">
                <!-- Transaction items will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Transfer modal -->
    <div id="transfer-modal" class="transfer-modal" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="transfer-title">
        <div class="transfer-modal-content">
            <div class="transfer-header">
                <h2 id="transfer-title" class="transfer-title">Send USDT</h2>
                <p class="transfer-description">Enter recipient address and amount</p>
            </div>
            <form class="transfer-form" id="transfer-form">
                <div class="form-group">
                    <label for="wallet-address" class="form-label">Recipient Address</label>
                    <div class="wallet-selector">
                        <input type="text" id="wallet-address" class="form-control" placeholder="Enter wallet address" required aria-required="true">
                        <div id="wallet-dropdown" class="wallet-dropdown" role="listbox" aria-label="Select Recipient">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="transfer-amount" class="form-label">Amount</label>
                    <input type="number" id="transfer-amount" class="form-control" placeholder="0.00" required aria-required="true" min="0" step="any">
                </div>
            </form>
            <div class="transfer-buttons">
                <button id="cancel-transfer" class="transfer-button button-cancel" aria-label="Cancel Transfer">Cancel</button>
                <button id="confirm-transfer" class="transfer-button button-confirm" aria-label="Confirm Transfer">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Transaction receipt modal -->
    <div class="receipt-modal" id="receipt-modal" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="receipt-title">
        <div class="receipt-modal-content">
            <div class="receipt-header">
                <div class="receipt-status-icon" aria-hidden="true">
                    <svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="32" cy="32" r="32" fill="#00C087"/>
                        <path d="M27 35L22 30L20 32L27 39L44 22L42 20L27 35Z" fill="white"/>
                    </svg>
                </div>
                <h2 id="receipt-title" class="receipt-title">Sent Successfully</h2>
                <p class="receipt-subtitle">Your transaction has been processed</p>
            </div>
            <div class="receipt-details">
                <div class="receipt-amount-box" aria-live="polite">
                    <div id="receipt-amount" class="receipt-token-amount">100,000 USDT</div>
                    <div id="receipt-fiat-amount" class="receipt-fiat-amount">$100,000.00</div>
                </div>
                
                <div class="receipt-data-section">
                    <dl>
                        <div class="receipt-row">
                            <dt class="receipt-label">Date</dt>
                            <dd id="receipt-date" class="receipt-value">Mar 21, 2025 â€¢ 14:32</dd>
                        </div>
                        <div class="receipt-row">
                            <dt class="receipt-label">From</dt>
                            <dd id="receipt-from" class="receipt-value">Main Wallet (0x34A2...5F76)</dd>
                        </div>
                        <div class="receipt-row">
                            <dt class="receipt-label">To</dt>
                            <dd id="receipt-to" class="receipt-value">Account 2</dd>
                        </div>
                        <div class="receipt-divider" aria-hidden="true"></div>
                        <div class="receipt-row">
                            <dt class="receipt-label">Network</dt>
                            <dd class="receipt-value network-value">
                                <img src="assets/bnb-chain.png" alt="BNB Chain" class="network-icon">
                                <span>BSC Smart Chain</span>
                            </dd>
                        </div>
                        <div class="receipt-row">
                            <dt class="receipt-label">Network Fee</dt>
                            <dd id="receipt-fee" class="receipt-value">0.000453 BNB ($0.22)</dd>
                        </div>
                        <div class="receipt-row">
                            <dt class="receipt-label">Transaction ID</dt>
                            <dd class="receipt-value transaction-id">
                                <span id="receipt-hash-short">0x3f5e...9a7d</span>
                                <button id="copy-hash-btn" class="copy-button" aria-label="Copy Transaction ID">
                                    <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M10.5 0.5H1.5C0.675 0.5 0 1.175 0 2V11H1.5V2H10.5V0.5ZM12.75 3.5H4.5C3.675 3.5 3 4.175 3 5V14C3 14.825 3.675 15.5 4.5 15.5H12.75C13.575 15.5 14.25 14.825 14.25 14V5C14.25 4.175 13.575 3.5 12.75 3.5ZM12.75 14H4.5V5H12.75V14Z" fill="currentColor"/>
                                    </svg>
                                </button>
                            </dd>
                        </div>
                    </dl>
                </div>
            </div>
            <div class="receipt-buttons">
                <button class="receipt-button button-view-explorer" aria-label="View Transaction on Blockchain Explorer">
                    View on Explorer
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 8.66667V12.6667C12 13.0203 11.8595 13.3594 11.6095 13.6095C11.3594 13.8595 11.0203 14 10.6667 14H3.33333C2.97971 14 2.64057 13.8595 2.39052 13.6095C2.14048 13.3594 2 13.0203 2 12.6667V5.33333C2 4.97971 2.14048 4.64057 2.39052 4.39052C2.64057 4.14048 2.97971 4 3.33333 4H7.33333" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M10 2H14V6" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M6.66663 9.33333L13.9999 2" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
                <button class="receipt-button button-close" aria-label="Close Receipt">Close</button>
            </div>
        </div>
    </div>

    <!-- Loading overlay -->
    <div class="loading-overlay" aria-hidden="true" aria-live="assertive">
        <div class="loading-spinner" role="status" aria-label="Loading"></div>
    </div>

    <!-- Toast message container -->
    <div id="toast-container" class="toast-container" aria-live="polite"></div>

    <!-- Session timeout dialog -->
    <div id="timeout-dialog" class="timeout-dialog" aria-hidden="true" role="alertdialog" aria-labelledby="timeout-title">
        <div class="timeout-dialog-content">
            <h2 id="timeout-title" class="timeout-title">Session Timeout</h2>
            <p class="timeout-message">Your session is about to expire due to inactivity.</p>
            <div class="timeout-actions">
                <button id="timeout-stay" class="timeout-button button-primary">Stay Logged In</button>
                <button id="timeout-logout" class="timeout-button button-secondary">Logout</button>
            </div>
        </div>
    </div>
    
   <!-- Combined JavaScript -->
<script>
// Put all your JavaScript code here
// Config object
const Config = {
    // Application settings
    app: {
        name: 'Trust Wallet',
        version: '1.0.0',
        environment: 'development',
        sessionTimeoutMinutes: 5,
        debugMode: false
    },
    // Rest of your Config code...
};

// Storage service
const Storage = {
    // All your Storage code...
};

// Utils object
const Utils = {
    // All your Utils code...
};

// AppState 
class AppState {
    // All your AppState code...
}
const appState = new AppState();

// WalletService
const WalletService = {
    // All your WalletService code...
};

// UI 
const UI = {
    // All your UI code...
};

// App 
const App = {
    // All your App code...
};

// Initialize on load
document.addEventListener('DOMContentLoaded', () => {
    App.init();
});
</script>
</body>
</html>

/* CSS Variables for theming and consistency */
:root {
    /* Color palette */
    --color-primary: #0B65C6;
    --color-primary-light: #1172E2;
    --color-primary-dark: #0957AE;
    --color-secondary: #7F8489;
    --color-success: #2FD27A;
    --color-error: #EB5757;
    --color-warning: #F2994A;
    
    /* Background colors */
    --bg-main: #F7F8FA;
    --bg-card: #FFFFFF;
    --bg-input: #FFFFFF;
    --bg-button-secondary: #E9EAEC;
    
    /* Text colors */
    --text-primary: #1A2024;
    --text-secondary: #7F8489;
    --text-tertiary: #A4A9B0;
    --text-on-primary: #FFFFFF;
    
    /* Border colors */
    --border-light: #E9EAEC;
    --border-medium: #D0D3D6;
    
    /* Shadows */
    --shadow-sm: 0 2px 5px rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 10px rgba(0, 0, 0, 0.1);
    --shadow-lg: 0 8px 30px rgba(0, 0, 0, 0.12);
    
    /* Spacing */
    --space-xs: 4px;
    --space-sm: 8px;
    --space-md: 16px;
    --space-lg: 24px;
    --space-xl: 32px;
    
    /* Border radius */
    --radius-sm: 8px;
    --radius-md: 12px;
    --radius-lg: 16px;
    --radius-full: 50%;
    
    /* Font sizes */
    --font-xs: 11px;
    --font-sm: 13px;
    --font-md: 14px;
    --font-lg: 16px;
    --font-xl: 18px;
    --font-2xl: 20px;
    --font-3xl: 24px;
    --font-4xl: 28px;
    --font-5xl: 34px;
    
    /* Font weights */
    --weight-regular: 400;
    --weight-medium: 500;
    --weight-semibold: 600;
    --weight-bold: 700;
    
    /* Transitions */
    --transition-fast: 0.2s ease;
    --transition-normal: 0.3s ease;
    --transition-slow: 0.5s ease;
    
    /* Z-indices */
    --z-normal: 1;
    --z-dropdown: 10;
    --z-sticky: 100;
    --z-fixed: 200;
    --z-modal: 300;
    --z-popover: 400;
    --z-toast: 500;
    --z-tooltip: 600;
    
    /* Layout */
    --tab-bar-height: 64px;
    --status-bar-height: 24px;
    --header-height: 120px;
    
    /* Animation speeds */
    --animation-slow: 1s;
    --animation-normal: 0.5s;
    --animation-fast: 0.3s;
}

/* Dark mode variables */
@media (prefers-color-scheme: dark) {
    :root {
        --color-primary: #1172E2;
        --color-primary-light: #3D8DDF;
        --color-primary-dark: #0957AE;
        
        --bg-main: #121418;
        --bg-card: #1E2227;
        --bg-input: #2A2E35;
        --bg-button-secondary: #2A2E35;
        
        --text-primary: #FFFFFF;
        --text-secondary: #A4A9B0;
        --text-tertiary: #7F8489;
        
        --border-light: #2A2E35;
        --border-medium: #3A3E46;
        
        --shadow-sm: 0 2px 5px rgba(0, 0, 0, 0.2);
        --shadow-md: 0 4px 10px rgba(0, 0, 0, 0.3);
        --shadow-lg: 0 8px 30px rgba(0, 0, 0, 0.4);
    }
}

/* Reset & Base Styles */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
}

html {
    font-size: 16px;
    height: 100%;
    width: 100%;
}

body {
    background-color: var(--bg-main);
    color: var(--text-primary);
    font-size: var(--font-md);
    line-height: 1.5;
    height: 100%;
    width: 100%;
    overflow: hidden;
    position: relative;
    font-feature-settings: 'liga' 0;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

button, input, select, textarea {
    font: inherit;
    color: inherit;
}

button {
    background: none;
    border: none;
    cursor: pointer;
    user-select: none;
}

button:focus, input:focus, a:focus {
    outline: 2px solid var(--color-primary);
    outline-offset: 2px;
}

button:focus:not(:focus-visible), input:focus:not(:focus-visible), a:focus:not(:focus-visible) {
    outline: none;
}

img, svg {
    display: block;
    max-width: 100%;
}

a {
    color: inherit;
    text-decoration: none;
}

/* Accessibility utilities */
.sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border-width: 0;
}

/* Loader Styles */
.initial-loader {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: var(--bg-main);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: var(--z-modal);
}

.loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(4px);
    -webkit-backdrop-filter: blur(4px);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: var(--z-modal);
}

.loading-spinner {
    width: 40px;
    height: 40px;
    border: 3px solid rgba(255, 255, 255, 0.2);
    border-top: 3px solid var(--color-primary);
    border-radius: var(--radius-full);
    animation: spin var(--animation-normal) linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Status Bar */
.status-bar {
    height: var(--status-bar-height);
    width: 100%;
    background-color: var(--color-primary);
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 var(--space-md);
    color: var(--text-on-primary);
    font-size: var(--font-xs);
    position: fixed;
    top: 0;
    left: 0;
    z-index: var(--z-sticky);
}

.status-left,
.status-right {
    display: flex;
    align-items: center;
}

.status-time {
    font-weight: var(--weight-semibold);
}

.status-battery, 
.status-wifi, 
.status-signal {
    margin-left: var(--space-sm);
}

/* Splash Screen */
.splash-screen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: var(--color-primary);
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    z-index: var(--z-modal);
    transition: opacity var(--transition-normal);
}

.splash-logo {
    width: 80px;
    height: 80px;
    margin-bottom: var(--space-xl);
    animation: pulse var(--animation-slow) infinite;
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

/* Passcode Screen */
.passcode-screen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: var(--color-primary);
    display: none;
    flex-direction: column;
    justify-content: flex-start;
    align-items: center;
    z-index: var(--z-modal);
    padding-top: 80px;
}

.passcode-logo {
    width: 60px;
    height: 60px;
    margin-bottom: var(--space-xl);
}

.passcode-title {
    color: var(--text-on-primary);
    font-size: var(--font-xl);
    font-weight: var(--weight-semibold);
    margin-bottom: var(--space-xl);
}

.passcode-dots {
    display: flex;
    justify-content: center;
    margin-bottom: 40px;
}

.passcode-dot {
    width: 14px;
    height: 14px;
    border: 2px solid var(--text-on-primary);
    border-radius: var(--radius-full);
    margin: 0 var(--space-sm);
}

.passcode-dot.filled {
    background-color: var(--text-on-primary);
}

.passcode-keypad {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    grid-gap: var(--space-xl);
    width: 80%;
    max-width: 300px;
}

.passcode-key {
    display: flex;
    justify-content: center;
    align-items: center;
    color: var(--text-on-primary);
    font-size: 28px;
    font-weight: var(--weight-regular);
    height: 60px;
    width: 60px;
    border-radius: var(--radius-full);
    background-color: rgba(255, 255, 255, 0.15);
    user-select: none;
    transition: background-color var(--transition-fast);
}

.passcode-key:active {
    background-color: rgba(255, 255, 255, 0.25);
}

.passcode-key.biometric,
.passcode-key.backspace {
    background-color: transparent;
    font-size: var(--font-xl);
}

.passcode-cancel {
    position: absolute;
    bottom: 30px;
    color: var(--text-on-primary);
    font-size: var(--font-lg);
    opacity: 0.8;
    background: none;
    border: none;
    transition: opacity var(--transition-fast);
}

.passcode-cancel:active {
    opacity: 1;
}

/* Wallet Screen */
.wallet-screen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: var(--bg-main);
    display: none;
    flex-direction: column;
    z-index: var(--z-normal);
    overflow: hidden;
}

.wallet-header {
    background: linear-gradient(145deg, var(--color-primary-light) 0%, var(--color-primary) 100%);
    color: var(--text-on-primary);
    padding: var(--space-lg) var(--space-md) var(--space-md);
    padding-top: calc(var(--space-lg) + var(--status-bar-height));
    box-shadow: var(--shadow-md);
}

.wallet-top-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-lg);
}

.wallet-settings {
    position: relative;
    width: 24px;
    height: 24px;
}

.notification-badge {
    position: absolute;
    top: -5px;
    right: -5px;
    background-color: var(--color-error);
    color: var(--text-on-primary);
    font-size: var(--font-xs);
    font-weight: var(--weight-semibold);
    width: 16px;
    height: 16px;
    border-radius: var(--radius-full);
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: var(--shadow-sm);
}

.wallet-title {
    font-size: var(--font-xl);
    font-weight: var(--weight-semibold);
    display: flex;
    align-items: center;
    position: relative;
}

.wallet-dropdown-arrow {
    margin-left: var(--space-sm);
    width: 12px;
    height: 12px;
    transition: transform var(--transition-fast);
}

.wallet-dropdown-arrow.active {
    transform: rotate(180deg);
}

.accounts-dropdown {
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    background: var(--bg-card);
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-lg);
    width: 160px;
    z-index: var(--z-dropdown);
    overflow: hidden;
    display: none;
    margin-top: var(--space-sm);
}

.account-option {
    padding: var(--space-md) var(--space-md);
    border-bottom: 1px solid var(--border-light);
    font-size: var(--font-md);
    font-weight: var(--weight-medium);
    display: flex;
    align-items: center;
    color: var(--text-primary);
    transition: background-color var(--transition-fast);
}

.account-option:last-child {
    border-bottom: none;
}

.account-option:hover,
.account-option:focus {
    background-color: rgba(0, 0, 0, 0.05);
}

.account-dot {
    width: 8px;
    height: 8px;
    background-color: var(--color-primary);
    border-radius: var(--radius-full);
    margin-right: var(--space-sm);
    opacity: 0;
}

.account-option.active .account-dot {
    opacity: 1;
}

.wallet-scan {
    width: 24px;
    height: 24px;
}

.wallet-balance-area {
    text-align: center;
    margin-bottom: var(--space-lg);
    padding-bottom: var(--space-sm);
}

.wallet-total-label {
    font-size: var(--font-sm);
    opacity: 0.8;
    margin-bottom: var(--space-sm);
}

.wallet-total-balance {
    font-size: var(--font-5xl);
    font-weight: var(--weight-bold);
    letter-spacing: -0.6px;
    margin-bottom: var(--space-sm);
    transition: all var(--transition-normal);
}

.wallet-balance-change {
    font-size: var(--font-sm);
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: rgba(255, 255, 255, 0.1);
    border-radius: 100px;
    padding: 2px var(--space-md);
    width: fit-content;
    margin: 0 auto;
}

.balance-up {
    color: var(--color-success);
}

.balance-down {
    color: var(--color-error);
}

.wallet-actions {
    display: flex;
    justify-content: center;
    margin-bottom: var(--space-md);
}

.wallet-action-button {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 0 var(--space-xl);
    position: relative;
}

.wallet-action-button::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    background-color: rgba(255, 255, 255, 0.1);
    border-radius: var(--radius-md);
    transition: opacity var(--transition-fast);
}

.wallet-action-button:active::after {
    opacity: 1;
}

.action-icon {
    width: 48px;
    height: 48px;
    background: rgba(255, 255, 255, 0.15);
    border-radius: var(--radius-full);
    display: flex;
    justify-content: center;
    align-items: center;
    margin-bottom: var(--space-sm);
    box-shadow: var(--shadow-md);
    transform: translateY(0);
    transition: transform var(--transition-fast), box-shadow var(--transition-fast);
}

.action-icon:active {
    transform: translateY(1px);
    box-shadow: var(--shadow-sm);
}

.action-label {
    font-size: var(--font-sm);
}

.wallet-tokens-container {
    flex: 1;
    overflow-y: auto;
    padding: var(--space-md);
    padding-bottom: calc(var(--tab-bar-height) + var(--space-md));
    -webkit-overflow-scrolling: touch;
}

.wallet-section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-md);
}

.section-title {
    font-size: var(--font-lg);
    font-weight: var(--weight-semibold);
}

.network-selector {
    display: flex;
    align-items: center;
    background-color: var(--bg-button-secondary);
    border-radius: 16px;
    padding: 6px 10px;
}

.network-icon {
    width: 16px;
    height: 16px;
    margin-right: 6px;
}

.network-name {
    font-size: var(--font-sm);
    font-weight: var(--weight-medium);
}

.network-arrow {
    margin-left: 6px;
    width: 12px;
    height: 12px;
    opacity: 0.5;
}

/* Token List & Items */
.wallet-token-list {
    display: flex;
    flex-direction: column;
}

.token-item {
    position: relative;
    transition: background-color var(--transition-fast);
    border-radius: var(--radius-md);
    margin: 0 calc(-1 * var(--space-sm));
    padding: var(--space-md) var(--space-sm);
    display: flex;
    align-items: center;
    border-bottom: 1px solid var(--border-light);
}

.token-item:focus {
    outline: none;
    box-shadow: 0 0 0 2px var(--color-primary);
}

.token-item:active {
    background-color: rgba(0, 0, 0, 0.05);
}

.token-icon {
    width: 40px;
    height: 40px;
    border-radius: 20px;
    margin-right: var(--space-md);
    overflow: hidden;
    box-shadow: var(--shadow-sm);
}

.token-details {
    flex: 1;
}

.token-name-row {
    display: flex;
    align-items: center;
    margin-bottom: var(--space-xs);
}

.token-name {
    font-weight: var(--weight-semibold);
    margin-right: var(--space-sm);
}

.token-symbol {
    color: var(--text-secondary);
    font-size: var(--font-sm);
}

.token-balance {
    font-size: var(--font-sm);
    transition: color var(--transition-normal);
}

.token-value {
    text-align: right;
}

.token-fiat-value {
    font-weight: var(--weight-medium);
    margin-bottom: var(--space-xs);
    transition: color var(--transition-slow);
}

.token-price-change {
    font-size: var(--font-xs);
    color: var(--color-success);
    transition: color var(--transition-slow);
}

.token-price-down {
    color: var(--color-error);
}

/* Tab Bar */
.tab-bar {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    height: var(--tab-bar-height);
    background-color: var(--bg-card);
    display: flex;
    justify-content: space-around;
    align-items: center;
    box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
    z-index: var(--z-fixed);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border-top: 1px solid var(--border-light);
    padding-bottom: env(safe-area-inset-bottom, 0);
    height: calc(var(--tab-bar-height) + env(safe-area-inset-bottom, 0));
}

.tab-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: var(--space-sm) 0;
    width: 25%;
    transition: transform var(--transition-fast);
}

.tab-item:active {
    transform: translateY(1px);
}

.tab-icon {
    width: 24px;
    height: 24px;
    margin-bottom: var(--space-xs);
    opacity: 0.5;
}

.tab-label {
    font-size: var(--font-xs);
    color: var(--text-secondary);
}

.tab-item.active .tab-icon {
    opacity: 1;
}

.tab-item.active .tab-label {
    color: var(--color-primary);
    font-weight: var(--weight-medium);
}

/* Token Detail Screen */
.token-detail-screen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: var(--bg-card);
    display: none;
    flex-direction: column;
    z-index: var(--z-fixed);
}

.token-header {
    padding: var(--space-md);
    padding-top: calc(var(--space-md) + var(--status-bar-height));
    display: flex;
    align-items: center;
    border-bottom: 1px solid var(--border-light);
}

.back-button {
    width: 24px;
    height: 24px;
    margin-right: var(--space-md);
}

.token-header-details {
    flex: 1;
    display: flex;
    align-items: center;
}

.token-header-icon {
    width: 32px;
    height: 32px;
    border-radius: var(--radius-full);
    margin-right: var(--space-md);
}

.token-header-name {
    font-size: var(--font-xl);
    font-weight: var(--weight-semibold);
}

.more-options {
    width: 24px;
    height: 24px;
}

.token-chart-area {
    padding: var(--space-xl) var(--space-md);
    border-bottom: 1px solid var(--border-light);
    background-color: #FAFAFA;
}

.token-price {
    font-size: var(--font-4xl);
    font-weight: var(--weight-semibold);
    margin-bottom: var(--space-sm);
}

.token-24h-change {
    font-size: var(--font-md);
    color: var(--color-success);
    margin-bottom: var(--space-xl);
}

.token-chart {
    height: 180px;
    margin-bottom: var(--space-md);
    position: relative;
}

.chart-placeholder {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(to right, var(--color-primary), var(--color-primary-light));
    mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 300 100'%3E%3Cpath d='M0,50 C50,30 100,70 150,50 C200,30 250,50 300,40 L300,100 L0,100 Z' fill='%23000'/%3E%3C/svg%3E");
    mask-size: cover;
    border-radius: var(--radius-lg);
    box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.05);
    animation: pulse-subtle var(--animation-slow) infinite;
}

@keyframes pulse-subtle {
    0% { opacity: 0.9; }
    50% { opacity: 1; }
    100% { opacity: 0.9; }
}

.chart-tabs {
    display: flex;
    justify-content: space-between;
}

.chart-tab {
    padding: 6px var(--space-md);
    border-radius: 16px;
    font-size: var(--font-sm);
    color: var(--text-secondary);
    font-weight: var(--weight-medium);
    transition: all var(--transition-fast);
}

.chart-tab.active {
    background-color: var(--bg-button-secondary);
    color: var(--text-primary);
    font-weight: var(--weight-medium);
    box-shadow: var(--shadow-sm);
}

.token-info-area {
    padding: var(--space-xl) var(--space-md);
    border-bottom: 1px solid var(--border-light);
}

.token-holdings {
    display: flex;
    justify-content: space-between;
    margin-bottom: var(--space-xl);
}

.holdings-amount {
    font-size: var(--font-lg);
    font-weight: var(--weight-semibold);
    margin-bottom: var(--space-xs);
}

.holdings-label {
    font-size: var(--font-sm);
    color: var(--text-secondary);
}

.token-buttons {
    display: flex;
    justify-content: space-between;
}

.token-button {
    width: 48%;
    height: 48px;
    border-radius: var(--radius-md);
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: var(--font-lg);
    font-weight: var(--weight-semibold);
    letter-spacing: 0.2px;
    transition: transform var(--transition-fast), box-shadow var(--transition-fast);
}

.token-button:active {
    transform: scale(0.98);
}

.button-send {
    background-color: var(--color-primary);
    color: var(--text-on-primary);
    box-shadow: var(--shadow-md);
}

.button-send:active {
    box-shadow: var(--shadow-sm);
}

.button-receive {
    background-color: var(--bg-button-secondary);
    color: var(--text-primary);
    box-shadow: var(--shadow-sm);
}

.token-history-area {
    flex: 1;
    overflow-y: auto;
}

.history-header {
    padding: var(--space-xl) var(--space-md);
    font-size: var(--font-lg);
    font-weight: var(--weight-semibold);
    border-bottom: 1px solid var(--border-light);
}

.transaction-list {
    padding: 0 var(--space-md);
}

.transaction-item {
    display: flex;
    padding: var(--space-md) 0;
    border-bottom: 1px solid var(--border-light);
    transition: background-color var(--transition-fast);
    margin: 0 calc(-1 * var(--space-md));
    padding: var(--space-md) var(--space-md);
    border-radius: var(--radius-md);
}

.transaction-item:active {
    background-color: rgba(0, 0, 0, 0.03);
}

.transaction-icon {
    width: 40px;
    height: 40px;
    border-radius: var(--radius-full);
    background-color: var(--bg-button-secondary);
    display: flex;
    justify-content: center;
    align-items: center;
    margin-right: var(--space-md);
    box-shadow: var(--shadow-sm);
}

.transaction-details {
    flex: 1;
}

.transaction-type {
    font-weight: var(--weight-medium);
    margin-bottom: var(--space-xs);
}

.transaction-date {
    font-size: var(--font-sm);
    color: var(--text-secondary);
}

.transaction-amount {
    text-align: right;
}

.transaction-value {
    font-weight: var(--weight-medium);
    margin-bottom: var(--space-xs);
}

.transaction-usd {
    font-size: var(--font-sm);
    color: var(--text-secondary);
}

/* Transfer Modal */
.transfer-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(4px);
    -webkit-backdrop-filter: blur(4px);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: var(--z-modal);
}

.transfer-modal-content {
    width: 90%;
    max-width: 340px;
    background-color: var(--bg-card);
    border-radius: var(--radius-lg);
    padding: var(--space-xl);
    box-shadow: var(--shadow-lg);
}

.transfer-header {
    text-align: center;
    margin-bottom: var(--space-xl);
}

.transfer-title {
    font-size: var(--font-xl);
    font-weight: var(--weight-semibold);
    margin-bottom: var(--space-sm);
}

.transfer-description {
    font-size: var(--font-md);
    color: var(--text-secondary);
}

.transfer-form {
    margin-bottom: var(--space-xl);
}

.form-group {
    margin-bottom: var(--space-md);
}

.form-label {
    display: block;
    font-size: var(--font-md);
    margin-bottom: var(--space-sm);
    font-weight: var(--weight-medium);
}

.form-control {
    width: 100%;
    height: 48px;
    border: 1px solid var(--border-light);
    border-radius: var(--radius-md);
    padding: 0 var(--space-md);
    font-size: var(--font-lg);
    transition: border-color var(--transition-fast);
    background-color: var(--bg-input);
}

.form-control:focus {
    border-color: var(--color-primary);
    outline: none;
}

.wallet-selector {
    position: relative;
}

.wallet-dropdown {
    position: absolute;
    top: 48px;
    left: 0;
    width: 100%;
    background-color: var(--bg-card);
    border: 1px solid var(--border-light);
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-md);
    display: none;
    z-index: var(--z-dropdown);
}

.wallet-option {
    padding: var(--space-md);
    transition: background-color var(--transition-fast);
    color: var(--text-primary);
}

.wallet-option:hover,
.wallet-option:focus {
    background-color: rgba(0, 0, 0, 0.05);
}

.wallet-option:not(:last-child) {
    border-bottom: 1px solid var(--border-light);
}

.transfer-buttons {
    display: flex;
    justify-content: space-between;
}

.transfer-button {
    flex: 1;
    height: 48px;
    border-radius: var(--radius-md);
    font-size: var(--font-lg);
    font-weight: var(--weight-medium);
    display: flex;
    justify-content: center;
    align-items: center;
    transition: background-color var(--transition-fast), transform var(--transition-fast);
}

.transfer-button:active {
    transform: scale(0.98);
}

.button-cancel {
    background-color: var(--bg-button-secondary);
    color: var(--text-primary);
    margin-right: var(--space-md);
}

.button-confirm {
    background-color: var(--color-primary);
    color: var(--text-on-primary);
}

/* Receipt Modal */
.receipt-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(4px);
    -webkit-backdrop-filter: blur(4px);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: var(--z-modal);
}

.receipt-modal-content {
    width: 92%;
    max-width: 360px;
    background-color: var(--bg-card);
    border-radius: var(--radius-xl);
    overflow: hidden;
    box-shadow: var(--shadow-lg);
}

.receipt-header {
    padding: var(--space-xl) 0 var(--space-xl);
    text-align: center;
}

.receipt-status-icon {
    margin: 0 auto var(--space-md);
    width: 64px;
    height: 64px;
}

.receipt-title {
    font-size: var(--font-2xl);
    font-weight: var(--weight-bold);
    color: var(--text-primary);
    margin-bottom: var(--space-xs);
}

.receipt-subtitle {
    font-size: var(--font-md);
    color: var(--text-secondary);
}

.receipt-amount-box {
    background-color: var(--bg-main);
    padding: var(--space-md) 0;
    text-align: center;
    margin-bottom: var(--space-md);
}

.receipt-token-amount {
    font-size: var(--font-2xl);
    font-weight: var(--weight-bold);
    color: var(--text-primary);
    margin-bottom: var(--space-xs);
}

.receipt-fiat-amount {
    font-size: var(--font-md);
    color: var(--text-secondary);
}

.receipt-data-section {
    padding: 0 var(--space-xl) var(--space-md);
}

.receipt-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-md);
    padding: var(--space-xs) 0;
}

.receipt-label {
    color: var(--text-secondary);
    font-size: var(--font-md);
}

.receipt-value {
    color: var(--text-primary);
    font-size: var(--font-md);
    font-weight: var(--weight-medium);
    text-align: right;
    max-width: 60%;
}

.receipt-divider {
    height: 1px;
    background-color: var(--border-light);
    margin: var(--space-sm) 0 var(--space-md);
}

.hash-container {
    display: flex;
    align-items: center;
}

.receipt-hash {
    font-family: SFMono-Regular, Menlo, Monaco, Consolas, monospace;
    font-size: var(--font-sm);
}

.copy-button {
    margin-left: var(--space-sm);
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0.7;
    transition: opacity var(--transition-fast);
    color: var(--color-primary);
}

.copy-button:hover,
.copy-button:focus {
    opacity: 1;
}

.network-value {
    display: flex;
    align-items: center;
}

.receipt-buttons {
    padding: 0 var(--space-md) var(--space-xl);
    display: flex;
    flex-direction: column;
    gap: var(--space-md);
}

.receipt-button {
    height: 50px;
    border-radius: var(--radius-md);
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: var(--font-lg);
    font-weight: var(--weight-semibold);
    border: none;
    transition: all var(--transition-fast);
}

.button-view-explorer {
    background-color: var(--color-primary);
    color: var(--text-on-primary);
    display: flex;
    gap: var(--space-sm);
}

.button-view-explorer:hover,
.button-view-explorer:active {
    background-color: var(--color-primary-dark);
}

.button-close {
    background-color: var(--bg-button-secondary);
    color: var(--text-primary);
}

.button-close:hover,
.button-close:active {
    background-color: var(--border-light);
}

/* Toast Container */
.toast-container {
    position: fixed;
    bottom: calc(var(--tab-bar-height) + var(--space-md));
    left: 50%;
    transform: translateX(-50%);
    z-index: var(--z-toast);
    display: flex;
    flex-direction: column-reverse;
    align-items: center;
    gap: var(--space-sm);
    width: 90%;
    pointer-events: none;
}

.toast {
    background-color: rgba(0, 0, 0, 0.8);
    color: white;
    padding: var(--space-sm) var(--space-md);
    border-radius: 100px;
    font-size: var(--font-sm);
    font-weight: var(--weight-medium);
    box-shadow: var(--shadow-md);
    max-width: 90%;
    text-align: center;
    opacity: 0;
    transform: translateY(10px);
    transition: opacity var(--transition-normal), transform var(--transition-normal);
    pointer-events: none;
}

.toast.show {
    opacity: 1;
    transform: translateY(0);
}

.toast.error {
    background-color: var(--color-error);
}

.toast.success {
    background-color: var(--color-success);
}

/* Session Timeout Dialog */
.timeout-dialog {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(4px);
    -webkit-backdrop-filter: blur(4px);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: var(--z-modal);
}

.timeout-dialog-content {
    width: 90%;
    max-width: 320px;
    background-color: var(--bg-card);
    border-radius: var(--radius-lg);
    padding: var(--space-xl);
    box-shadow: var(--shadow-lg);
}

.timeout-title {
    font-size: var(--font-xl);
    font-weight: var(--weight-semibold);
    margin-bottom: var(--space-sm);
}

.timeout-message {
    font-size: var(--font-md);
    color: var(--text-secondary);
    margin-bottom: var(--space-xl);
}

.timeout-actions {
    display: flex;
    justify-content: space-between;
}

.timeout-button {
    flex: 1;
    height: 48px;
    border-radius: var(--radius-md);
    font-size: var(--font-md);
    font-weight: var(--weight-medium);
    display: flex;
    justify-content: center;
    align-items: center;
    transition: background-color var(--transition-fast);
}

.button-primary {
    background-color: var(--color-primary);
    color: var(--text-on-primary);
    margin-right: var(--space-md);
}

.button-secondary {
    background-color: var(--bg-button-secondary);
    color: var(--text-primary);
}

/* Touch animation */
.touch-effect {
    position: relative;
    overflow: hidden;
}

.touch-effect:after {
    content: '';
    display: block;
    position: absolute;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    pointer-events: none;
    background-image: radial-gradient(circle, #fff 10%, transparent 10.01%);
    background-repeat: no-repeat;
    background-position: 50%;
    transform: scale(10, 10);
    opacity: 0;
    transition: transform .5s, opacity 1s;
}

.touch-effect:active:after {
    transform: scale(0, 0);
    opacity: .3;
    transition: 0s;
}

/* Utility classes */
.hidden {
    display: none !important;
}

.visually-hidden {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border-width: 0;
}

/* Animations */
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes slideUp {
    from { transform: translateY(20px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}

@keyframes slideDown {
    from { transform: translateY(-20px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}

/* Animation classes */
.fade-in {
    animation: fadeIn var(--animation-normal) forwards;
}

.slide-up {
    animation: slideUp var(--animation-normal) forwards;
}

.slide-down {
    animation: slideDown var(--animation-normal) forwards;
}

/* Responsive adjustments */
@media (min-width: 768px) {
    .transfer-modal-content,
    .receipt-modal-content,
    .timeout-dialog-content {
        max-width: 400px;
    }
    
    .wallet-tokens-container {
        max-width: 600px;
        margin: 0 auto;
    }
}

/* Reduced motion preferences */
@media (prefers-reduced-motion: reduce) {
    * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
    }
    
    .splash-logo {
        animation: none !important;
    }
}

/* Utilities for focus styles */
.focus-visible:focus {
    outline: 2px solid var(--color-primary);
    outline-offset: 2px;
}

/* Print styles */
@media print {
    .wallet-screen,
    .token-detail-screen,
    .receipt-modal,
    .transfer-modal,
    .timeout-dialog {
        position: static;
        overflow: visible;
    }
    
    .tab-bar,
    .status-bar,
    .wallet-scan,
    .wallet-settings {
        display: none !important;
    }
}

/**
 * config.js
 * Configuration file for Trust Wallet UI Clone
 * Contains all app constants and environment-specific values
 */

// Global application configuration
const Config = {
    // Application settings
    app: {
        name: 'Trust Wallet',
        version: '1.0.0',
        environment: 'development',
        sessionTimeoutMinutes: 5,
        debugMode: false
    },
    
    // API configuration (mock for demo)
    api: {
        baseUrl: 'https://api.example.com',
        timeout: 10000,
        retryAttempts: 3
    },
    
    // Default passcode for demo (in production this would be stored securely)
    security: {
        demoPasscode: '123456',
        passcodeLength: 6,
        encryptionKey: 'demo-encryption-key'
    },
    
    // Currency and display settings
    display: {
        defaultCurrency: 'USD',
        currencySymbol: '$',
        defaultLanguage: 'en',
        dateFormat: {
            short: 'MMM D, YYYY',
            long: 'MMMM D, YYYY h:mm A'
        },
        numberFormat: {
            decimalPlaces: 2,
            thousandsSeparator: ',',
            decimalSeparator: '.'
        }
    },
    
    // Network configurations
    networks: [
        {
            id: 'bsc',
            name: 'BNB Smart Chain',
            icon: 'assets/bnb-chain.png',
            nativeCurrency: 'BNB',
            explorerUrl: 'https://bscscan.com/tx/'
        },
        {
            id: 'eth',
            name: 'Ethereum',
            icon: 'assets/eth-chain.png',
            nativeCurrency: 'ETH',
            explorerUrl: 'https://etherscan.io/tx/'
        }
    ],
    
    // Default token prices (used for demo)
    tokenPrices: {
        'USDT': 1.0,
        'BNB': 502.12,
        'BTC': 84666.0,
        'ETH': 3500.0,
        'XRP': 2.44
    },
    
    // Predefined wallet addresses for demo
    walletAddresses: {
        main: 'main',
        second: 'second',
        external1: '0x742d35Cc6634C0532925a3b844Bc454e4438f44e',
        external2: '0x8A7F7D7356bFBcf81Dd9E5749a0120C6A492F8a0'
    }
};

/**
 * storage.js
 * Provides secure storage functionality with encryption support
 */

// Storage service for persisting data
const Storage = {
    /**
     * Save data to local storage with optional encryption
     * @param {string} key - Storage key
     * @param {any} value - Value to store
     * @param {boolean} encrypt - Whether to encrypt the data
     */
    save(key, value, encrypt = false) {
        try {
            const data = JSON.stringify(value);
            const storageValue = encrypt ? this._encrypt(data) : data;
            localStorage.setItem(key, storageValue);
            return true;
        } catch (error) {
            console.error('Storage save error:', error);
            return false;
        }
    },
    
    /**
     * Get data from local storage with optional decryption
     * @param {string} key - Storage key
     * @param {boolean} decrypt - Whether to decrypt the data
     * @returns {any} The stored value or null if not found
     */
    get(key, decrypt = false) {
        try {
            const data = localStorage.getItem(key);
            
            if (!data) return null;
            
            const parsedData = decrypt ? this._decrypt(data) : data;
            return JSON.parse(parsedData);
        } catch (error) {
            console.error('Storage get error:', error);
            return null;
        }
    },
    
    /**
     * Remove data from local storage
     * @param {string} key - Storage key to remove
     */
    remove(key) {
        try {
            localStorage.removeItem(key);
            return true;
        } catch (error) {
            console.error('Storage remove error:', error);
            return false;
        }
    },
    
    /**
     * Clear all app data from local storage
     */
    clear() {
        try {
            localStorage.clear();
            return true;
        } catch (error) {
            console.error('Storage clear error:', error);
            return false;
        }
    },
    
    /**
     * Encrypt data (simplified for demo)
     * @param {string} data - Data to encrypt
     * @returns {string} Encrypted data
     */
    _encrypt(data) {
        // In a real app, use a proper encryption library
        // This is a simple encoding for demo purposes only
        return btoa(data + Config.security.encryptionKey);
    },
    
    /**
     * Decrypt data (simplified for demo)
     * @param {string} encryptedData - Data to decrypt
     * @returns {string} Decrypted data
     */
    _decrypt(encryptedData) {
        // In a real app, use a proper decryption library
        // This is a simple decoding for demo purposes only
        const decoded = atob(encryptedData);
        return decoded.substring(0, decoded.length - Config.security.encryptionKey.length);
    }
};

/**
 * utils.js
 * Utility functions for common tasks
 */

// Utility functions
const Utils = {
    /**
     * Format number with commas as thousands separators
     * @param {number} num - Number to format
     * @returns {string} Formatted number
     */
    formatNumber(num) {
        if (num === undefined || num === null) return '';
        
        const parts = num.toString().split('.');
        parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, Config.display.numberFormat.thousandsSeparator);
        return parts.join(Config.display.numberFormat.decimalSeparator);
    },
    
    /**
     * Format number as currency with symbol
     * @param {number} num - Number to format
     * @param {number} decimals - Number of decimal places
     * @returns {string} Formatted currency
     */
    formatCurrency(num, decimals = Config.display.numberFormat.decimalPlaces) {
        if (num === undefined || num === null) return '';
        
        const value = parseFloat(num).toFixed(decimals);
        return Config.display.currencySymbol + this.formatNumber(value);
    },
    
    /**
     * Format date to human-readable string
     * @param {Date|string} date - Date to format
     * @param {string} format - Format type ('short' or 'long')
     * @returns {string} Formatted date
     */
    formatDate(date, format = 'short') {
        const d = new Date(date);
        
        if (isNaN(d.getTime())) {
            return '';
        }
        
        if (format === 'short') {
            return d.toLocaleDateString('en-US', {
                month: 'short',
                day: 'numeric',
                year: 'numeric'
            });
        } else if (format === 'long') {
            return d.toLocaleDateString('en-US', {
                month: 'short',
                day: 'numeric',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        return d.toISOString();
    },
    
    /**
     * Truncate string to specific length with ellipsis
     * @param {string} str - String to truncate
     * @param {number} startChars - Characters to keep at start
     * @param {number} endChars - Characters to keep at end
     * @returns {string} Truncated string
     */
    truncateAddress(str, startChars = 6, endChars = 4) {
        if (!str) return '';
        
        if (str.length <= startChars + endChars) {
            return str;
        }
        
        return `${str.substring(0, startChars)}...${str.substring(str.length - endChars)}`;
    },
    
    /**
     * Debounce function to limit function calls
     * @param {Function} func - Function to debounce
     * @param {number} wait - Wait time in milliseconds
     * @returns {Function} Debounced function
     */
    debounce(func, wait = 300) {
        let timeout;
        
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    },
    
    /**
     * Copy text to clipboard
     * @param {string} text - Text to copy
     * @returns {Promise<boolean>} Success status
     */
    async copyToClipboard(text) {
        try {
            await navigator.clipboard.writeText(text);
            return true;
        } catch (err) {
            console.error('Failed to copy: ', err);
            return false;
        }
    },
    
    /**
     * Generate a random transaction hash
     * @returns {string} Random hash
     */
    generateTransactionHash() {
        const characters = '0123456789abcdef';
        let hash = '0x';
        
        for (let i = 0; i < 64; i++) {
            hash += characters.charAt(Math.floor(Math.random() * characters.length));
        }
        
        return hash;
    },
    
    /**
     * Get random number between min and max (inclusive)
     * @param {number} min - Minimum value
     * @param {number} max - Maximum value
     * @param {number} decimals - Number of decimal places
     * @returns {number} Random number
     */
    getRandomNumber(min, max, decimals = 0) {
        const value = Math.random() * (max - min) + min;
        return Number(value.toFixed(decimals));
    },
    
    /**
     * Apply percentage change to a value
     * @param {number} value - Base value
     * @param {number} percentChange - Percentage change
     * @returns {number} New value
     */
    applyPercentChange(value, percentChange) {
        return value * (1 + percentChange / 100);
    },
    
    /**
     * Get the browser's preferred color scheme
     * @returns {string} 'dark' or 'light'
     */
    getPreferredColorScheme() {
        return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
            ? 'dark'
            : 'light';
    },
    
    /**
     * Handle images that fail to load
     * @param {HTMLImageElement} img - Image element
     * @param {string} fallbackText - Fallback text for placeholder
     */
    handleImageError(img, fallbackText) {
        const createPlaceholder = () => {
            const fallback = document.createElement('div');
            fallback.style.width = img.width ? `${img.width}px` : '40px';
            fallback.style.height = img.height ? `${img.height}px` : '40px';
            fallback.style.backgroundColor = 'var(--color-primary)';
            fallback.style.display = 'flex';
            fallback.style.justifyContent = 'center';
            fallback.style.alignItems = 'center';
            fallback.style.color = 'white';
            fallback.style.borderRadius = img.style.borderRadius || '50%';
            fallback.style.fontSize = '16px';
            fallback.style.fontWeight = '600';
            fallback.textContent = fallbackText || (img.alt ? img.alt.charAt(0).toUpperCase() : 'T');
            
            if (img.parentNode) {
                img.parentNode.replaceChild(fallback, img);
            }
        };
        
        img.onerror = createPlaceholder;
        
        // If the image is already broken, create placeholder immediately
        if (img.complete && img.naturalWidth === 0) {
            createPlaceholder();
        }
    }
};

/**
 * state.js
 * Application state management
 */

// Application state management
class AppState {
    constructor() {
        // Initialize state
        this.state = {
            // Authentication
            isAuthenticated: false,
            currentScreen: 'splash', // splash, passcode, wallet, token-detail
            lastActivity: Date.now(),
            
            // Account and wallet data
            currentAccount: 'main', // main or second
            currentNetwork: Config.networks[0],
            
            // Wallet balances for each account
            walletBalances: {
                'main': {
                    'USDT': 100000000,
                    'BTC': 0.025,
                    'ETH': 0.5,
                    'BNB': 2.456,
                    'XRP': 500000000
                },
                'second': {
                    'USDT': 0,
                    'BTC': 0,
                    'ETH': 0,
                    'BNB': 0,
                    'XRP': 0
                },
                [Config.walletAddresses.external1]: {
                    'USDT': 250000,
                    'BTC': 3.5,
                    'ETH': 125,
                    'BNB': 42,
                    'XRP': 750000
                },
                [Config.walletAddresses.external2]: {
                    'USDT': 500000,
                    'BTC': 5,
                    'ETH': 200,
                    'BNB': 72,
                    'XRP': 1500000
                }
            },
            
            // Current token prices in USD
            tokenPrices: { ...Config.tokenPrices },
            
            // Transaction history
            transactions: [
                {
                    id: Utils.generateTransactionHash(),
                    from: 'main',
                    to: Config.walletAddresses.external1,
                    token: 'USDT',
                    amount: 50000,
                    date: new Date(Date.now() - 2 * 60 * 60 * 1000),
                    type: 'send',
                    status: 'completed',
                    fee: 0.000453,
                    feeToken: 'BNB'
                },
                {
                    id: Utils.generateTransactionHash(),
                    from: Config.walletAddresses.external2,
                    to: 'main',
                    token: 'USDT',
                    amount: 150000,
                    date: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000),
                    type: 'receive',
                    status: 'completed',
                    fee: 0.000521,
                    feeToken: 'BNB'
                },
                {
                    id: Utils.generateTransactionHash(),
                    from: 'main',
                    to: 'exchange',
                    token: 'BTC',
                    amount: 0.75,
                    date: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000),
                    type: 'send',
                    status: 'completed',
                    fee: 0.000312,
                    feeToken: 'BNB'
                },
                {
                    id: Utils.generateTransactionHash(),
                    from: 'exchange',
                    to: 'main',
                    token: 'ETH',
                    amount: 12.5,
                    date: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000),
                    type: 'receive',
                    status: 'completed',
                    fee: 0.000347,
                    feeToken: 'BNB'
                }
            ],
            
            // UI state
            currentToken: 'USDT',
            activePriceChart: '1W',
            isLoading: false,
            showTimeout: false,
            sessionTimeoutId: null
        };
        
        // Observers for state changes
        this.observers = [];
        
        // Load state from storage if available
        this.loadState();
        
        // Start tracking user activity
        this.trackActivity();
    }
    
    /**
     * Get the current state
     * @returns {Object} Current state
     */
    getState() {
        return { ...this.state };
    }
    
    /**
     * Update state with new values
     * @param {Object} newState - New state values
     */
    setState(newState) {
        this.state = {
            ...this.state,
            ...newState,
            lastActivity: Date.now() // Update last activity
        };
        
        // Notify observers of state change
        this.notifyObservers();
        
        // Save state to storage
        this.saveState();
    }
    
    /**
     * Subscribe to state changes
     * @param {Function} callback - Observer callback
     */
    subscribe(callback) {
        this.observers.push(callback);
    }
    
    /**
     * Unsubscribe from state changes
     * @param {Function} callback - Observer callback
     */
    unsubscribe(callback) {
        this.observers = this.observers.filter(observer => observer !== callback);
    }
    
    /**
     * Notify all observers of state change
     */
    notifyObservers() {
        for (const observer of this.observers) {
            observer(this.state);
        }
    }
    
    /**
     * Save state to persistent storage
     */
    saveState() {
        // Exclude volatile state properties
        const { sessionTimeoutId, ...persistentState } = this.state;
        
        Storage.save('appState', persistentState, true);
    }
    
    /**
     * Load state from persistent storage
     */
    loadState() {
        const savedState = Storage.get('appState', true);
        
        if (savedState) {
            // Merge saved state with default state
            this.state = {
                ...this.state,
                ...savedState,
                lastActivity: Date.now(),
                isAuthenticated: false, // Always start unauthenticated
                currentScreen: 'splash'
            };
        }
    }
    
    /**
     * Reset state to defaults
     */
    resetState() {
        this.state = {
            // Reset to initial values
            isAuthenticated: false,
            currentScreen: 'splash',
            lastActivity: Date.now(),
            currentAccount: 'main',
            currentNetwork: Config.networks[0],
            currentToken: 'USDT',
            activePriceChart: '1W',
            isLoading: false,
            showTimeout: false,
            sessionTimeoutId: null
        };
        
        Storage.remove('appState');
        this.notifyObservers();
    }
    
    /**
     * Track user activity and handle session timeout
     */
    trackActivity() {
        // Track user activity
        const activityEvents = ['mousedown', 'keydown', 'touchstart', 'scroll'];
        
        const updateActivity = Utils.debounce(() => {
            this.setState({ lastActivity: Date.now() });
        }, 500);
        
        activityEvents.forEach(event => {
            document.addEventListener(event, updateActivity, { passive: true });
        });
        
        // Check for session timeout every minute
        const sessionTimeoutId = setInterval(() => {
            if (!this.state.isAuthenticated) return;
            
            const currentTime = Date.now();
            const inactiveTime = currentTime - this.state.lastActivity;
            
            // If inactive for more than timeout threshold (4 minutes), show warning
            if (inactiveTime > (Config.app.sessionTimeoutMinutes - 1) * 60 * 1000) {
                this.setState({ showTimeout: true });
            }
            
            // If inactive for more than timeout, log out
            if (inactiveTime > Config.app.sessionTimeoutMinutes * 60 * 1000) {
                this.logout();
            }
        }, 60 * 1000);
        
        this.setState({ sessionTimeoutId });
    }
    
    /**
     * Authenticate user and start session
     */
    login() {
        this.setState({
            isAuthenticated: true,
            currentScreen: 'wallet',
            lastActivity: Date.now(),
            showTimeout: false
        });
    }
    
    /**
     * End user session
     */
    logout() {
        this.setState({
            isAuthenticated: false,
            currentScreen: 'passcode',
            showTimeout: false
        });
    }
    
    /**
     * Calculate total balance in USD across all tokens
     * @param {string} account - Account to calculate balance for
     * @returns {number} Total balance in USD
     */
    calculateTotalBalance(account = this.state.currentAccount) {
        const balances = this.state.walletBalances[account];
        let total = 0;
        
        if (!balances) return 0;
        
        for (const [token, amount] of Object.entries(balances)) {
            const price = this.state.tokenPrices[token] || 0;
            total += amount * price;
        }
        
        return total;
    }
    
    /**
     * Get transactions for specific account and token
     * @param {string} account - Account to get transactions for
     * @param {string} token - Token to filter by (optional)
     * @returns {Array} Filtered transactions
     */
    getTransactions(account = this.state.currentAccount, token = null) {
        return this.state.transactions
            .filter(tx => {
                const accountMatch = tx.from === account || tx.to === account;
                const tokenMatch = token ? tx.token === token : true;
                return accountMatch && tokenMatch;
            })
            .sort((a, b) => new Date(b.date) - new Date(a.date));
    }
    
    /**
     * Add new transaction to history
     * @param {Object} transaction - Transaction data
     */
    addTransaction(transaction) {
        const newTransaction = {
            id: Utils.generateTransactionHash(),
            date: new Date(),
            status: 'completed',
            ...transaction
        };
        
        this.setState({
            transactions: [newTransaction, ...this.state.transactions]
        });
    }
    
    /**
     * Update token balances
     * @param {Object} params - Parameters
     * @param {string} params.from - From account
     * @param {string} params.to - To account
     * @param {string} params.token - Token symbol
     * @param {number} params.amount - Amount to transfer
     */
    updateBalances({ from, to, token, amount }) {
        const walletBalances = { ...this.state.walletBalances };
        
        // Deduct from sender
        if (walletBalances[from] && walletBalances[from][token] !== undefined) {
            walletBalances[from] = {
                ...walletBalances[from],
                [token]: Math.max(0, walletBalances[from][token] - amount)
            };
        }
        
        // Add to recipient
        if (walletBalances[to] && walletBalances[to][token] !== undefined) {
            walletBalances[to] = {
                ...walletBalances[to],
                [token]: walletBalances[to][token] + amount
            };
        }
        
        this.setState({ walletBalances });
    }
    
    /**
     * Update token prices with fluctuations
     */
    updateTokenPrices() {
        const tokenPrices = { ...this.state.tokenPrices };
        
        // Apply random fluctuations to each token except USDT
        for (const [token, price] of Object.entries(tokenPrices)) {
            if (token !== 'USDT') {
                // Random percentage change between -0.5% and +0.5%
                const percentChange = Utils.getRandomNumber(-0.5, 0.5, 2);
                tokenPrices[token] = Utils.applyPercentChange(price, percentChange);
            }
        }
        
        this.setState({ tokenPrices });
    }
    
    /**
     * Switch current account
     * @param {string} account - Account to switch to
     */
    switchAccount(account) {
        if (this.state.walletBalances[account]) {
            this.setState({ currentAccount: account });
        }
    }
    
    /**
     * Switch current network
     * @param {Object} network - Network to switch to
     */
    switchNetwork(network) {
        this.setState({ currentNetwork: network });
    }
    
    /**
     * Set current token for detail view
     * @param {string} token - Token symbol
     */
    setCurrentToken(token) {
        this.setState({ currentToken: token });
    }
}

// Create global app state instance
const appState = new AppState();

            /**
 * wallet.js
 * Core wallet functionality and business logic
 */

// Wallet service with core cryptocurrency functionality
const WalletService = {
    /**
     * Initialize wallet service
     */
    init() {
        // Load wallet data from storage or initialize new wallet
        this.loadWalletData();
        
        // Start price update simulation
        this.startPriceUpdates();
    },
    
    /**
     * Load wallet data from secure storage
     */
    loadWalletData() {
        const walletData = Storage.get('walletData', true);
        
        if (walletData) {
            // Merge saved wallet data with app state
            appState.setState({
                walletBalances: walletData.balances || appState.getState().walletBalances,
                transactions: walletData.transactions || appState.getState().transactions
            });
        }
    },
    
    /**
     * Save wallet data to secure storage
     */
    saveWalletData() {
        const state = appState.getState();
        
        const walletData = {
            balances: state.walletBalances,
            transactions: state.transactions
        };
        
        Storage.save('walletData', walletData, true);
    },
    
    /**
     * Start simulated price updates for tokens
     */
    startPriceUpdates() {
        // Update prices initially
        this.updatePrices();
        
        // Update prices every 30 seconds
        setInterval(() => {
            this.updatePrices();
        }, 30000);
    },
    
    /**
     * Update token prices with realistic fluctuations
     */
    updatePrices() {
        appState.updateTokenPrices();
        
        // After updating prices, update the UI
        const state = appState.getState();
        if (state.isAuthenticated) {
            UI.updateBalanceDisplay();
            UI.updateTokenList();
        }
    },
    
    /**
     * Validate wallet address
     * @param {string} address - Wallet address to validate
     * @returns {boolean} True if valid
     */
    validateAddress(address) {
        // For demo purposes, accept any of our predefined addresses
        // or "main" and "second" as valid addresses
        const validAddresses = [
            'main',
            'second',
            Config.walletAddresses.external1,
            Config.walletAddresses.external2
        ];
        
        return validAddresses.includes(address) || 
               (address && address.startsWith('0x') && address.length === 42);
    },
    
    /**
     * Validate transaction amount
     * @param {number} amount - Amount to validate
     * @param {string} token - Token symbol
     * @param {string} account - Account to check balance against
     * @returns {Object} Validation result with status and message
     */
    validateAmount(amount, token, account = appState.getState().currentAccount) {
        const state = appState.getState();
        const balance = state.walletBalances[account][token] || 0;
        
        if (!amount || isNaN(amount) || amount <= 0) {
            return {
                valid: false,
                message: 'Please enter a valid amount'
            };
        }
        
        if (amount > balance) {
            return {
                valid: false,
                message: 'Insufficient balance'
            };
        }
        
        return {
            valid: true,
            message: ''
        };
    },
    
    /**
     * Process token transfer
     * @param {Object} params - Transfer parameters
     * @param {string} params.from - Sender account
     * @param {string} params.to - Recipient address
     * @param {string} params.token - Token symbol
     * @param {number} params.amount - Amount to transfer
     * @returns {Promise<Object>} Transfer result
     */
    async transferToken({ from, to, token, amount }) {
        try {
            const state = appState.getState();
            
            // Validate inputs
            if (!this.validateAddress(to)) {
                return {
                    success: false,
                    message: 'Invalid recipient address'
                };
            }
            
            const amountValidation = this.validateAmount(amount, token, from);
            if (!amountValidation.valid) {
                return {
                    success: false,
                    message: amountValidation.message
                };
            }
            
            // Generate transaction fee (realistic for the network)
            // For BNB Smart Chain, fees are usually between 0.0003 and 0.0006 BNB
            const fee = Utils.getRandomNumber(0.0003, 0.0006, 6);
            
            // Create transaction
            const transaction = {
                from,
                to,
                token,
                amount: parseFloat(amount),
                date: new Date(),
                type: 'send',
                status: 'pending',
                fee,
                feeToken: state.currentNetwork.nativeCurrency
            };
            
            // Simulate network delay
            UI.showLoading();
            
            // Wait for 1-2 seconds to simulate transaction processing
            await new Promise(resolve => setTimeout(resolve, Utils.getRandomNumber(1000, 2000)));
            
            // Update balances
            appState.updateBalances({
                from,
                to,
                token,
                amount: parseFloat(amount)
            });
            
            // Add transaction to history
            transaction.status = 'completed';
            appState.addTransaction(transaction);
            
            // Save updated wallet data
            this.saveWalletData();
            
            UI.hideLoading();
            
            return {
                success: true,
                transaction
            };
        } catch (error) {
            console.error('Transfer error:', error);
            UI.hideLoading();
            
            return {
                success: false,
                message: 'Transaction failed. Please try again.'
            };
        }
    },
    
    /**
     * Get estimated transaction fee
     * @param {string} token - Token symbol
     * @returns {Object} Fee estimate with amount and USD value
     */
    getEstimatedFee(token = appState.getState().currentToken) {
        const state = appState.getState();
        
        // Simulate fee calculation based on network congestion
        // Fees on BNB Smart Chain range from 0.0003 to 0.0006 BNB
        const feeAmount = Utils.getRandomNumber(0.0003, 0.0006, 6);
        const feeToken = state.currentNetwork.nativeCurrency;
        const feeValueUsd = feeAmount * (state.tokenPrices[feeToken] || 0);
        
        return {
            amount: feeAmount,
            token: feeToken,
            valueUsd: feeValueUsd
        };
    },
    
    /**
     * Get balance for specific token and account
     * @param {string} token - Token symbol
     * @param {string} account - Account to check
     * @returns {Object} Balance details
     */
    getTokenBalance(token, account = appState.getState().currentAccount) {
        const state = appState.getState();
        const amount = state.walletBalances[account][token] || 0;
        const price = state.tokenPrices[token] || 0;
        const valueUsd = amount * price;
        
        return {
            token,
            amount,
            valueUsd
        };
    },
    
    /**
     * Get all token balances for an account
     * @param {string} account - Account to check
     * @returns {Array} Token balances
     */
    getAllBalances(account = appState.getState().currentAccount) {
        const state = appState.getState();
        const balances = state.walletBalances[account];
        
        return Object.entries(balances).map(([token, amount]) => {
            const price = state.tokenPrices[token] || 0;
            const valueUsd = amount * price;
            
            return {
                token,
                amount,
                valueUsd,
                price
            };
        }).sort((a, b) => b.valueUsd - a.valueUsd); // Sort by USD value (highest first)
    },
    
    /**
     * Generate price history data for charts
     * @param {string} token - Token symbol
     * @param {string} period - Time period (1H, 1D, 1W, 1M, 1Y, ALL)
     * @returns {Array} Price history data
     */
    generatePriceHistory(token = appState.getState().currentToken, period = '1W') {
        const state = appState.getState();
        const currentPrice = state.tokenPrices[token] || 1;
        
        // Number of data points based on period
        const dataPoints = {
            '1H': 60,
            '1D': 24,
            '1W': 7,
            '1M': 30,
            '1Y': 12,
            'ALL': 60
        };
        
        const volatility = {
            'USDT': 0.001, // Very stable
            'BNB': 0.02,   // Moderately volatile
            'BTC': 0.03,   // Highly volatile
            'ETH': 0.025,  // Highly volatile
            'XRP': 0.04    // Very volatile
        };
        
        // Generate realistic price data
        const points = dataPoints[period] || 24;
        const tokenVolatility = volatility[token] || 0.02;
        const priceData = [];
        
        // Create a trend bias (upward or downward)
        const trendBias = Utils.getRandomNumber(-0.3, 0.3, 3);
        
        let price = currentPrice;
        
        // Work backwards from current price
        for (let i = points - 1; i >= 0; i--) {
            // Randomize price with volatility and trend bias
            const change = tokenVolatility * (Utils.getRandomNumber(-1, 1, 3) + trendBias);
            price = price / (1 + change);
            
            // Calculate timestamp based on period
            let timestamp;
            switch (period) {
                case '1H':
                    timestamp = new Date(Date.now() - i * 60 * 1000); // Every minute
                    break;
                case '1D':
                    timestamp = new Date(Date.now() - i * 60 * 60 * 1000); // Every hour
                    break;
                case '1W':
                    timestamp = new Date(Date.now() - i * 24 * 60 * 60 * 1000); // Every day
                    break;
                case '1M':
                    timestamp = new Date(Date.now() - i * 24 * 60 * 60 * 1000); // Every day
                    break;
                case '1Y':
                    timestamp = new Date(Date.now() - i * 30 * 24 * 60 * 60 * 1000); // Every month
                    break;
                case 'ALL':
                    timestamp = new Date(Date.now() - i * 30 * 24 * 60 * 60 * 1000); // Every month
                    break;
                default:
                    timestamp = new Date(Date.now() - i * 24 * 60 * 60 * 1000);
            }
            
            priceData.push({
                timestamp,
                price
            });
        }
        
        // Add current price as the last point
        priceData.push({
            timestamp: new Date(),
            price: currentPrice
        });
        
        return priceData;
    },
    
    /**
     * Calculate the 24-hour price change percentage
     * @param {string} token - Token symbol
     * @returns {number} Price change percentage
     */
    get24HourPriceChange(token = appState.getState().currentToken) {
        // Get sample price history data
        const history = this.generatePriceHistory(token, '1D');
        
        // If no history, return 0
        if (history.length < 2) return 0;
        
        // Calculate percentage change
        const oldPrice = history[0].price;
        const newPrice = history[history.length - 1].price;
        
        return ((newPrice - oldPrice) / oldPrice) * 100;
    },
    
    /**
     * Check if passcode is valid
     * @param {string} passcode - Passcode to check
     * @returns {boolean} True if valid
     */
    validatePasscode(passcode) {
        // In a real app, this would check against a securely stored hash
        // For demo, we use the config value
        return passcode === Config.security.demoPasscode;
    },
    
    /**
     * Generate QR code for receiving payments
     * @param {string} account - Account to generate QR code for
     * @returns {string} Account address for QR code
     */
    getReceiveAddress(account = appState.getState().currentAccount) {
        // For demo, we'll use a hardcoded address based on account
        if (account === 'main') {
            return '0x34A2...5F76';
        } else if (account === 'second') {
            return '0x67B8...9D21';
        }
        
        return account;
    }
};

/**
 * UI.js
 * UI-related functionality and DOM manipulation
 */

// UI controller for DOM manipulation and event handling
const UI = {
    // DOM Elements (will be initialized in init method)
    elements: {},
    
    /**
     * Initialize UI elements and event listeners
     */
    init() {
        // Store references to DOM elements
        this.cacheElements();
        
        // Set up event listeners
        this.attachEventListeners();
        
        // Handle image errors
        this.setupImageErrorHandling();
        
        // Set initial UI state
        this.showScreen('splash');
        
        // Update status bar time
        this.updateStatusBarTime();
        setInterval(() => this.updateStatusBarTime(), 60000);
        
        // Subscribe to state changes
        appState.subscribe(() => this.handleStateChange());
    },
    
    /**
     * Cache DOM elements for better performance
     */
    cacheElements() {
        // Screens
        this.elements.screens = {
            splash: document.getElementById('splash-screen'),
            passcode: document.getElementById('passcode-screen'),
            wallet: document.getElementById('wallet-screen'),
            tokenDetail: document.getElementById('token-detail-screen')
        };
        
        // Loading elements
        this.elements.initialLoader = document.getElementById('initial-loader');
        this.elements.loadingOverlay = document.querySelector('.loading-overlay');
        
        // Passcode elements
        this.elements.passcodeDots = document.querySelectorAll('.passcode-dot');
        this.elements.passcodeKeys = document.querySelectorAll('.passcode-key');
        this.elements.passcodeBiometric = document.querySelector('.passcode-key.biometric');
        this.elements.passcodeBackspace = document.querySelector('.passcode-key.backspace');
        this.elements.passcodeCancel = document.querySelector('.passcode-cancel');
        
        // Wallet elements
        this.elements.walletTitle = document.querySelector('.wallet-title');
        this.elements.walletTotalBalance = document.querySelector('.wallet-total-balance');
        this.elements.walletChangePercent = document.querySelector('.wallet-balance-change');
        this.elements.accountsDropdown = document.getElementById('accounts-dropdown');
        this.elements.accountOptions = document.querySelectorAll('.account-option');
        this.elements.tokenList = document.querySelector('.wallet-token-list');
        this.elements.tokens = document.querySelectorAll('.token-item');
        
        // Tab bar elements
        this.elements.tabItems = document.querySelectorAll('.tab-item');
        
        // Action buttons
        this.elements.sendButton = document.querySelector('.wallet-action-button:nth-child(1)');
        this.elements.receiveButton = document.querySelector('.wallet-action-button:nth-child(2)');
        this.elements.swapButton = document.querySelector('.wallet-action-button:nth-child(3)');
        this.elements.networkSelector = document.querySelector('.network-selector');
        
        // Token detail elements
        this.elements.backButton = document.querySelector('.back-button');
        this.elements.tokenPrice = document.querySelector('.token-price');
        this.elements.token24hChange = document.querySelector('.token-24h-change');
        this.elements.chartTabs = document.querySelectorAll('.chart-tab');
        this.elements.holdingsAmount = document.querySelector('.holdings-amount');
        this.elements.holdingsValue = document.querySelector('.holdings-value');
        this.elements.tokenSendButton = document.querySelector('.button-send');
        this.elements.tokenReceiveButton = document.querySelector('.button-receive');
        this.elements.transactionList = document.querySelector('.transaction-list');
        
        // Transfer modal elements
        this.elements.transferModal = document.getElementById('transfer-modal');
        this.elements.transferForm = document.getElementById('transfer-form');
        this.elements.walletAddressInput = document.getElementById('wallet-address');
        this.elements.walletDropdown = document.getElementById('wallet-dropdown');
        this.elements.transferAmountInput = document.getElementById('transfer-amount');
        this.elements.cancelTransferButton = document.getElementById('cancel-transfer');
        this.elements.confirmTransferButton = document.getElementById('confirm-transfer');
        
        // Receipt modal elements
        this.elements.receiptModal = document.getElementById('receipt-modal');
        this.elements.receiptAmount = document.getElementById('receipt-amount');
        this.elements.receiptFiatAmount = document.getElementById('receipt-fiat-amount');
        this.elements.receiptDate = document.getElementById('receipt-date');
        this.elements.receiptFrom = document.getElementById('receipt-from');
        this.elements.receiptTo = document.getElementById('receipt-to');
        this.elements.receiptFee = document.getElementById('receipt-fee');
        this.elements.receiptHashShort = document.getElementById('receipt-hash-short');
        this.elements.copyHashButton = document.getElementById('copy-hash-btn');
        this.elements.viewExplorerButton = document.querySelector('.button-view-explorer');
        this.elements.closeReceiptButton = document.querySelector('.button-close');
        
        // Session timeout elements
        this.elements.timeoutDialog = document.getElementById('timeout-dialog');
        this.elements.timeoutStayButton = document.getElementById('timeout-stay');
        this.elements.timeoutLogoutButton = document.getElementById('timeout-logout');
        
        // Toast container
        this.elements.toastContainer = document.getElementById('toast-container');
    },
    
    /**
     * Set up event listeners for UI elements
     */
    attachEventListeners() {
        // Passcode input handlers
        this.elements.passcodeKeys.forEach(key => {
            if (!key.classList.contains('biometric') && !key.classList.contains('backspace')) {
                key.addEventListener('click', () => this.handlePasscodeInput(key.textContent));
            }
        });
        
        this.elements.passcodeBiometric.addEventListener('click', () => this.simulateBiometricAuth());
        this.elements.passcodeBackspace.addEventListener('click', () => this.handlePasscodeBackspace());
        this.elements.passcodeCancel.addEventListener('click', () => this.resetPasscode());
        
        // Wallet title click (account selector)
        this.elements.walletTitle.addEventListener('click', () => this.toggleAccountsDropdown());
        
        // Account options
        this.elements.accountOptions.forEach(option => {
            option.addEventListener('click', () => {
                this.switchAccount(option.dataset.account);
            });
        });
        
        // Token items
        this.elements.tokens.forEach(token => {
            token.addEventListener('click', () => {
                const tokenSymbol = token.querySelector('.token-symbol').textContent;
                this.showTokenDetail(tokenSymbol);
            });
        });
        
        // Tab bar items
        this.elements.tabItems.forEach((tab, index) => {
            tab.addEventListener('click', () => {
                if (index === 0) {
                    this.setActiveTab(index);
                } else {
                    this.showToast('Feature not available in demo');
                }
            });
        });
        
        // Action buttons
        this.elements.sendButton.addEventListener('click', () => this.showTransferModal());
        this.elements.receiveButton.addEventListener('click', () => {
            this.showToast('Receive feature not available in demo');
        });
        this.elements.swapButton.addEventListener('click', () => {
            this.showToast('Swap feature not available in demo');
        });
        
        // Network selector
        this.elements.networkSelector.addEventListener('click', () => {
            this.showToast('Network selector not available in demo');
        });
        
        // Token detail screen
        this.elements.backButton.addEventListener('click', () => {
            this.showScreen('wallet');
        });
        
        // Chart period tabs
        this.elements.chartTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                this.setActiveChartPeriod(tab.textContent);
            });
        });
        
        // Token send/receive buttons
        this.elements.tokenSendButton.addEventListener('click', () => this.showTransferModal());
        this.elements.tokenReceiveButton.addEventListener('click', () => {
            this.showToast('Receive feature not available in demo');
        });
        
        // Transfer modal
        this.elements.walletAddressInput.addEventListener('click', () => this.toggleWalletDropdown());
        this.elements.cancelTransferButton.addEventListener('click', () => this.hideTransferModal());
        this.elements.confirmTransferButton.addEventListener('click', () => this.processTransfer());
        
        // Receipt modal
        this.elements.copyHashButton.addEventListener('click', () => {
            const hash = this.elements.receiptHashShort.textContent;
            Utils.copyToClipboard(hash);
            this.showToast('Transaction ID copied to clipboard');
        });
        
        this.elements.viewExplorerButton.addEventListener('click', () => {
            const state = appState.getState();
            const explorerUrl = state.currentNetwork.explorerUrl;
            const hash = this.elements.receiptHashShort.textContent;
            window.open(`${explorerUrl}${hash}`, '_blank');
        });
        
        this.elements.closeReceiptButton.addEventListener('click', () => {
            this.hideReceiptModal();
        });
        
        // Timeout dialog
        this.elements.timeoutStayButton.addEventListener('click', () => {
            appState.setState({
                showTimeout: false,
                lastActivity: Date.now()
            });
        });
        
        this.elements.timeoutLogoutButton.addEventListener('click', () => {
            appState.logout();
        });
        
        // Close modals when clicking outside
        this.elements.transferModal.addEventListener('click', (e) => {
            if (e.target === this.elements.transferModal) {
                this.hideTransferModal();
            }
        });
        
        this.elements.receiptModal.addEventListener('click', (e) => {
            if (e.target === this.elements.receiptModal) {
                this.hideReceiptModal();
            }
        });
        
        // Form validation
        this.elements.transferForm.addEventListener('submit', (e) => {
            e.preventDefault();
            this.processTransfer();
        });
        
        // Keyboard support for passcode
        document.addEventListener('keydown', (e) => {
            const state = appState.getState();
            if (state.currentScreen === 'passcode') {
                if (e.key >= '0' && e.key <= '9') {
                    this.handlePasscodeInput(e.key);
                } else if (e.key === 'Backspace') {
                    this.handlePasscodeBackspace();
                } else if (e.key === 'Escape') {
                    this.resetPasscode();
                } else if (e.key === 'Enter') {
                    // Simulate biometric auth on Enter
                    this.simulateBiometricAuth();
                }
            }
        });
    },
    
    /**
     * Setup image error handling for all images
     */
    setupImageErrorHandling() {
        document.querySelectorAll('img').forEach(img => {
            Utils.handleImageError(img, img.alt ? img.alt.charAt(0) : 'T');
        });
    },
    
    /**
     * Handle state changes and update UI accordingly
     */
    handleStateChange() {
        const state = appState.getState();
        
        // Update current screen
        this.showScreen(state.currentScreen);
        
        // Update account-specific UI
        if (state.isAuthenticated) {
            this.updateBalanceDisplay();
            this.updateTokenList();
            this.updateTransactionHistory();
        }
        
        // Show/hide session timeout dialog
        this.elements.timeoutDialog.style.display = state.showTimeout ? 'flex' : 'none';
    },
    
    /**
     * Update time displayed in the status bar
     */
    updateStatusBarTime() {
        const now = new Date();
        const hours = now.getHours().toString().padStart(2, '0');
        const minutes = now.getMinutes().toString().padStart(2, '0');
        document.querySelector('.status-time').textContent = `${hours}:${minutes}`;
    },
    
    /**
     * Show a specific screen and hide others
     * @param {string} screenName - Name of screen to show
     */
    showScreen(screenName) {
        // Hide all screens
        Object.values(this.elements.screens).forEach(screen => {
            if (screen) {
                screen.style.display = 'none';
                screen.setAttribute('aria-hidden', 'true');
            }
        });
        
        // Show requested screen
        const screen = this.elements.screens[screenName];
        if (screen) {
            if (screenName === 'tokenDetail') {
                screen.style.display = 'flex';
            } else if (screenName === 'wallet') {
                screen.style.display = 'flex';
                // Update UI when showing wallet
                this.updateBalanceDisplay();
                this.updateTokenList();
            } else if (screenName === 'passcode') {
                screen.style.display = 'flex';
                this.resetPasscode();
            } else {
                screen.style.display = 'flex';
            }
            
            screen.setAttribute('aria-hidden', 'false');
        }
        
        // Update state if not already set
        const state = appState.getState();
        if (state.currentScreen !== screenName) {
            appState.setState({ currentScreen: screenName });
        }
    },
    
    /**
     * Show loading overlay
     */
    showLoading() {
        appState.setState({ isLoading: true });
        this.elements.loadingOverlay.style.display = 'flex';
    },
    
    /**
     * Hide loading overlay
     */
    hideLoading() {
        appState.setState({ isLoading: false });
        this.elements.loadingOverlay.style.display = 'none';
    },
    
    /**
     * Display a toast message
     * @param {string} message - Message to display
     * @param {string} type - Message type (default, success, error)
     * @param {number} duration - Duration in ms
     */
    showToast(message, type = 'default', duration = 3000) {
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        toast.textContent = message;
        
        this.elements.toastContainer.appendChild(toast);
        
        // Trigger layout and then add show class for animation
        setTimeout(() => {
            toast.classList.add('show');
        }, 10);
        
        // Remove after duration
        setTimeout(() => {
            toast.classList.remove('show');
            setTimeout(() => {
                this.elements.toastContainer.removeChild(toast);
            }, 300);
        }, duration);
    },
    
    /**
     * Handle passcode input
     * @param {string} key - Key pressed
     */
    handlePasscodeInput(key) {
        const state = appState.getState();
        const passcode = state.passcode || '';
        
        if (passcode.length < Config.security.passcodeLength) {
            // Update dots UI
            this.elements.passcodeDots[passcode.length].classList.add('filled');
            
            // Update state with new passcode
            appState.setState({ 
                passcode: passcode + key 
            });
            
            // Check if passcode is complete
            if (passcode.length + 1 === Config.security.passcodeLength) {
                this.verifyPasscode();
            }
        }
    },
    
    /**
     * Handle passcode backspace
     */
    handlePasscodeBackspace() {
        const state = appState.getState();
        const passcode = state.passcode || '';
        
        if (passcode.length > 0) {
            // Update dots UI
            this.elements.passcodeDots[passcode.length - 1].classList.remove('filled');
            
            // Update state with shortened passcode
            appState.setState({
                passcode: passcode.slice(0, -1)
            });
        }
    },
    
    /**
     * Reset passcode input
     */
    resetPasscode() {
        // Clear all dots
        this.elements.passcodeDots.forEach(dot => dot.classList.remove('filled'));
        
        // Reset passcode in state
        appState.setState({ passcode: '' });
    },
    
    /**
     * Verify entered passcode
     */
    verifyPasscode() {
        const state = appState.getState();
        const passcode = state.passcode || '';
        
        this.showLoading();
        
        // Simulate network delay
        setTimeout(() => {
            if (WalletService.validatePasscode(passcode)) {
                // Correct passcode
                appState.login();
                this.resetPasscode();
                this.showScreen('wallet');
            } else {
                // Incorrect passcode
                this.showToast('Invalid passcode. Please try again.', 'error');
                this.resetPasscode();
            }
            
            this.hideLoading();
        }, 500);
    },
    
    /**
     * Simulate biometric authentication
     */
    simulateBiometricAuth() {
        this.showLoading();
        
        // Simulate authentication delay
        setTimeout(() => {
            appState.login();
            this.showScreen('wallet');
            this.hideLoading();
        }, 1000);
    },
    
    /**
     * Toggle accounts dropdown
     */
    toggleAccountsDropdown() {
        const dropdown = this.elements.accountsDropdown;
        const isVisible = dropdown.style.display === 'block';
        
        dropdown.style.display = isVisible ? 'none' : 'block';
        
        // Toggle arrow direction
        const arrow = document.querySelector('.wallet-dropdown-arrow');
        arrow.classList.toggle('active', !isVisible);
        
        // Update ARIA attributes
        this.elements.walletTitle.setAttribute('aria-expanded', !isVisible);
    },
    
    /**
     * Switch to a different account
     * @param {string} account - Account to switch to
     */
    switchAccount(account) {
        appState.switchAccount(account);
        
        // Update UI to reflect active account
        this.elements.accountOptions.forEach(option => {
            option.classList.toggle('active', option.dataset.account === account);
        });
        
        // Update wallet title text
        this.elements.walletTitle.childNodes[0].nodeValue = 
            account === 'main' ? 'Main Wallet' : 'Account 2';
        
        // Hide dropdown
        this.elements.accountsDropdown.style.display = 'none';
        document.querySelector('.wallet-dropdown-arrow').classList.remove('active');
        this.elements.walletTitle.setAttribute('aria-expanded', 'false');
    },
    
    /**
     * Update wallet balance display
     */
    updateBalanceDisplay() {
        const state = appState.getState();
        const totalBalance = appState.calculateTotalBalance();
        
        // Update total balance
        this.elements.walletTotalBalance.textContent = Utils.formatCurrency(totalBalance);
        
        // Random daily change between -5% and +5% (biased toward positive)
        const dailyChange = Utils.getRandomNumber(-3, 5, 2);
        this.elements.walletChangePercent.innerHTML = `
            <span class="${dailyChange >= 0 ? 'balance-up' : 'balance-down'}">
                ${dailyChange >= 0 ? '+' : ''}${dailyChange.toFixed(2)}%
            </span> today
        `;
    },
    
    /**
     * Update token listing with current balances
     */
    updateTokenList() {
        const tokenBalances = WalletService.getAllBalances();
        const tokenListEl = this.elements.tokenList;
        
        // Clear existing token items (except the template)
        while (tokenListEl.firstChild) {
            tokenListEl.removeChild(tokenListEl.firstChild);
        }
        
        // Create and append token items
        tokenBalances.forEach(balance => {
            const { token, amount, valueUsd, price } = balance;
            
            // Get 24h price change
            const priceChange = WalletService.get24HourPriceChange(token);
            const priceChangeDisplay = priceChange.toFixed(2);
            
            // Create token item
            const tokenItem = document.createElement('div');
            tokenItem.className = 'token-item touch-effect';
            tokenItem.setAttribute('role', 'listitem');
            tokenItem.setAttribute('tabindex', '0');
            
            tokenItem.innerHTML = `
                <img class="token-icon" src="assets/${token.toLowerCase()}.png" alt="${token}">
                <div class="token-details">
                    <div class="token-name-row">
                        <span class="token-name">${this.getTokenFullName(token)}</span>
                        <span class="token-symbol">${token}</span>
                    </div>
                    <div class="token-balance">${Utils.formatNumber(amount)} ${token}</div>
                </div>
                <div class="token-value">
                    <div class="token-fiat-value">${Utils.formatCurrency(valueUsd)}</div>
                    <div class="token-price-change ${priceChange >= 0 ? '' : 'token-price-down'}">
                        ${priceChange >= 0 ? '+' : ''}${priceChangeDisplay}%
                    </div>
                </div>
            `;
            
            // Add click handler
            tokenItem.addEventListener('click', () => {
                this.showTokenDetail(token);
            });
            
            tokenListEl.appendChild(tokenItem);
        });
        
        // Set up image error handling for new images
        this.setupImageErrorHandling();
    },
    
    /**
     * Show token detail screen
     * @param {string} token - Token symbol
     */
    showTokenDetail(token) {
        appState.setCurrentToken(token);
        
        this.showLoading();
        
        // Simulate loading delay
        setTimeout(() => {
            const state = appState.getState();
            const tokenBalance = WalletService.getTokenBalance(token);
            const priceChange = WalletService.get24HourPriceChange(token);
            
            // Update token header
            document.querySelector('.token-header-icon').src = `assets/${token.toLowerCase()}.png`;
            document.querySelector('.token-header-name').textContent = token;
            
            // Update token price info
            this.elements.tokenPrice.textContent = Utils.formatCurrency(state.tokenPrices[token]);
            this.elements.token24hChange.textContent = `${priceChange >= 0 ? '+' : ''}${priceChange.toFixed(2)}% (24h)`;
            this.elements.token24hChange.className = `token-24h-change ${priceChange >= 0 ? '' : 'token-price-down'}`;
            
            // Update holdings info
            this.elements.holdingsAmount.textContent = `${Utils.formatNumber(tokenBalance.amount)} ${token}`;
            this.elements.holdingsValue.textContent = Utils.formatCurrency(tokenBalance.valueUsd);
            
            // Update transaction history
            this.updateTransactionHistory(token);
            
            // Setup chart animation
            this.createAnimatedChart();
            
            // Update send button label
            this.elements.tokenSendButton.textContent = `Send ${token}`;
            
            // Show screen
            this.showScreen('tokenDetail');
            this.hideLoading();
        }, 500);
    },
    
    /**
     * Set active tab in wallet screen
     * @param {number} index - Tab index
     */
    setActiveTab(index) {
        this.elements.tabItems.forEach(tab => tab.classList.remove('active'));
        this.elements.tabItems[index].classList.add('active');
    },
    
    /**
     * Set active chart period in token detail
     * @param {string} period - Chart period (1H, 1D, 1W, 1M, 1Y, ALL)
     */
    setActiveChartPeriod(period) {
        this.elements.chartTabs.forEach(tab => {
            const isActive = tab.textContent === period;
            tab.classList.toggle('active', isActive);
            tab.setAttribute('aria-selected', isActive);
        });
        
        appState.setState({ activePriceChart: period });
        
        // Regenerate chart with new period
        this.createAnimatedChart();
    },
    
    /**
     * Create animated price chart
     */
    createAnimatedChart() {
        const state = appState.getState();
        const chart = document.querySelector('.chart-placeholder');
        
        if (!chart) return;
        
        // Remove any existing canvas
        const existingCanvas = chart.querySelector('canvas');
        if (existingCanvas) {
            chart.removeChild(existingCanvas);
        }
        
        // Create canvas for the chart
        const canvas = document.createElement('canvas');
        canvas.width = chart.offsetWidth;
        canvas.height = chart.offsetHeight;
        canvas.style.position = 'absolute';
        canvas.style.top = '0';
        canvas.style.left = '0';
        canvas.style.borderRadius = 'var(--radius-lg)';
        
        chart.appendChild(canvas);
        const ctx = canvas.getContext('2d');
        
        // Get price history data
        const historyData = WalletService.generatePriceHistory(
            state.currentToken,
            state.activePriceChart
        );
        
        // Extract prices
        const prices = historyData.map(item => item.price);
        
        // Draw chart
        const drawChart = () => {
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Chart styling
            ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--color-primary');
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            // Calculate scaling
            const max = Math.max(...prices);
            const min = Math.min(...prices);
            const range = max - min;
            
            // Draw line
            for (let i = 0; i < prices.length; i++) {
                const x = (i / (prices.length - 1)) * canvas.width;
                const y = canvas.height - ((prices[i] - min) / range) * (canvas.height * 0.8);
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            
            ctx.stroke();
            
            // Add gradient fill
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            const primaryColor = getComputedStyle(document.documentElement).getPropertyValue('--color-primary');
            
            gradient.addColorStop(0, primaryColor + '33'); // Add 20% opacity
            gradient.addColorStop(1, primaryColor + '00'); // Transparent
            
            ctx.lineTo(canvas.width, canvas.height);
            ctx.lineTo(0, canvas.height);
            ctx.fillStyle = gradient;
            ctx.fill();
        };
        
        // Draw chart once
        drawChart();
    },
    
    /**
     * Update transaction history for current token
     * @param {string} token - Token symbol (optional)
     */
    updateTransactionHistory(token = appState.getState().currentToken) {
        const transactions = appState.getTransactions(appState.getState().currentAccount, token);
        const transactionListEl = this.elements.transactionList;
        
        // Clear current transaction list
        transactionListEl.innerHTML = '';
        
        if (transactions.length === 0) {
            const emptyMessage = document.createElement('div');
            emptyMessage.className = 'empty-transactions';
            emptyMessage.textContent = 'No transactions yet';
            transactionListEl.appendChild(emptyMessage);
            return;
        }
        
        // Add transactions to list
        transactions.forEach(tx => {
            const isSent = tx.type === 'send';
            
            const transactionItem = document.createElement('div');
            transactionItem.className = 'transaction-item';
            transactionItem.setAttribute('role', 'listitem');
            
            const formattedDate = Utils.formatDate(tx.date);
            
            transactionItem.innerHTML = `
                <div class="transaction-icon">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="${isSent ? 'M7.50008 13.4753L12.4751 8.50033M12.4751 8.50033H8.17508M12.4751 8.50033V12.8003' : 'M12.4999 6.52467L7.52492 11.4997M7.52492 11.4997H11.8249M7.52492 11.4997L7.52492 7.19967'}" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M10.0001 18.3337C14.6025 18.3337 18.3334 14.6027 18.3334 10.0003C18.3334 5.39795 14.6025 1.66699 10.0001 1.66699C5.39771 1.66699 1.66675 5.39795 1.66675 10.0003C1.66675 14.6027 5.39771 18.3337 10.0001 18.3337Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
                <div class="transaction-details">
                    <div class="transaction-type">${isSent ? 'Sent' : 'Received'} ${tx.token}</div>
                    <div class="transaction-date">${formattedDate}</div>
                </div>
                <div class="transaction-amount">
                    <div class="transaction-value">${isSent ? '-' : '+'}${Utils.formatNumber(tx.amount)} ${tx.token}</div>
                    <div class="transaction-usd">${isSent ? '-' : '+'}${Utils.formatCurrency(tx.amount * appState.getState().tokenPrices[tx.token])}</div>
                </div>
            `;
            
            transactionListEl.appendChild(transactionItem);
        });
    },
    
    /**
     * Show transfer modal
     */
    showTransferModal() {
        const state = appState.getState();
        const currentToken = state.currentToken;
        
        // Update modal title
        document.querySelector('.transfer-title').textContent = `Send ${currentToken}`;
        
        // Clear form inputs
        this.elements.walletAddressInput.value = '';
        this.elements.transferAmountInput.value = '';
        
        // Update wallet dropdown options
        this.updateTransferOptions();
        
        // Show modal
        this.elements.transferModal.style.display = 'flex';
    },
    
    /**
     * Hide transfer modal
     */
    hideTransferModal() {
        this.elements.transferModal.style.display = 'none';
        this.elements.walletDropdown.style.display = 'none';
    },
    
    /**
     * Toggle wallet dropdown in transfer modal
     */
    toggleWalletDropdown() {
        const isVisible = this.elements.walletDropdown.style.display === 'block';
        this.elements.walletDropdown.style.display = isVisible ? 'none' : 'block';
    },
    
    /**
     * Update transfer options in wallet dropdown
     */
    updateTransferOptions() {
        const state = appState.getState();
        const dropdown = this.elements.walletDropdown;
        
        // Clear existing options
        dropdown.innerHTML = '';
        
        // If we're in the main account, the destination can be Account 2 or external wallets
        if (state.currentAccount === 'main') {
            const option1 = document.createElement('div');
            option1.className = 'wallet-option';
            option1.setAttribute('role', 'option');
            option1.dataset.address = 'second';
            option1.textContent = 'Account 2';
            dropdown.appendChild(option1);
            
            const option2 = document.createElement('div');
            option2.className = 'wallet-option';
            option2.setAttribute('role', 'option');
            option2.dataset.address = Config.walletAddresses.external1;
            option2.textContent = `External Wallet (${Utils.truncateAddress(Config.walletAddresses.external1)})`;
            dropdown.appendChild(option2);
        } 
        // If we're in Account 2, the destination can be the main account or external wallet
        else if (state.currentAccount === 'second') {
            const option1 = document.createElement('div');
            option1.className = 'wallet-option';
            option1.setAttribute('role', 'option');
            option1.dataset.address = 'main';
            option1.textContent = 'Main Wallet';
            dropdown.appendChild(option1);
            
            const option2 = document.createElement('div');
            option2.className = 'wallet-option';
            option2.setAttribute('role', 'option');
            option2.dataset.address = Config.walletAddresses.external2;
            option2.textContent = `External Wallet (${Utils.truncateAddress(Config.walletAddresses.external2)})`;
            dropdown.appendChild(option2);
        }
        
        // Reattach click events
        document.querySelectorAll('.wallet-option').forEach(option => {
            option.addEventListener('click', () => {
                this.elements.walletAddressInput.value = option.dataset.address;
                this.elements.walletDropdown.style.display = 'none';
            });
        });
    },
    
    /**
     * Process token transfer from form
     */
    async processTransfer() {
        const state = appState.getState();
        const fromAccount = state.currentAccount;
        const toAddress = this.elements.walletAddressInput.value;
        const amount = parseFloat(this.elements.transferAmountInput.value);
        const token = state.currentToken;
        
        // Validate form inputs
        if (!toAddress) {
            this.showToast('Please enter a recipient address', 'error');
            return;
        }
        
        const amountValidation = WalletService.validateAmount(amount, token, fromAccount);
        if (!amountValidation.valid) {
            this.showToast(amountValidation.message, 'error');
            return;
        }
        
        // Hide transfer modal
        this.hideTransferModal();
        
        // Simulate transaction processing
        this.showLoading();
        
        // Display a loading message
        const initialLoader = document.getElementById('initial-loader');
        if (initialLoader) {
            initialLoader.style.display = 'flex';
            initialLoader.innerHTML = `
                <div style="display: flex; flex-direction: column; align-items: center;">
                    <div class="loading-spinner"></div>
                    <div style="color: white; margin-top: 16px; font-weight: 500;">Confirming Transaction</div>
                </div>
            `;
        }
        
        // Process the transfer
        const result = await WalletService.transferToken({
            from: fromAccount,
            to: toAddress,
            token,
            amount
        });
        
        if (initialLoader) {
            initialLoader.style.display = 'none';
        }
        
        if (result.success) {
            // Update UI
            this.updateBalanceDisplay();
            this.updateTokenList();
            this.updateTransactionHistory();
            
            // Show receipt
            this.showTransactionReceipt(result.transaction);
        } else {
            this.hideLoading();
            this.showToast(result.message, 'error');
        }
    },
    
    /**
     * Show transaction receipt modal
     * @param {Object} transaction - Transaction details
     */
    showTransactionReceipt(transaction) {
        const state = appState.getState();
        
        // Calculate USD value
        const amountUsd = transaction.amount * (state.tokenPrices[transaction.token] || 0);
        const feeValueUsd = transaction.fee * (state.tokenPrices[transaction.feeToken] || 0);
        
        // Format addresses for display
        let fromDisplay = transaction.from === 'main' ? 
            'Main Wallet' : (transaction.from === 'second' ? 'Account 2' : transaction.from);
        
        let toDisplay = transaction.to === 'main' ? 
            'Main Wallet' : (transaction.to === 'second' ? 'Account 2' : transaction.to);
        
        // Truncate Ethereum addresses
        if (fromDisplay.startsWith('0x') && fromDisplay.length > 10) {
            fromDisplay = `${Utils.truncateAddress(fromDisplay)}`;
        }
        
        if (toDisplay.startsWith('0x') && toDisplay.length > 10) {
            toDisplay = `${Utils.truncateAddress(toDisplay)}`;
        }
        
        // Update receipt modal content
        this.elements.receiptAmount.textContent = `${Utils.formatNumber(transaction.amount)} ${transaction.token}`;
        this.elements.receiptFiatAmount.textContent = Utils.formatCurrency(amountUsd);
        
        // Format date
        const formattedDate = Utils.formatDate(transaction.date, 'long');
        this.elements.receiptDate.textContent = formattedDate;
        
        this.elements.receiptFrom.textContent = fromDisplay;
        this.elements.receiptTo.textContent = toDisplay;
        
        // Format fee
        this.elements.receiptFee.textContent = `${transaction.fee} ${transaction.feeToken} (${Utils.formatCurrency(feeValueUsd)})`;
        
        // Format transaction hash
        const shortHash = Utils.truncateAddress(transaction.id, 4, 4);
        this.elements.receiptHashShort.textContent = shortHash;
        
        // Set transaction hash for copy and explorer
        this.elements.copyHashButton.dataset.hash = transaction.id;
        
        // Show the receipt modal
        this.elements.receiptModal.style.display = 'flex';
        
        // Hide loading overlay
        this.hideLoading();
    },
    
    /**
     * Hide receipt modal
     */
    hideReceiptModal() {
        this.elements.receiptModal.style.display = 'none';
    },
    
    /**
     * Get full name of token from symbol
     * @param {string} symbol - Token symbol
     * @returns {string} Full token name
     */
    getTokenFullName(symbol) {
        const tokenNames = {
            'USDT': 'Tether USD',
            'BNB': 'BNB',
            'BTC': 'Bitcoin',
            'ETH': 'Ethereum',
            'XRP': 'XRP'
        };
        
        return tokenNames[symbol] || symbol;
    }
};

                /**
 * app.js
 * Main application initialization
 */

// Main application
const App = {
    /**
     * Initialize the application
     */
    init() {
        // Initialize UI
        UI.init();
        
        // Initialize wallet service
        WalletService.init();
        
        // Set up global error handling
        this.setupErrorHandling();
        
        // Setup keyboard navigation
        this.setupAccessibility();
        
        // Splash screen transition
        this.startApp();
        
        // Auto force-start after 5 seconds if app appears stuck
        setTimeout(() => {
            if (document.getElementById('initial-loader') && 
                document.getElementById('initial-loader').style.display !== 'none') {
                console.warn('Application startup appears stuck, force starting...');
                this.forceStart();
            }
        }, 5000);
    },
    
    /**
     * Set up global error handling
     */
    setupErrorHandling() {
        window.onerror = (message, source, lineno, colno, error) => {
            console.error('Global error:', message, error);
            
            if (Config.app.debugMode) {
                UI.showToast(`Error: ${message}`, 'error');
            } else {
                UI.showToast('Something went wrong. Please try again.', 'error');
            }
            
            // Hide loading overlay if visible
            UI.hideLoading();
            
            return true; // Prevent default error handling
        };
        
        // Handle unhandled promise rejections
        window.addEventListener('unhandledrejection', event => {
            console.error('Unhandled promise rejection:', event.reason);
            
            if (Config.app.debugMode) {
                UI.showToast(`Promise error: ${event.reason}`, 'error');
            }
            
            // Hide loading overlay if visible
            UI.hideLoading();
        });
    },
    
    /**
     * Set up keyboard navigation and accessibility
     */
    setupAccessibility() {
        // Add focus trap for modals
        const trapFocus = (element) => {
            const focusableElements = element.querySelectorAll(
                'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
            );
            
            if (focusableElements.length === 0) return;
            
            const firstElement = focusableElements[0];
            const lastElement = focusableElements[focusableElements.length - 1];
            
            element.addEventListener('keydown', (e) => {
                if (e.key === 'Tab') {
                    if (e.shiftKey) {
                        if (document.activeElement === firstElement) {
                            lastElement.focus();
                            e.preventDefault();
                        }
                    } else {
                        if (document.activeElement === lastElement) {
                            firstElement.focus();
                            e.preventDefault();
                        }
                    }
                }
            });
        };
        
        // Apply focus trap to modals
        trapFocus(document.getElementById('transfer-modal'));
        trapFocus(document.getElementById('receipt-modal'));
        trapFocus(document.getElementById('timeout-dialog'));
        
        // Add ESC key handler for modals
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                // Close any open modal
                if (document.getElementById('transfer-modal').style.display === 'flex') {
                    UI.hideTransferModal();
                }
                
                if (document.getElementById('receipt-modal').style.display === 'flex') {
                    UI.hideReceiptModal();
                }
            }
        });
    },
    
    /**
     * Start the application
     */
    startApp() {
        // Remove initial loader if present
        if (document.getElementById('initial-loader')) {
            document.getElementById('initial-loader').style.display = 'none';
        }
        
        // Mark body as loaded to trigger fade-in
        document.body.classList.add('loaded');
        
        // Handle splash screen
        const splashScreen = document.getElementById('splash-screen');
        if (splashScreen) {
            // Delay for better UX
            setTimeout(() => {
                splashScreen.style.opacity = 0;
                setTimeout(() => {
                    splashScreen.style.display = 'none';
                    
                    // Go directly to passcode screen
                    UI.showScreen('passcode');
                }, 300);
            }, 1500);
        } else {
            // If no splash screen, show passcode directly
            UI.showScreen('passcode');
        }
    },
    
    /**
     * Force start the application (used if app appears stuck)
     */
    forceStart() {
        console.log('Application force-started');
        
        if (document.getElementById('initial-loader')) {
            document.getElementById('initial-loader').style.display = 'none';
        }
        
        if (document.getElementById('splash-screen')) {
            document.getElementById('splash-screen').style.display = 'none';
        }
        
        // Show passcode screen
        UI.showScreen('passcode');
        
        document.body.classList.add('loaded');
    }
};

// Initialize app when DOM is loaded
document.addEventListener('DOMContentLoaded', () => {
    App.init();
});

/**
 * manifest.json
 * Progressive Web App manifest
 */
/* 
{
  "name": "Trust Wallet",
  "short_name": "Trust",
  "description": "Secure crypto wallet for digital assets",
  "start_url": "/",
  "display": "standalone",
  "background_color": "#0B65C6",
  "theme_color": "#0B65C6",
  "icons": [
    {
      "src": "assets/icon-192.png",
      "sizes": "192x192",
      "type": "image/png",
      "purpose": "any maskable"
    },
    {
      "src": "assets/icon-512.png",
      "sizes": "512x512",
      "type": "image/png",
      "purpose": "any maskable"
    }
  ]
}
