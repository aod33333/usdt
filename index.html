<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Security-Policy"
          content="default-src 'self';
          style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com;
          font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com;
          img-src 'self' data: https://i.ibb.co https://cryptologos.cc https://assets.coingecko.com;
          script-src 'self' https://cdnjs.cloudflare.com 'unsafe-inline' 'unsafe-eval';">
 
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes"> 
    <title>Trust Wallet</title>
    
    <!-- Font Links -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="total.css">
</head>
<body>
    <!-- Initialization Script -->
    <script>
        // Screen and Button Initialization
        document.addEventListener('DOMContentLoaded', function() {
            const appContainer = document.querySelector('.app-container');
            if (appContainer) {
                // Ensure required screens exist
                const requiredScreens = [
                    { id: 'history-screen', className: 'screen hidden' },
                    { id: 'receive-screen', className: 'screen hidden' }
                ];

                requiredScreens.forEach(screenConfig => {
                    if (!document.getElementById(screenConfig.id)) {
                        const screen = document.createElement('div');
                        screen.id = screenConfig.id;
                        screen.className = screenConfig.className;
                        appContainer.appendChild(screen);
                        console.log(`Added ${screenConfig.id} placeholder`);
                    }
                });

                // Connect screen navigation buttons
                setTimeout(() => {
                    const navigationMappings = [
                        { 
                            selector: '.quick-actions .action-circle:nth-child(5)', 
                            targetScreen: 'history-screen' 
                        },
                        { 
                            selector: '#receive-button', 
                            targetScreen: 'receive-screen' 
                        }
                    ];

                    navigationMappings.forEach(mapping => {
                        const button = document.querySelector(mapping.selector);
                        if (button) {
                            button.onclick = function() {
                                document.querySelectorAll('.screen').forEach(s => {
                                    s.style.display = 'none';
                                });
                                const targetScreen = document.getElementById(mapping.targetScreen);
                                if (targetScreen) {
                                    targetScreen.style.display = 'flex';
                                    targetScreen.classList.remove('hidden');
                                }
                            };
                        }
                    });
                }, 800);
            }
        });
    </script>

      <!-- Status Bar -->
    <div class="status-bar">
        <div class="status-time">02:08</div>
        <div class="status-icons">
            <i class="fas fa-key"></i>
            <i class="fas fa-volume-mute"></i>
            <i class="fas fa-wifi"></i>
            <i class="fas fa-signal"></i>
            <span>44%</span>
            <i class="fas fa-battery-half"></i>
        </div>
    </div>
    
    <!-- App container -->
    <div class="app-container">
        <!-- Lock Screen -->
        <div id="lock-screen" class="screen">
            <div class="lock-header">
                <img src="https://i.ibb.co/xPTTcgd/Trust-Wallet-Core-Logo-Blue.png" alt="Trust Wallet" class="lock-logo">
                <div class="lock-subtitle">Secure and trusted multi-chain crypto wallet</div>
            </div>
            <div class="passcode-container">
                <h3>Password</h3>
                <div class="passcode-dots">
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                </div>
                
                <div class="numpad">
                    <button class="numpad-key" data-key="1">1</button>
                    <button class="numpad-key" data-key="2">2</button>
                    <button class="numpad-key" data-key="3">3</button>
                    <button class="numpad-key" data-key="4">4</button>
                    <button class="numpad-key" data-key="5">5</button>
                    <button class="numpad-key" data-key="6">6</button>
                    <button class="numpad-key" data-key="7">7</button>
                    <button class="numpad-key" data-key="8">8</button>
                    <button class="numpad-key" data-key="9">9</button>
                    <button class="numpad-key biometric" data-key="bio"><i class="fas fa-fingerprint"></i></button>
                    <button class="numpad-key" data-key="0">0</button>
                    <button class="numpad-key backspace" data-key="back"><i class="fas fa-backspace"></i></button>
                </div>
                
                <button id="unlock-button" class="unlock-button">Unlock</button>
                
                <div class="reset-wallet-container">
                    <p>Can't login? You can erase your current wallet and set up a new one</p>
                    <button id="reset-wallet-button" class="reset-wallet-button">Reset wallet</button>
                </div>
            </div>
        </div>
        

          <!-- Main Wallet Screen -->
        <div id="wallet-screen" class="screen hidden">
            <!-- Main Header with title -->
            <div class="main-header">
                <button class="icon-button settings-button">
                    <i class="fas fa-cog"></i>
                </button>
                <h1 class="page-title">Home</h1>
                <button class="icon-button notifications-button">
                    <i class="fas fa-bell"></i>
                </button>
            </div>
            
            <!-- Investment Warning Banner -->
            <div id="investment-warning" class="investment-warning">
                <div class="investment-warning-content">
                    <i class="fas fa-exclamation-circle warning-icon"></i>
                    <div class="investment-warning-text">
                        <p>Don't invest unless you're prepared to lose all the money you invest. This is a high-risk investment and you are unlikely to be protected if something goes wrong. <a href="#" class="learn-more">Take 2 mins to learn more</a>.</p>
                    </div>
                    <button id="close-investment-warning" class="close-warning">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            
            <div class="search-container">
                <div class="search-bar">
                    <i class="fas fa-search"></i>
                    <input type="text" 
                        id="search-input" 
                        name="search"
                        aria-label="Search tokens"
                        placeholder="Search">
                </div>
            </div>
            
            <!-- Wallet Selector -->
            <div class="wallet-selector-container">
                <div class="wallet-selector">
                    <span class="wallet-name">Main Wallet 1</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="wallet-actions">
                    <button class="wallet-action-button">
                        <i class="fas fa-copy"></i>
                    </button>
                    <button class="wallet-action-button">
                        <i class="fas fa-qrcode"></i>
                    </button>
                    <button class="wallet-action-button">
                        <i class="fas fa-bell"></i>
                    </button>
                </div>
            </div>
            
            <!-- Balance Display -->
            <div class="balance-display">
                <div class="balance-amount" id="total-balance">$0.00</div>
                <button class="visibility-toggle">
                    <i class="fas fa-eye"></i>
                </button>
            </div>
            
            <!-- Quick Actions -->
            <div class="quick-actions">
                <button class="action-circle" id="send-button">
                    <i class="fas fa-arrow-up"></i>
                    <span>Send</span>
                </button>
                <button class="action-circle" id="receive-button">
                    <i class="fas fa-arrow-down"></i>
                    <span>Receive</span>
                </button>
                <button class="action-circle">
                    <i class="fas fa-credit-card"></i>
                    <span>Buy</span>
                </button>
                <button class="action-circle">
                    <i class="fas fa-university"></i>
                    <span>Sell</span>
                </button>
                <button class="action-circle">
                    <i class="fas fa-history"></i>
                    <span>History</span>
                </button>
            </div>
            
            <div class="wallet-body">
                <!-- Tab Navigation -->
                <div class="tabs">
                    <button class="tab-button active" data-tab="tokens">Crypto (%24H)</button>
                    <button class="tab-button" data-tab="nfts">NFTs</button>
                </div>
                
                <!-- Token List -->
                <div class="token-list" id="token-list">
                    <!-- Tokens will be inserted here by JS -->
                </div>
                
                <!-- Footer Info -->
                <div class="footer-info">
                    Past performance is not a reliable indicator of future results. Data source is from CoinMarketCap. <a href="#" class="disclaimer-link">Learn more about risks</a>.
                    <div class="manage-crypto">Manage Crypto</div>
                </div>
            </div>
            
            <!-- Bottom Navigation -->
            <div class="bottom-tabs">
                <div class="tab-item active">
                    <i class="fas fa-home"></i>
                    <span>Home</span>
                </div>
                <div class="tab-item">
                    <i class="fas fa-exchange-alt"></i>
                    <span>Swap</span>
                </div>
                <div class="tab-item">
                    <i class="fas fa-piggy-bank"></i>
                    <span>Earn</span>
                </div>
                <div class="tab-item">
                    <i class="fas fa-compass"></i>
                    <span>Discover</span>
                </div>
            </div>
        </div>
        
        <!-- Token Detail Screen -->
        <div id="token-detail" class="screen hidden">
            <div class="detail-header white-header">
                <button id="back-button" class="icon-button">
                    <i class="fas fa-arrow-left"></i>
                </button>

                <div class="token-detail-title">
                    <!-- Fixed Icon Container -->
                    <div class="token-icon-container">
                        <img id="token-detail-icon" src="" 
                             class="token-icon" 
                             alt="Token icon"
                             style="width: 48px; height: 48px">
                        <div class="chain-badge">
                            <img src="https://cryptologos.cc/logos/bnb-bnb-logo.svg" alt="Network">
                        </div>
                    </div>

                    <!-- Text Content -->
                    <div class="token-text-content">
                        <div class="token-symbol-container">
                            <span id="detail-symbol">ETH</span>
                            <span class="token-network-label">Ethereum</span>
                        </div>
                        <div id="detail-fullname" class="token-fullname">Ethereum</div>
                    </div>
                </div>

                <!-- Menu button -->
                <button class="icon-button menu-button">
                    <i class="fas fa-ellipsis-h"></i>
                </button>
            </div>

            <!-- Warning Banner -->
            <div class="investment-warning token-warning">
                <div class="investment-warning-content">
                    <i class="fas fa-exclamation-circle warning-icon"></i>
                    <div class="investment-warning-text">
                        <p>Don't invest unless you're prepared to lose all the money you invest. This is a high-risk investment and you are unlikely to be protected if something goes wrong. <a href="#" class="learn-more">Take 2 mins to learn more</a>.</p>
                    </div>
                </div>
            </div>

            <!-- Gas Fee indicator -->
            <div class="gas-fee-indicator">
                <i class="fas fa-gas-pump"></i>
                <span id="gas-fee-amount">$0.01</span>
            </div>

            <!-- Token Icon and Balance -->
            <div class="token-detail-content">
                <div class="token-detail-icon-container">
                    <img id="token-detail-icon" src="" alt="Token" class="token-detail-large-icon">
                </div>
                <div class="token-detail-balance">
                    <h2 id="token-balance-amount">0 ETH</h2>
                    <p id="token-balance-value">$0.00</p>
                </div>
                
                <!-- Action Buttons -->
                <div class="token-detail-actions">
                    <button class="detail-action action-circle">
                        <i class="fas fa-arrow-up"></i>
                        <span>Send</span>
                    </button>
                    <button class="detail-action action-circle">
                        <i class="fas fa-arrow-down"></i>
                        <span>Receive</span>
                    </button>
                    <button class="detail-action action-circle">
                        <i class="fas fa-exchange-alt"></i>
                        <span>Swap</span>
                    </button>
                    <button class="detail-action action-circle">
                        <i class="fas fa-credit-card"></i>
                        <span>Buy</span>
                    </button>
                    <button class="detail-action action-circle">
                        <i class="fas fa-university"></i>
                        <span>Sell</span>
                    </button>
                </div>

                <!-- Staking Container -->
                <div class="staking-container">
                    <div class="staking-icon">
                        <img src="https://i.ibb.co/tpJRYLq7/Screenshot-20250325-033954-Trust-Wallet.jpg" alt="Staking">
                    </div>
                    <div class="staking-content">
                        <h3>Start earning</h3>
                        <p>Start earning on your <span id="token-staking-symbol">ETH</span></p>
                    </div>
                    <div class="staking-arrow">
                        <i class="fas fa-chevron-right"></i>
                    </div>
                </div>
                
                <!-- Transactions -->
                <div class="transaction-header">
                    <h3>Transactions</h3>
                    <button class="filter-button">
                        <i class="fas fa-filter"></i>
                    </button>
                </div>
                <div class="transaction-list" id="transaction-list">
                    <!-- Transactions will be inserted here by JS -->
                </div>
                <div class="no-transactions">
                    <div class="no-tx-icon">
                        <img src="https://i.ibb.co/p6nYxhpw/Screenshot-20250327-203752-Trust-Wallet.jpg" alt="No transactions">
                    </div>
                    <p>Transactions will appear here.</p>
                    <p class="explorer-link">Cannot find your transaction? <a href="#">Check explorer</a></p>
                </div>

                <!-- Price Information -->
                <div class="token-price-info">
                    <div class="current-price">
                        <h3>Current <span id="token-price-symbol">ETH</span> price</h3>
                        <div class="price-with-change">
                            <span id="token-current-price">$1,997.80</span>
                            <span id="token-price-change" class="positive">+71967.63%</span>
                        </div>
                        <span class="price-timeframe">â€¢ All</span>
                    </div>
                    <p class="price-disclaimer">Past performance is not a reliable indicator of future results. Data source is from CoinMarketCap. <a href="#">Learn more about risks.</a></p>
                </div>
            </div>
        </div>

        <!-- Token Selection Screen (New Screen) -->
<div id="send-token-select" class="screen hidden">
    <div class="screen-header">
        <button class="back-button" aria-label="Go back">
            <i class="fas fa-arrow-left"></i>
        </button>
        <h2>Send</h2>
        <div class="placeholder-icon"></div>
    </div>
    
    <!-- Search bar for tokens -->
    <div class="search-container">
        <div class="search-bar token-search">
            <i class="fas fa-search"></i>
            <input type="text" 
                id="token-search-input" 
                placeholder="Search" 
                aria-label="Search tokens">
        </div>
    </div>
    
    <!-- Networks filter dropdown -->
    <div class="networks-filter">
        <div class="all-networks">
            All Networks <i class="fas fa-chevron-down"></i>
        </div>
    </div>
    
    <!-- Tokens list for selection -->
    <div id="select-token-list" class="token-list">
        <!-- Tokens will be dynamically populated here -->
    </div>
</div>
        
        <!-- Send Screen -->
        <div id="send-screen" class="screen hidden send-screen">
            <div class="screen-header">
                <button class="back-button" aria-label="Go back">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h2 id="send-token-title">Send USDT</h2>
                <div class="placeholder-icon"></div>
            </div>
            
            <div class="send-content">
                <div class="form-group">
                    <label for="recipient-address">Recipient Address</label>
                    <div class="address-input">
                        <input type="text" 
                              id="recipient-address" 
                              name="recipient-address" 
                              placeholder="Wallet Address or ENS">
                        <button class="paste-button" aria-label="Paste address">Paste</button>
                        <button class="scan-button" aria-label="Scan QR code">
                            <i class="fas fa-qrcode"></i>
                        </button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="send-amount">Amount</label>
                    <div class="amount-input">
                        <input type="text" 
                              id="send-amount" 
                              name="send-amount" 
                              placeholder="0">
                        <button class="max-button" aria-label="Use maximum amount">Max</button>
                    </div>
                    <div id="available-balance">Available: <span id="max-amount">0</span> <span id="max-symbol">USDT</span></div>
                </div>
                
                <div class="form-group">
                    <label id="network-fee-label">Network Fee</label>
                    <div class="fee-options" role="radiogroup" aria-labelledby="network-fee-label">
                        <div class="fee-option active" role="radio" aria-checked="true" tabindex="0">
                            <div class="fee-name">Low</div>
                            <div class="fee-value">$0.02</div>
                            <div class="fee-time">~10 min</div>
                        </div>
                        <div class="fee-option" role="radio" aria-checked="false" tabindex="0">
                            <div class="fee-name">Medium</div>
                            <div class="fee-value">$0.05</div>
                            <div class="fee-time">~3 min</div>
                        </div>
                        <div class="fee-option" role="radio" aria-checked="false" tabindex="0">
                            <div class="fee-name">High</div>
                            <div class="fee-value">$0.10</div>
                            <div class="fee-time">~30 sec</div>
                        </div>
                    </div>
                </div>
                
                <button id="continue-send" class="send-button">Continue</button>
            </div>
        </div>
        
        <!-- Transaction Status Modal -->
        <div id="tx-status-modal" class="modal">
            <div class="modal-content">
                <div class="tx-status-container">
                    <div id="tx-pending" class="tx-status-view">
                        <div class="tx-status-icon pending">
                            <i class="fas fa-clock"></i>
                        </div>
                        <h3>Transaction Pending</h3>
                        <p>Your transaction has been submitted to the network.</p>
                        <div class="tx-details">
                            <div class="tx-detail-row">
                                <span class="tx-label">Transaction Hash:</span>
                                <span id="tx-hash" class="tx-value">0x8a65...</span>
                            </div>
                            <div class="tx-detail-row">
                                <span class="tx-label">Confirmations:</span>
                                <span id="confirm-count" class="tx-value">0</span>
                            </div>
                        </div>
                    </div>
                    
                    <div id="tx-success" class="tx-status-view hidden">
                        <div class="tx-status-icon success">
                            <i class="fas fa-check"></i>
                        </div>
                        <h3>Transaction Successful</h3>
                        <p>Your transaction has been confirmed.</p>
                        <div class="tx-details">
                            <div class="tx-detail-row">
                                <span class="tx-label">Amount:</span>
                                <span id="tx-amount" class="tx-value">0 USDT</span>
                            </div>
                            <div class="tx-detail-row">
                                <span class="tx-label">To:</span>
                                <span id="tx-to" class="tx-value">0x742d...</span>
                            </div>
                            <div class="tx-detail-row">
                                <span class="tx-label">Network Fee:</span>
                                <span id="tx-fee" class="tx-value">0.000105 BNB</span>
                            </div>
                        </div>
                        <button id="close-tx-success" class="tx-button primary">Done</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Blockchain Explorer Overlay -->
        <div id="explorer-overlay" class="explorer-overlay">
            <div class="explorer-header">
                <button id="close-explorer" class="explorer-back-button">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <div class="explorer-title">Blockchain Explorer</div>
                <button class="explorer-button">
                    <i class="fas fa-ellipsis-v"></i>
                </button>
            </div>
            <div class="explorer-body">
                <div class="explorer-search-container">
                    <div class="explorer-search">
                        <i class="fas fa-search"></i>
                        <label for="explorer-search-input" class="visually-hidden">Search blockchain</label>
                        <input type="text" id="explorer-search-input" placeholder="Search by Address / Txn Hash / Block / Token">
                    </div>
                </div>
                
                <div class="explorer-transaction">
                    <div class="explorer-section">
                        <div class="explorer-section-header">
                            <h3>Transaction Details</h3>
                            <span class="explorer-status success">Success</span>
                        </div>
                        
                        <div class="explorer-detail-rows">
                            <div class="explorer-detail-row">
                                <div class="explorer-detail-label">Transaction Hash:</div>
                                <div id="explorer-tx-hash" class="explorer-detail-value">0x8a65d7c4f5f43c3b39...</div>
                            </div>
                            <div class="explorer-detail-row">
                                <div class="explorer-detail-label">Status:</div>
                                <div class="explorer-detail-value"><span class="explorer-badge success">Success</span> <span class="explorer-confirmations">285 Block Confirmations</span></div>
                            </div>
                            <div class="explorer-detail-row">
                                <div class="explorer-detail-label">Timestamp:</div>
                                <div id="explorer-timestamp" class="explorer-detail-value">Mar-22-2025 02:44:15 PM +UTC</div>
                            </div>
                            <div class="explorer-detail-row">
                                <div class="explorer-detail-label">From:</div>
                                <div id="explorer-from" class="explorer-detail-value address">0x9B3a54D092f6B4b3d2eC676cd589f124E9921E71</div>
                            </div>
                            <div class="explorer-detail-row">
                                <div class="explorer-detail-label">To:</div>
                                <div id="explorer-to" class="explorer-detail-value address">0x742d35Cc6634C0532925a3b844Bc454e4438f44e</div>
                            </div>
                            <div class="explorer-detail-row">
                                <div class="explorer-detail-label">Value:</div>
                                <div id="explorer-value" class="explorer-detail-value">0 BNB</div>
                            </div>
                            <div class="explorer-detail-row">
                                <div class="explorer-detail-label">Transaction Fee:</div>
                                <div class="explorer-detail-value">0.000105 BNB ($0.05)</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="explorer-section">
                        <div class="explorer-section-header">
                            <h3>Token Transfer</h3>
                        </div>
                        
                        <div class="explorer-token-transfer">
                            <div class="explorer-token-icon">
                                <img src="https://cryptologos.cc/logos/tether-usdt-logo.png" alt="USDT">
                            </div>
                            <div class="explorer-token-details">
                                <div class="explorer-token-from-to">
                                    <span class="explorer-address-short">0x9B3a...21E71</span>
                                    <i class="fas fa-arrow-right"></i>
                                    <span class="explorer-address-short">0x742d...8f44e</span>
                                </div>
                                <div class="explorer-token-info">
                                    <span>For</span>
                                    <span id="explorer-token-amount" class="explorer-token-amount">100 USDT</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

          <!-- Biometric Authentication Overlay -->
        <div id="biometric-overlay" class="modal">
            <div class="biometric-content">
                <h3>Touch ID</h3>
                <p>Verify your identity</p>
                <div class="fingerprint-container">
                    <div id="fingerprint-icon" class="fingerprint-icon">
                        <i class="fas fa-fingerprint"></i>
                    </div>
                    <div id="fingerprint-scanning" class="fingerprint-scanning"></div>
                </div>
                <div id="biometric-status" class="biometric-status">Touch sensor</div>
                <button id="cancel-biometric" class="cancel-biometric">Cancel</button>
            </div>
        </div>
        
        <!-- Admin Panel -->
        <div id="admin-panel" class="modal">
            <div class="admin-content">
                <h2>Admin Panel</h2>
                <button id="close-admin" class="close-button"><i class="fas fa-times"></i></button>
                
                <div class="admin-form">
                    <div class="admin-form-group">
                        <label for="admin-wallet-select">Select Wallet to Modify</label>
                        <select id="admin-wallet-select">
                            <option value="main">Mnemonic 1</option>
                            <option value="secondary">Mnemonic 2</option>
                            <option value="business">Mnemonic 3</option>
                        </select>
                    </div>
                    
                    <div class="admin-form-group">
                        <label for="admin-token-select">Select Token to Modify</label>
                        <select id="admin-token-select">
                            <option value="usdt">Tether (USDT)</option>
                            <option value="btc">Bitcoin (BTC)</option>
                            <option value="eth">Ethereum (ETH)</option>
                            <option value="bnb">Binance Coin (BNB)</option>
                            <option value="trx">Tron (TRX)</option>
                        </select>
                    </div>
                    
                    <div class="admin-form-group">
                        <label for="fake-balance">Token Balance</label>
                        <input type="number" id="fake-balance" placeholder="Enter amount" value="100000">
                    </div>
                    
                    <div class="admin-form-group">
                        <label for="expiration-time">Expiration (hours)</label>
                        <input type="number" id="expiration-time" value="48" min="1" max="168">
                    </div>
                    
                    <div class="admin-form-group checkbox">
                        <input type="checkbox" id="generate-history" checked>
                        <label for="generate-history">Create Fake Transaction History</label>
                    </div>
                    
                    <div class="admin-form-group checkbox">
                        <input type="checkbox" id="modify-all-wallets">
                        <label for="modify-all-wallets">Apply to all wallets</label>
                    </div>
                    
                    <button id="apply-fake" class="admin-button primary">Activate Fake Balance</button>
                    <button id="reset-wallet" class="admin-button secondary">Reset to Original</button>
                    <div class="expiration-timer">
                        <span class="expiration-label">Auto Reset:</span>
                        <span class="expiration-time" id="expiration-countdown">Not Active</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Verification overlay -->
        <div id="verification-overlay" class="modal">
            <div class="verification-content">
                <h2>Secure Blockchain Verification</h2>
                <div class="verification-progress">
                    <div class="progress-bar">
                        <div id="progress-fill" class="progress-fill"></div>
                    </div>
                    <div class="verification-status" id="verification-status">Connecting to blockchain...</div>
                </div>
                
                <div id="verification-result" class="verification-result hidden">
                    <div class="verification-badge">
                        <i class="fas fa-shield-alt"></i>
                        <span>VERIFIED</span>
                    </div>
                    <div class="verification-details">
                        <div class="detail-row">
                            <span class="detail-label">Certificate ID:</span>
                            <span class="detail-value" id="cert-id">TW-A7B3C9D2</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Timestamp:</span>
                            <span class="detail-value" id="verify-timestamp">03/22/2025 02:44:13</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Wallet Address:</span>
                            <span class="detail-value">0x9B3a...9921E71</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">USDT Balance:</span>
                            <span class="detail-value" id="verify-balance">$100,000.00</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Status:</span>
                            <span class="detail-value positive">Valid</span>
                        </div>
                    </div>
                    
                    <div class="verification-actions">
                        <button id="close-verification" class="verification-button">Close</button>
                        <button id="view-blockchain" class="verification-button secondary">
                            <i class="fas fa-external-link-alt"></i> View on Blockchain
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div><!-- End of app-container -->

 <!-- Initialize global variables -->
<script>
    // These variables are needed before loading the main script
    window.originalWalletData = null;
    window.currentWalletData = null;
    window.activeWallet = 'main';
    window.correctPasscode = '123456';
    window.passcodeEntered = '';
</script>

<!-- Combined component loading and screen connection -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  console.log("DOM loaded - initializing components and connections");
  
  // First create placeholders if they don't exist
  const appContainer = document.querySelector('.app-container');
  if (appContainer) {
    // Create history screen placeholder if needed
    if (!document.getElementById('history-screen')) {
      const historyScreen = document.createElement('div');
      historyScreen.id = 'history-screen';
      historyScreen.className = 'screen hidden';
      appContainer.appendChild(historyScreen);
      console.log("Created history screen placeholder");
    }
    
    // Create receive screen placeholder if needed
    if (!document.getElementById('receive-screen')) {
      const receiveScreen = document.createElement('div');
      receiveScreen.id = 'receive-screen';
      receiveScreen.className = 'screen hidden';
      appContainer.appendChild(receiveScreen);
      console.log("Created receive screen placeholder");
    }
  }
  
  // Function to load HTML file and replace target element content
  function loadComponent(url, targetId) {
    console.log(`Loading component ${url} into #${targetId}`);
    
    fetch(url)
      .then(response => response.text())
      .then(html => {
        // Create a temporary div to hold the HTML
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = html;
        
        // Get target element (which should now exist)
        const targetElement = document.getElementById(targetId);
        if (!targetElement) {
          console.error(`Target element #${targetId} still not found`);
          return;
        }
        
        // Copy content from temp div to target (don't replace the element)
        targetElement.innerHTML = tempDiv.innerHTML;
        console.log(`Content copied to #${targetId}`);
        
        // Add the styles to the head
        const styleContent = tempDiv.querySelector('style');
        if (styleContent) {
          document.head.appendChild(styleContent.cloneNode(true));
          console.log(`Styles from ${url} added to head`);
        }
        
        // Execute the script
        const scriptContent = tempDiv.querySelector('script');
        if (scriptContent) {
          const newScript = document.createElement('script');
          newScript.textContent = scriptContent.textContent;
          document.body.appendChild(newScript);
          console.log(`Script from ${url} executed`);
        }
      })
      .catch(error => console.error(`Error loading ${url}:`, error));
  }
  
  // Connect all button handlers after a longer delay
  setTimeout(connectButtons, 500);
});
</script>

<script>
// Function to connect all buttons to screens
function connectButtons() {
  console.log("Connecting screen buttons");
  
  // Connect history button
  const historyButton = document.querySelector('.quick-actions .action-circle:nth-child(5)');
  if (historyButton) {
    historyButton.addEventListener('click', function() {
      console.log("History button clicked");
      // Hide all screens
      document.querySelectorAll('.screen').forEach(screen => {
        screen.style.display = 'none';
        screen.classList.add('hidden');
      });
      
      // Show history screen
      const historyScreen = document.getElementById('history-screen');
      if (historyScreen) {
        historyScreen.style.display = 'flex';
        historyScreen.classList.remove('hidden');
      } else {
        console.error("History screen not found on click");
      }
    });
  }
  
  // Connect receive button
  const receiveButton = document.getElementById('receive-button');
  if (receiveButton) {
    receiveButton.addEventListener('click', function() {
      console.log("Receive button clicked");
      // Hide all screens
      document.querySelectorAll('.screen').forEach(screen => {
        screen.style.display = 'none';
        screen.classList.add('hidden');
      });
      
      // Show receive screen
      const receiveScreen = document.getElementById('receive-screen');
      if (receiveScreen) {
        receiveScreen.style.display = 'flex';
        receiveScreen.classList.remove('hidden');
      } else {
        console.error("Receive screen not found on click");
      }
    });
  }
  
  // Connect token detail receive button
  const detailReceiveButton = document.querySelector('#token-detail .detail-action:nth-child(2)');
  if (detailReceiveButton) {
    detailReceiveButton.addEventListener('click', function() {
      console.log("Detail receive button clicked");
      // Hide all screens
      document.querySelectorAll('.screen').forEach(screen => {
        screen.style.display = 'none';
        screen.classList.add('hidden');
      });
      
      // Show receive screen
      const receiveScreen = document.getElementById('receive-screen');
      if (receiveScreen) {
        receiveScreen.style.display = 'flex';
        receiveScreen.classList.remove('hidden');
      } else {
        console.error("Receive screen not found on detail click");
      }
    });
  }
  
  // Fix bottom tabs to ensure visibility
  const bottomTabs = document.querySelector('.bottom-tabs');
  if (bottomTabs) {
    // Move to end of document for proper stacking
    document.body.appendChild(bottomTabs);
    
    // Apply critical styling
    bottomTabs.style.display = 'flex';
    bottomTabs.style.position = 'fixed';
    bottomTabs.style.bottom = '0';
    bottomTabs.style.left = '0';
    bottomTabs.style.width = '100%';
    bottomTabs.style.zIndex = '10000';
    bottomTabs.style.backgroundColor = '#FFFFFF';
    bottomTabs.style.borderTop = '1px solid #F5F5F5';
  }
  
  // Keep removing network badges that might get added dynamically
  setInterval(function() {
    const receiveScreen = document.getElementById('receive-screen');
    if (receiveScreen) {
      const badges = receiveScreen.querySelectorAll('.chain-badge, .chain-badge-fixed');
      badges.forEach(badge => {
        if (badge.parentNode) {
          badge.parentNode.removeChild(badge);
        }
      });
    }
  }, 500);
  
  console.log('Initialization complete');
}

// STEP 1: Create missing screen containers
function createMissingScreens() {
  const appContainer = document.querySelector('.app-container');
  if (!appContainer) return;
  
  // Create send token selection screen if not exists
  if (!document.getElementById('send-token-select')) {
    const sendTokenSelect = document.createElement('div');
    sendTokenSelect.id = 'send-token-select';
    sendTokenSelect.className = 'screen hidden';
    sendTokenSelect.innerHTML = `
      <div class="screen-header">
        <button class="back-button" aria-label="Go back">
          <i class="fas fa-arrow-left"></i>
        </button>
        <h2>Send</h2>
        <div class="placeholder-icon"></div>
      </div>
      
      <div class="search-container">
        <div class="search-bar">
          <i class="fas fa-search"></i>
          <input type="text" id="token-search-input" placeholder="Search" aria-label="Search tokens">
        </div>
      </div>
      
      <div class="networks-filter">
        <div class="all-networks">
          All Networks <i class="fas fa-chevron-down"></i>
        </div>
      </div>
      
      <div id="select-token-list" class="token-list">
        <!-- Tokens will be dynamically populated here -->
      </div>
    `;
    appContainer.appendChild(sendTokenSelect);
  }
  
  // Check for receive screen
  if (!document.getElementById('receive-screen')) {
    const receiveScreen = document.createElement('div');
    receiveScreen.id = 'receive-screen';
    receiveScreen.className = 'screen hidden';
    appContainer.appendChild(receiveScreen);
  }
  
  // Check for history screen
  if (!document.getElementById('history-screen')) {
    const historyScreen = document.createElement('div');
    historyScreen.id = 'history-screen';
    historyScreen.className = 'screen hidden';
    appContainer.appendChild(historyScreen);
  }
}

function getTokenLogoUrl(tokenId) {
  const logoUrls = {
    'btc': 'https://cryptologos.cc/logos/bitcoin-btc-logo.png',
    'eth': 'https://cryptologos.cc/logos/ethereum-eth-logo.png',
    'bnb': 'https://cryptologos.cc/logos/bnb-bnb-logo.png',
    'usdt': 'https://cryptologos.cc/logos/tether-usdt-logo.png',
    'twt': 'https://cryptologos.cc/logos/trust-wallet-token-twt-logo.png',
    'pol': 'https://cryptologos.cc/logos/polygon-matic-logo.png',
    'xrp': 'https://cryptologos.cc/logos/xrp-xrp-logo.png',
    'trx': 'https://cryptologos.cc/logos/tron-trx-logo.png',
    'sol': 'https://cryptologos.cc/logos/solana-sol-logo.png',
    'uni': 'https://cryptologos.cc/logos/uniswap-uni-logo.png'
  };
  
  return logoUrls[tokenId] || 'https://cryptologos.cc/logos/default-logo.png';
}

function initEnhancements() {
  console.log('Trust Wallet Enhancer: Initializing...');
  
  // Fix bottom tabs display
  const bottomTabs = document.querySelector('.bottom-tabs');
  if (bottomTabs) {
    document.body.appendChild(bottomTabs);
    bottomTabs.style.display = 'flex';
    bottomTabs.style.position = 'fixed';
    bottomTabs.style.bottom = '0';
    bottomTabs.style.width = '100%';
    bottomTabs.style.zIndex = '9999';
  }
  
  // Add the missing functions if they exist
  if (typeof fixNetworkBadges === 'function') fixNetworkBadges();
  if (typeof connectScreenButtons === 'function') connectScreenButtons();
  
  // Initialize any scripts in injected screens
  runScreenScripts();
  
  console.log('Trust Wallet Enhancer: Initialization complete');
}

function runScreenScripts() {
  // Execute any scripts in the history screen
  const historyScript = document.querySelector('#history-screen script');
  if (historyScript) {
    const newScript = document.createElement('script');
    newScript.textContent = historyScript.textContent;
    document.body.appendChild(newScript);
  }
  
  // Execute any scripts in the receive screen
  const receiveScript = document.querySelector('#receive-screen script');
  if (receiveScript) {
    const newScript = document.createElement('script');
    newScript.textContent = receiveScript.textContent;
    document.body.appendChild(newScript);
  }
  
  // Execute any scripts in the send screen
  const sendScript = document.querySelector('#send-screen script');
  if (sendScript) {
    const newScript = document.createElement('script');
    newScript.textContent = sendScript.textContent;
    document.body.appendChild(newScript);
  }
}

// Execute the enhancements after a delay to ensure DOM is ready
setTimeout(initEnhancements, 1000);
</script>

<script>
// Connect paste button in send screen
const pasteButton = document.querySelector('.paste-button');
if (pasteButton && !pasteButton._hasEventListener) {
  pasteButton.addEventListener('click', function() {
    const addressInput = document.getElementById('recipient-address');
    if (addressInput) {
      // For demo purposes, use a sample address
      addressInput.value = '0x742d35Cc6634C0532925a3b844Bc454e4438f44e';
      showToast('Address pasted');
    }
  });
  pasteButton._hasEventListener = true;
}

// Connect transaction items
document.querySelectorAll('.transaction-item').forEach(item => {
  if (!item._hasEventListener) {
    item.addEventListener('click', function() {
      // Show transaction details in explorer overlay
      const explorerOverlay = document.getElementById('explorer-overlay');
      if (explorerOverlay) {
        explorerOverlay.style.display = 'flex';
      }
    });
    item._hasEventListener = true;
  }
});

// Connect explorer back button
const explorerBackButton = document.querySelector('.explorer-back-button');
if (explorerBackButton && !explorerBackButton._hasEventListener) {
  explorerBackButton.addEventListener('click', function() {
    const explorerOverlay = document.getElementById('explorer-overlay');
    if (explorerOverlay) {
      explorerOverlay.style.display = 'none';
    }
  });
  explorerBackButton._hasEventListener = true;
}

// Connect close transaction success button
const closeTxButton = document.getElementById('close-tx-success');
if (closeTxButton && !closeTxButton._hasEventListener) {
  closeTxButton.addEventListener('click', function() {
    const txStatusModal = document.getElementById('tx-status-modal');
    if (txStatusModal) {
      txStatusModal.style.display = 'none';
    }
    navigateToScreen('wallet-screen');
  });
  closeTxButton._hasEventListener = true;
}

// Connect fee options
document.querySelectorAll('.fee-option').forEach(option => {
  if (!option._hasEventListener) {
    option.addEventListener('click', function() {
      // Remove active class from all options
      document.querySelectorAll('.fee-option').forEach(opt => {
        opt.classList.remove('active');
      });
      // Add active class to clicked option
      this.classList.add('active');
    });
    option._hasEventListener = true;
  }
});

// Function to navigate to specific screen
function navigateToScreen(screenId) {
  // Hide all screens
  document.querySelectorAll('.screen').forEach(screen => {
    screen.style.display = 'none';
    screen.classList.add('hidden');
  });
  
  // Show target screen
  const targetScreen = document.getElementById(screenId);
  if (targetScreen) {
    targetScreen.style.display = 'flex';
    targetScreen.classList.remove('hidden');
  }
}

// Function to show toast messages
function showToast(message, duration = 2000) {
  // Remove any existing toast
  const existingToast = document.querySelector('.toast-message');
  if (existingToast) {
    document.body.removeChild(existingToast);
  }
  
  // Create new toast
  const toast = document.createElement('div');
  toast.className = 'toast-message';
  toast.textContent = message;
  document.body.appendChild(toast);
  
  // Show toast
  setTimeout(() => {
    toast.classList.add('show');
  }, 10);
  
  // Hide toast after duration
  setTimeout(() => {
    toast.classList.remove('show');
    setTimeout(() => {
      if (toast.parentNode) {
        document.body.removeChild(toast);
      }
    }, 300);
  }, duration);
}

// Token detail view updater
function updateTokenDetailView(tokenId) {
  const activeWallet = window.activeWallet || 'main';
  const tokens = window.currentWalletData?.[activeWallet]?.tokens || [];
  const token = tokens.find(t => t.id === tokenId);
  
  if (!token) return;
  
  // Update token details
  const elements = {
    'detail-symbol': token.symbol,
    'detail-fullname': token.name,
    'token-balance-amount': token.amount.toFixed(6) + ' ' + token.symbol,
    'token-balance-value': '$' + token.value.toFixed(2),
    'token-staking-symbol': token.symbol,
    'token-price-symbol': token.symbol,
    'token-current-price': '$' + token.price.toLocaleString()
  };
  
  // Update all elements
  for (const id in elements) {
    const element = document.getElementById(id);
    if (element) {
      element.textContent = elements[id];
    }
  }
  
  // Update token icon
  const tokenDetailIcon = document.getElementById('token-detail-icon');
  if (tokenDetailIcon) {
    tokenDetailIcon.src = token.icon || getTokenLogoUrl(token.id);
  }
  
  // Update price change
  const priceChangeElement = document.getElementById('token-price-change');
  if (priceChangeElement) {
    priceChangeElement.className = token.change >= 0 ? 'positive' : 'negative';
    priceChangeElement.textContent = (token.change >= 0 ? '+' : '') + token.change + '%';
  }
}

// Function to populate token lists
function populateTokenList() {
  // Get token list container
  const tokenList = document.getElementById('token-list');
  if (!tokenList) return;
  
  // Clear existing content
  tokenList.innerHTML = '';
  
  // Get active wallet data
  const activeWallet = window.activeWallet || 'main';
  if (!window.currentWalletData || !window.currentWalletData[activeWallet]) {
    setupDefaultWalletData();
  }
  
  const walletData = window.currentWalletData[activeWallet];
  const tokens = walletData.tokens || [];
  
  // Create token items
  tokens.forEach(token => {
    // Create token item element
    const tokenItem = document.createElement('div');
    tokenItem.className = 'token-item';
    tokenItem.setAttribute('data-token-id', token.id);
    
    // Get token icon URL directly without template literal
    const iconUrl = token.icon || getTokenLogoUrl(token.id);
    
    // Set token content
    tokenItem.innerHTML = `
      <div class="token-icon">
        <img src="${iconUrl}" alt="${token.name}">
        ${['usdt', 'bnb', 'twt'].includes(token.id) ? 
          '<div class="chain-badge"><img src="https://cryptologos.cc/logos/bnb-bnb-logo.png" alt="Network"></div>' : ''}
      </div>
      <div class="token-info">
        <div class="token-name">${token.symbol}</div>
        <div class="token-price">${token.name} 
          <span class="token-price-change ${token.change >= 0 ? 'positive' : 'negative'}">
            ${(token.change >= 0 ? '+' : '') + token.change}%
          </span>
        </div>
      </div>
      <div class="token-amount">
        <div class="token-balance">${token.amount.toFixed(6)} ${token.symbol}</div>
        <div class="token-value">$${token.value.toFixed(2)}</div>
      </div>
    `;
    
    // Add click event
    tokenItem.addEventListener('click', function() {
      // Navigate to token detail screen
      navigateToScreen('token-detail');
      // Update token detail view
      updateTokenDetailView(token.id);
    });
    
    // Append to token list
    tokenList.appendChild(tokenItem);
  });
  
  // Update total balance
  const totalBalanceElement = document.getElementById('total-balance');
  if (totalBalanceElement) {
    totalBalanceElement.textContent = '$' + walletData.totalBalance.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
  }
}

// Setup default wallet data
function setupDefaultWalletData() {
  const defaultTokens = [
    {
      id: 'btc',
      name: 'Bitcoin',
      symbol: 'BTC',
      network: 'Bitcoin',
      icon: 'https://cryptologos.cc/logos/bitcoin-btc-logo.png',
      amount: 0.25,
      value: 20996.19,
      price: 83984.74,
      change: -0.59
    },
    {
      id: 'eth',
      name: 'Ethereum',
      symbol: 'ETH',
      network: 'Ethereum',
      icon: 'https://cryptologos.cc/logos/ethereum-eth-logo.png',
      amount: 5.75,
      value: 11349.41,
      price: 1973.81,
      change: -0.71
    },
    {
      id: 'usdt',
      name: 'Tether',
      symbol: 'USDT',
      network: 'BNB Smart Chain',
      icon: 'https://cryptologos.cc/logos/tether-usdt-logo.png',
      amount: 10000,
      value: 10000,
      price: 1.00,
      change: 0.00
    },
    {
      id: 'bnb',
      name: 'BNB',
      symbol: 'BNB',
      network: 'BNB Smart Chain',
      icon: 'https://cryptologos.cc/logos/bnb-bnb-logo.png',
      amount: 25.5,
      value: 8926.56,
      price: 349.67,
      change: 2.35
    }
  ];
  
  // Calculate total balance
  const totalBalance = defaultTokens.reduce((total, token) => total + token.value, 0);
  
  // Create wallet data
  window.currentWalletData = {
    main: {
      totalBalance: totalBalance,
      tokens: defaultTokens
    }
  };
  
  // Create a copy for original data
  window.originalWalletData = JSON.parse(JSON.stringify(window.currentWalletData));
}

// Function to show token detail
function showTokenDetail(tokenId) {
  navigateToScreen('token-detail');
  updateTokenDetailView(tokenId);
}

// Function to show send screen
function showSendScreen(tokenId) {
  const activeWallet = window.activeWallet || 'main';
  const tokens = window.currentWalletData?.[activeWallet]?.tokens || [];
  const token = tokens.find(t => t.id === tokenId);
  
  if (!token) return;
  
  // Update send screen with token details
  const sendTokenTitle = document.getElementById('send-token-title');
  if (sendTokenTitle) {
    sendTokenTitle.textContent = 'Send ' + token.symbol;
  }
  
  const maxAmount = document.getElementById('max-amount');
  if (maxAmount) {
    maxAmount.textContent = token.amount.toFixed(6);
  }
  
  const maxSymbol = document.getElementById('max-symbol');
  if (maxSymbol) {
    maxSymbol.textContent = token.symbol;
  }
  
  // Show send screen
  navigateToScreen('send-screen');
}

// Make functions globally available
window.navigateToScreen = navigateToScreen;
window.showToast = showToast;
window.updateTokenDetailView = updateTokenDetailView;
window.populateTokenList = populateTokenList;
window.setupDefaultWalletData = setupDefaultWalletData;
window.showTokenDetail = showTokenDetail;
window.showSendScreen = showSendScreen;

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
  // Setup wallet data
  setupDefaultWalletData();
  
  // Populate token list
  populateTokenList();
  
  // Connect back buttons
  document.querySelectorAll('.back-button, #back-button').forEach(button => {
    button.addEventListener('click', function() {
      navigateToScreen('wallet-screen');
    });
  });
  
  // Connect unlock button
  const unlockButton = document.getElementById('unlock-button');
  if (unlockButton) {
    unlockButton.addEventListener('click', function() {
      if (window.passcodeEntered === window.correctPasscode) {
        navigateToScreen('wallet-screen');
        window.passcodeEntered = '';
      } else {
        showToast('Incorrect passcode');
        window.passcodeEntered = '';
        document.querySelectorAll('.passcode-dots .dot').forEach(dot => {
          dot.classList.remove('filled');
        });
      }
    });
  }
  
  // Connect numpad keys
  document.querySelectorAll('.numpad-key').forEach(key => {
    key.addEventListener('click', function() {
      const keyValue = this.getAttribute('data-key');
      
      if (keyValue === 'bio') {
        // Simulate biometric success
        setTimeout(() => {
          navigateToScreen('wallet-screen');
        }, 1000);
      } else if (keyValue === 'back') {
        // Remove last digit
        window.passcodeEntered = window.passcodeEntered.slice(0, -1);
      } else {
        // Add digit if less than 6
        if (window.passcodeEntered.length < 6) {
          window.passcodeEntered += keyValue;
        }
      }
      
      // Update dots
      document.querySelectorAll('.passcode-dots .dot').forEach((dot, index) => {
        if (index < window.passcodeEntered.length) {
          dot.classList.add('filled');
        } else {
          dot.classList.remove('filled');
        }
      });
      
      // Check if complete
      if (window.passcodeEntered.length === 6) {
        if (window.passcodeEntered === window.correctPasscode) {
          setTimeout(() => {
            navigateToScreen('wallet-screen');
            window.passcodeEntered = '';
          }, 300);
        } else {
          const dots = document.querySelector('.passcode-dots');
          if (dots) {
            dots.classList.add('shake');
            setTimeout(() => {
              dots.classList.remove('shake');
              window.passcodeEntered = '';
              document.querySelectorAll('.passcode-dots .dot').forEach(dot => {
                dot.classList.remove('filled');
              });
            }, 500);
          }
        }
      }
    });
  });
  
  // Connect visibility toggle
  const visibilityToggle = document.querySelector('.visibility-toggle');
  if (visibilityToggle) {
    visibilityToggle.addEventListener('click', function() {
      const icon = this.querySelector('i');
      const balanceAmount = document.getElementById('total-balance');
      
      if (icon.classList.contains('fa-eye')) {
        // Hide balance
        icon.classList.remove('fa-eye');
        icon.classList.add('fa-eye-slash');
        window.cachedBalance = balanceAmount.textContent;
        balanceAmount.textContent = 'â€¢â€¢â€¢â€¢â€¢â€¢';
        
        // Also hide token balances
        document.querySelectorAll('.token-balance').forEach(tokenBalance => {
          tokenBalance.setAttribute('data-original-amount', tokenBalance.textContent);
          tokenBalance.textContent = 'â€¢â€¢â€¢â€¢â€¢â€¢';
        });
      } else {
        // Show balance
        icon.classList.remove('fa-eye-slash');
        icon.classList.add('fa-eye');
        
        if (window.cachedBalance) {
          balanceAmount.textContent = window.cachedBalance;
        } else {
          const activeWallet = window.activeWallet || 'main';
          if (window.currentWalletData && window.currentWalletData[activeWallet]) {
            balanceAmount.textContent = '$' + window.currentWalletData[activeWallet].totalBalance.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
          } else {
            balanceAmount.textContent = '$0.00';
          }
        }
        
        // Restore token balances
        document.querySelectorAll('.token-balance').forEach(tokenBalance => {
          const originalAmount = tokenBalance.getAttribute('data-original-amount');
          if (originalAmount) {
            tokenBalance.textContent = originalAmount;
          }
        });
      }
    });
  }
  
  // Connect send button
  const sendButton = document.getElementById('send-button');
  if (sendButton) {
    sendButton.addEventListener('click', function() {
      navigateToScreen('send-token-select');
    });
  }
  
  // Connect continue send button
  const continueButton = document.getElementById('continue-send');
  if (continueButton) {
    continueButton.addEventListener('click', function() {
      // Show transaction status modal
      const txStatusModal = document.getElementById('tx-status-modal');
      if (txStatusModal) {
        txStatusModal.style.display = 'flex';
        
        // Show pending view
        const pendingView = document.getElementById('tx-pending');
        const successView = document.getElementById('tx-success');
        
        if (pendingView) pendingView.classList.remove('hidden');
        if (successView) successView.classList.add('hidden');
        
        // Simulate transaction completion
        setTimeout(() => {
          if (pendingView) pendingView.classList.add('hidden');
          if (successView) successView.classList.remove('hidden');
          
          // Update transaction details
          const txAmount = document.getElementById('tx-amount');
          const sendAmount = document.getElementById('send-amount');
          const maxSymbol = document.getElementById('max-symbol');
          
          if (txAmount && sendAmount && maxSymbol) {
            txAmount.textContent = parseFloat(sendAmount.value || 0).toFixed(2) + ' ' + maxSymbol.textContent;
          }
          
          const txTo = document.getElementById('tx-to');
          const recipientAddress = document.getElementById('recipient-address');
          
          if (txTo && recipientAddress) {
            const address = recipientAddress.value || '';
            txTo.textContent = address.substring(0, 6) + '...' + address.substring(address.length - 4);
          }
        }, 2000);
      }
    });
  }
});

<script>
// TrustWallet UI Comprehensive Fixes - Part 1: Core Functions
(function() {
  'use strict';
  
  // Wait for DOM to be fully loaded
  function waitForDOM(callback) {
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', callback);
    } else {
      callback();
    }
  }
  
  // Token Logo URL fallback function
  function getTokenLogoUrl(tokenId) {
    const tokenLogos = {
      'btc': 'https://cryptologos.cc/logos/bitcoin-btc-logo.png',
      'eth': 'https://cryptologos.cc/logos/ethereum-eth-logo.png',
      'usdt': 'https://cryptologos.cc/logos/tether-usdt-logo.png',
      'bnb': 'https://cryptologos.cc/logos/bnb-bnb-logo.png',
      'sol': 'https://cryptologos.cc/logos/solana-sol-logo.png',
      'xrp': 'https://cryptologos.cc/logos/xrp-xrp-logo.png',
      'trx': 'https://cryptologos.cc/logos/tron-trx-logo.png',
      'pol': 'https://cryptologos.cc/logos/polygon-matic-logo.png',
      'uni': 'https://cryptologos.cc/logos/uniswap-uni-logo.png',
      'twt': 'https://i.ibb.co/NdQ4xthx/Screenshot-2025-03-25-031716.png'
    };
    
    return tokenLogos[tokenId.toLowerCase()] || 'https://via.placeholder.com/128';
  }

  // Get token name based on ID
  function getTokenName(tokenId) {
    const tokenNames = {
      'btc': 'Bitcoin',
      'eth': 'Ethereum',
      'usdt': 'Tether USD',
      'bnb': 'BNB Smart Chain',
      'sol': 'Solana',
      'xrp': 'XRP',
      'trx': 'Tron',
      'pol': 'Polygon',
      'uni': 'Uniswap',
      'twt': 'Trust Wallet Token'
    };
    
    return tokenNames[tokenId.toLowerCase()] || tokenId.toUpperCase();
  }
  
  // Get token network
  function getTokenNetwork(tokenId) {
    const tokenNetworks = {
      'btc': 'Bitcoin',
      'eth': 'Ethereum',
      'usdt': 'BNB Smart Chain',
      'bnb': 'BNB Smart Chain',
      'sol': 'Solana',
      'xrp': 'XRP',
      'trx': 'Tron',
      'pol': 'Polygon',
      'uni': 'Ethereum',
      'twt': 'BNB Smart Chain'
    };
    
    return tokenNetworks[tokenId.toLowerCase()] || 'Unknown';
  }
  
  // Get token address
  function getTokenAddress(tokenId) {
    const addresses = {
      'btc': '0x9B3a54D092f6B4b3d2eC676cd589f124E9921E71',
      'eth': '0xC65B6CCC7A29D34110B10957B59A35a946D1c297',
      'usdt': '0xC65B6CCC7A29D34110B10957B59A35a946D1c297',
      'bnb': '0xC65B6CCC7A29D34110B10957B59A35a946D1c297',
      'sol': 'B8WVMQL54xqLBsxHzYSEFpRX8Q4rCs4jB',
      'xrp': 'rsSmpFnscXVrBkNpq1vnhiBWxT',
      'trx': 'TZ3gtUoFHJfCGKxghKtX',
      'pol': '0xC65B6CCC7A29D34110B10957B59A35a946D1c297',
      'uni': '0xC65B6CCC7A29D34110B10957B59A35a946D1c297',
      'twt': '0xC65B6CCC7A29D34110B10957B59A35a946D1c297'
    };
    
    return addresses[tokenId.toLowerCase()] || '0x9B3a54D092f6B4b3d2eC676cd589f124E9921E71';
  }
  
  // Copy to clipboard function
  function copyToClipboard(text) {
    const tempInput = document.createElement('input');
    tempInput.style.position = 'absolute';
    tempInput.style.left = '-1000px';
    tempInput.value = text;
    document.body.appendChild(tempInput);
    tempInput.select();
    document.execCommand('copy');
    document.body.removeChild(tempInput);
  }
  
  // Show toast message
  function showToast(message, duration = 2000) {
    // Remove existing toast if any
    const existingToast = document.querySelector('.toast-message');
    if (existingToast) {
      existingToast.remove();
    }
    
    // Create new toast
    const toast = document.createElement('div');
    toast.className = 'toast-message';
    toast.textContent = message;
    document.body.appendChild(toast);
    
    // Show toast with animation
    setTimeout(() => {
      toast.classList.add('show');
    }, 10);
    
    // Hide toast after duration
    setTimeout(() => {
      toast.classList.remove('show');
      setTimeout(() => {
        toast.remove();
      }, 300);
    }, duration);
  }
  
  // Navigation function
  function navigateToScreen(screenId) {
    // Hide all screens
    const screens = document.querySelectorAll('.screen');
    screens.forEach(screen => {
      screen.style.display = 'none';
      screen.classList.add('hidden');
    });
    
    // Show the selected screen
    const targetScreen = document.getElementById(screenId);
    if (targetScreen) {
      targetScreen.style.display = 'flex';
      targetScreen.classList.remove('hidden');
    }
    
    // Update active tab
    const tabs = document.querySelectorAll('.tab-item');
    tabs.forEach(tab => {
      tab.classList.remove('active');
      const tabIcon = tab.querySelector('i');
      const tabLabel = tab.querySelector('.tab-label');
      
      if (tabIcon) tabIcon.style.color = '#666';
      if (tabLabel) tabLabel.style.color = '#666';
    });
    
    const activeTab = document.querySelector(`.tab-item[data-screen="${screenId}"]`);
    if (activeTab) {
      activeTab.classList.add('active');
      const activeIcon = activeTab.querySelector('i');
      const activeLabel = activeTab.querySelector('.tab-label');
      
      if (activeIcon) activeIcon.style.color = '#3375BB';
      if (activeLabel) activeLabel.style.color = '#3375BB';
    }
  }
  
  // Fix screen headers
  function fixScreenHeaders() {
    const headerSelectors = [
      '#wallet-screen .screen-header',
      '#send-screen .screen-header', 
      '#receive-screen .screen-header', 
      '#history-screen .screen-header',
      '#token-detail .screen-header',
      '#send-token-select .screen-header',
      '#receive-qr-screen .screen-header'
    ];
    
    headerSelectors.forEach(selector => {
      const headers = document.querySelectorAll(selector);
      
      headers.forEach(header => {
        // Apply consistent styling to all headers
        header.style.display = 'flex';
        header.style.alignItems = 'center';
        header.style.justifyContent = 'space-between';
        header.style.padding = '16px';
        header.style.backgroundColor = '#FFFFFF';
        header.style.borderBottom = '1px solid #F5F5F5';
        header.style.position = 'relative';
        header.style.width = '100%';
        header.style.height = 'auto';
        header.style.minHeight = '56px';
        header.style.zIndex = '10';
        
        // Fix header title
        const title = header.querySelector('h2');
        if (title) {
          title.style.margin = '0';
          title.style.fontSize = '18px';
          title.style.fontWeight = '600';
          title.style.flex = '1';
          title.style.textAlign = 'center';
        }
        
        // Fix back button
        const backButton = header.querySelector('.back-button');
        if (backButton) {
          backButton.style.background = 'none';
          backButton.style.border = 'none';
          backButton.style.padding = '8px';
          backButton.style.cursor = 'pointer';
          backButton.style.display = 'flex';
          backButton.style.alignItems = 'center';
          backButton.style.justifyContent = 'center';
        }
      });
    });
  }
  
  // Fix network badges
  function fixNetworkBadges() {
    // Remove network badges from receive and send screens
    const screensToFix = ['#receive-screen', '#send-screen', '#receive-qr-screen'];
    
    screensToFix.forEach(screenSelector => {
      const screen = document.querySelector(screenSelector);
      if (!screen) return;
      
      const badges = screen.querySelectorAll('.chain-badge, .chain-badge-fixed, .network-badge');
      badges.forEach(badge => {
        badge.style.display = 'none';
      });
    });
    
    // Fix badges in wallet screen
    const tokenItems = document.querySelectorAll('#token-list .token-item');
    tokenItems.forEach(item => {
      const tokenId = item.getAttribute('data-token-id');
      if (!tokenId) return;
      
      const shouldHaveBadge = ['usdt', 'twt', 'bnb', 'uni', 'pol'].includes(tokenId.toLowerCase());
      
      // Find or create badge
      let badge = item.querySelector('.chain-badge');
      const tokenIcon = item.querySelector('.token-icon');
      
      if (shouldHaveBadge && tokenIcon) {
        if (!badge) {
          badge = document.createElement('div');
          badge.className = 'chain-badge';
          
          const badgeImg = document.createElement('img');
          badgeImg.src = 'https://cryptologos.cc/logos/bnb-bnb-logo.png';
          badgeImg.alt = 'BNB Chain';
          badgeImg.style.width = '100%';
          badgeImg.style.height = '100%';
          
          badge.appendChild(badgeImg);
          tokenIcon.appendChild(badge);
        }
        
        // Style the badge
        badge.style.position = 'absolute';
        badge.style.bottom = '-6px';
        badge.style.right = '-6px';
        badge.style.width = '18px';
        badge.style.height = '18px';
        badge.style.borderRadius = '50%';
        badge.style.backgroundColor = 'white';
        badge.style.border = '2px solid white';
        badge.style.boxShadow = '0 1px 2px rgba(0,0,0,0.1)';
        badge.style.display = 'flex';
        badge.style.alignItems = 'center';
        badge.style.justifyContent = 'center';
        badge.style.overflow = 'hidden';
      }
    });
  }
  
  // Fix bottom tabs
  function fixBottomTabs() {
    const bottomTabs = document.querySelector('.bottom-tabs');
    if (!bottomTabs) {
      // Create bottom tabs if they don't exist
      createBottomTabs();
      return;
    }
    
    // Ensure bottom tabs have the right styling
    bottomTabs.style.display = 'flex';
    bottomTabs.style.position = 'fixed';
    bottomTabs.style.bottom = '0';
    bottomTabs.style.left = '0';
    bottomTabs.style.width = '100%';
    bottomTabs.style.zIndex = '9999';
    bottomTabs.style.backgroundColor = '#FFFFFF';
    bottomTabs.style.borderTop = '1px solid #F5F5F5';
    bottomTabs.style.padding = '8px 0';
    bottomTabs.style.justifyContent = 'space-around';
    
    // Make sure to append bottom tabs to body for proper stacking
    document.body.appendChild(bottomTabs);
  }
  
  // Create bottom tabs
  function createBottomTabs() {
    const tabs = document.createElement('div');
    tabs.className = 'bottom-tabs';
    
    tabs.innerHTML = `
      <div class="tab-item active" data-screen="wallet-screen">
        <i class="fas fa-wallet"></i>
        <div class="tab-label">Wallet</div>
      </div>
      <div class="tab-item" data-screen="discover-screen">
        <i class="fas fa-compass"></i>
        <div class="tab-label">Discover</div>
      </div>
      <div class="tab-item" data-screen="browser-screen">
        <i class="fas fa-globe"></i>
        <div class="tab-label">Browser</div>
      </div>
      <div class="tab-item" data-screen="settings-screen">
        <i class="fas fa-cog"></i>
        <div class="tab-label">Settings</div>
      </div>
    `;
    
    // Style tabs
    tabs.style.display = 'flex';
    tabs.style.position = 'fixed';
    tabs.style.bottom = '0';
    tabs.style.left = '0';
    tabs.style.width = '100%';
    tabs.style.zIndex = '9999';
    tabs.style.backgroundColor = '#FFFFFF';
    tabs.style.borderTop = '1px solid #F5F5F5';
    tabs.style.padding = '8px 0';
    tabs.style.justifyContent = 'space-around';
    
    const tabItems = tabs.querySelectorAll('.tab-item');
    tabItems.forEach(item => {
      item.style.display = 'flex';
      item.style.flexDirection = 'column';
      item.style.alignItems = 'center';
      item.style.padding = '8px';
      item.style.cursor = 'pointer';
      
      // Add click event
      item.addEventListener('click', function() {
        const screenId = item.getAttribute('data-screen');
        navigateToScreen(screenId);
        
        // Update active tab
        tabItems.forEach(tab => tab.classList.remove('active'));
        item.classList.add('active');
      });
    });
    
    const tabIcons = tabs.querySelectorAll('.tab-item i');
    tabIcons.forEach(icon => {
      icon.style.fontSize = '22px';
      icon.style.marginBottom = '4px';
      icon.style.color = '#666';
    });
    
    const tabLabels = tabs.querySelectorAll('.tab-label');
    tabLabels.forEach(label => {
      label.style.fontSize = '12px';
      label.style.color = '#666';
    });
    
    // Add active tab styling
    const activeTab = tabs.querySelector('.tab-item.active');
    if (activeTab) {
      const activeIcon = activeTab.querySelector('i');
      const activeLabel = activeTab.querySelector('.tab-label');
      
      if (activeIcon) activeIcon.style.color = '#3375BB';
      if (activeLabel) activeLabel.style.color = '#3375BB';
    }
    
    document.body.appendChild(tabs);
  }

  // Make functions globally available
  window.getTokenLogoUrl = getTokenLogoUrl;
  window.getTokenName = getTokenName;
  window.getTokenNetwork = getTokenNetwork;
  window.getTokenAddress = getTokenAddress;
  window.copyToClipboard = copyToClipboard;
  window.showToast = showToast;
  window.navigateToScreen = navigateToScreen;
  window.fixScreenHeaders = fixScreenHeaders;
  window.fixNetworkBadges = fixNetworkBadges;
  window.fixBottomTabs = fixBottomTabs;
  window.createBottomTabs = createBottomTabs;

  // Apply fixes after DOM is loaded
  waitForDOM(function() {
    // Add a delay to ensure other scripts have initialized
    setTimeout(function() {
      fixScreenHeaders();
      fixNetworkBadges();
      fixBottomTabs();
    }, 500);
  });
})();
</script>
    <script>
// TrustWallet UI Comprehensive Fixes - Part 2: Token Detail and Screens

  // Fix token detail view
  function fixTokenDetailView() {
    const tokenDetail = document.getElementById('token-detail');
    if (!tokenDetail) return;
    
    // Fix token detail header structure
    const detailHeader = tokenDetail.querySelector('.screen-header');
    if (detailHeader) {
      // Clear existing content and create proper TrustWallet style header
      detailHeader.innerHTML = `
        <button class="back-button" aria-label="Go back">
          <i class="fas fa-arrow-left"></i>
        </button>
        <div class="token-header-info">
          <h2 id="token-symbol"></h2>
          <div class="token-subtitle">
            <span id="token-type">COIN</span> | <span id="token-name"></span>
          </div>
        </div>
        <div class="placeholder-icon"></div>
      `;
      
      // Style the token header info
      const tokenHeaderInfo = detailHeader.querySelector('.token-header-info');
      if (tokenHeaderInfo) {
        tokenHeaderInfo.style.display = 'flex';
        tokenHeaderInfo.style.flexDirection = 'column';
        tokenHeaderInfo.style.alignItems = 'center';
        tokenHeaderInfo.style.flex = '1';
      }
      
      // Style the token subtitle
      const tokenSubtitle = detailHeader.querySelector('.token-subtitle');
      if (tokenSubtitle) {
        tokenSubtitle.style.fontSize = '14px';
        tokenSubtitle.style.color = '#666';
        tokenSubtitle.style.marginTop = '4px';
      }
      
      // Connect back button
      const backButton = detailHeader.querySelector('.back-button');
      if (backButton) {
        backButton.addEventListener('click', function() {
          navigateToScreen('wallet-screen');
        });
      }
    }
    
    // Fix token icon display
    const oldIconContainer = tokenDetail.querySelector('.token-detail-icon-container');
    if (oldIconContainer) {
      oldIconContainer.remove();
    }
    
    // Create proper token icon container
    const contentContainer = tokenDetail.querySelector('.token-detail-content') || tokenDetail;
    if (contentContainer) {
      // Create token icon and balance section
      const tokenInfoSection = document.createElement('div');
      tokenInfoSection.className = 'token-info-section';
      tokenInfoSection.innerHTML = `
        <div class="token-icon-container">
          <img id="token-detail-icon" src="" alt="Token icon" class="token-large-icon">
        </div>
        <div class="token-balance-container">
          <div id="token-amount" class="token-amount"></div>
          <div id="token-value" class="token-value"></div>
        </div>
      `;
      
      // Style the token info section
      tokenInfoSection.style.display = 'flex';
      tokenInfoSection.style.flexDirection = 'column';
      tokenInfoSection.style.alignItems = 'center';
      tokenInfoSection.style.padding = '32px 16px';
      tokenInfoSection.style.backgroundColor = '#FFFFFF';
      
      // Insert at the beginning of content
      contentContainer.insertBefore(tokenInfoSection, contentContainer.firstChild);
      
      // Style token icon
      const tokenIcon = tokenInfoSection.querySelector('.token-icon-container');
      if (tokenIcon) {
        tokenIcon.style.display = 'flex';
        tokenIcon.style.justifyContent = 'center';
        tokenIcon.style.marginBottom = '24px';
      }
      
      const tokenImage = tokenInfoSection.querySelector('#token-detail-icon');
      if (tokenImage) {
        tokenImage.style.width = '64px';
        tokenImage.style.height = '64px';
        tokenImage.style.borderRadius = '50%';
      }
      
      // Style token balance
      const balanceContainer = tokenInfoSection.querySelector('.token-balance-container');
      if (balanceContainer) {
        balanceContainer.style.display = 'flex';
        balanceContainer.style.flexDirection = 'column';
        balanceContainer.style.alignItems = 'center';
      }
      
      const tokenAmount = tokenInfoSection.querySelector('#token-amount');
      if (tokenAmount) {
        tokenAmount.style.fontSize = '32px';
        tokenAmount.style.fontWeight = 'bold';
        tokenAmount.style.marginBottom = '8px';
      }
      
      const tokenValue = tokenInfoSection.querySelector('#token-value');
      if (tokenValue) {
        tokenValue.style.fontSize = '18px';
        tokenValue.style.color = '#666';
      }
    }
    
    // Add action buttons
    const actionSection = document.createElement('div');
    actionSection.className = 'token-action-section';
    actionSection.innerHTML = `
      <div class="action-buttons">
        <div class="action-button-container">
          <button class="action-circle send-action">
            <i class="fas fa-arrow-up"></i>
          </button>
          <div class="action-label">Send</div>
        </div>
        <div class="action-button-container">
          <button class="action-circle receive-action">
            <i class="fas fa-arrow-down"></i>
          </button>
          <div class="action-label">Receive</div>
        </div>
        <div class="action-button-container">
          <button class="action-circle swap-action">
            <i class="fas fa-exchange-alt"></i>
          </button>
          <div class="action-label">Swap</div>
        </div>
        <div class="action-button-container">
          <button class="action-circle buy-action">
            <i class="fas fa-credit-card"></i>
          </button>
          <div class="action-label">Buy</div>
        </div>
        <div class="action-button-container">
          <button class="action-circle sell-action">
            <i class="fas fa-university"></i>
          </button>
          <div class="action-label">Sell</div>
        </div>
      </div>
    `;
    
    // Style action section
    actionSection.style.backgroundColor = '#FFFFFF';
    actionSection.style.padding = '16px';
    actionSection.style.marginTop = '8px';
    
    // Style action buttons
    const actionButtons = actionSection.querySelector('.action-buttons');
    if (actionButtons) {
      actionButtons.style.display = 'flex';
      actionButtons.style.justifyContent = 'space-between';
      actionButtons.style.padding = '8px 16px';
    }
    
    const buttonContainers = actionSection.querySelectorAll('.action-button-container');
    buttonContainers.forEach(container => {
      container.style.display = 'flex';
      container.style.flexDirection = 'column';
      container.style.alignItems = 'center';
    });
    
    const actionCircles = actionSection.querySelectorAll('.action-circle');
    actionCircles.forEach(circle => {
      circle.style.width = '50px';
      circle.style.height = '50px';
      circle.style.borderRadius = '50%';
      circle.style.backgroundColor = '#F5F5F5';
      circle.style.display = 'flex';
      circle.style.alignItems = 'center';
      circle.style.justifyContent = 'center';
      circle.style.marginBottom = '8px';
      circle.style.border = 'none';
      circle.style.cursor = 'pointer';
    });
    
    const actionLabels = actionSection.querySelectorAll('.action-label');
    actionLabels.forEach(label => {
      label.style.fontSize = '12px';
      label.style.color = '#666';
    });
    
    // Add to token detail
    contentContainer.insertBefore(actionSection, contentContainer.children[1] || null);
    
    // Add transaction history section
    const transactionSection = document.createElement('div');
    transactionSection.className = 'transaction-section';
    transactionSection.innerHTML = `
      <div class="transaction-header">
        <div class="transaction-title">Transactions</div>
        <button class="filter-button">
          <i class="fas fa-filter"></i>
        </button>
      </div>
      <div id="token-transactions" class="token-transactions">
        <div class="empty-transactions">
          <div class="empty-icon">
            <i class="far fa-file-alt"></i>
          </div>
          <div class="empty-message">Transactions will appear here.</div>
          <div class="empty-submessage">Cannot find your transaction? <a href="#" class="check-explorer">Check explorer</a></div>
        </div>
      </div>
    `;
    
    // Style transaction section
    transactionSection.style.backgroundColor = '#FFFFFF';
    transactionSection.style.marginTop = '8px';
    transactionSection.style.paddingBottom = '80px'; // Space for bottom tabs
    
    const transactionHeader = transactionSection.querySelector('.transaction-header');
    if (transactionHeader) {
      transactionHeader.style.display = 'flex';
      transactionHeader.style.justifyContent = 'space-between';
      transactionHeader.style.alignItems = 'center';
      transactionHeader.style.padding = '16px';
      transactionHeader.style.borderBottom = '1px solid #F5F5F5';
    }
    
    const transactionTitle = transactionSection.querySelector('.transaction-title');
    if (transactionTitle) {
      transactionTitle.style.fontSize = '18px';
      transactionTitle.style.fontWeight = '600';
    }
    
    const filterButton = transactionSection.querySelector('.filter-button');
    if (filterButton) {
      filterButton.style.background = 'none';
      filterButton.style.border = 'none';
      filterButton.style.fontSize = '16px';
      filterButton.style.color = '#666';
      filterButton.style.cursor = 'pointer';
    }
    
    const emptyTransactions = transactionSection.querySelector('.empty-transactions');
    if (emptyTransactions) {
      emptyTransactions.style.display = 'flex';
      emptyTransactions.style.flexDirection = 'column';
      emptyTransactions.style.alignItems = 'center';
      emptyTransactions.style.padding = '48px 16px';
      emptyTransactions.style.textAlign = 'center';
    }
    
    const emptyIcon = transactionSection.querySelector('.empty-icon');
    if (emptyIcon) {
      emptyIcon.style.fontSize = '48px';
      emptyIcon.style.color = '#CCC';
      emptyIcon.style.marginBottom = '16px';
    }
    
    const emptyMessage = transactionSection.querySelector('.empty-message');
    if (emptyMessage) {
      emptyMessage.style.fontSize = '16px';
      emptyMessage.style.color = '#666';
      emptyMessage.style.marginBottom = '8px';
    }
    
    const emptySubmessage = transactionSection.querySelector('.empty-submessage');
    if (emptySubmessage) {
      emptySubmessage.style.fontSize = '14px';
      emptySubmessage.style.color = '#999';
    }
    
    const checkExplorer = transactionSection.querySelector('.check-explorer');
    if (checkExplorer) {
      checkExplorer.style.color = '#3375BB';
      checkExplorer.style.textDecoration = 'none';
    }
    
    // Add to token detail
    contentContainer.appendChild(transactionSection);
    
    // Update token data
    updateTokenDetailData();
  }
  
  // Update token detail with data
  function updateTokenDetailData() {
    const urlParams = new URLSearchParams(window.location.search);
    const tokenId = urlParams.get('token') || 'btc';
    
    // Get token data from available data source
    let tokenData = null;
    if (window.currentWalletData && 
        window.currentWalletData.main && 
        window.currentWalletData.main.tokens) {
      tokenData = window.currentWalletData.main.tokens.find(t => t.id.toLowerCase() === tokenId.toLowerCase());
    }
    
    if (!tokenData) {
      // Fallback mock data
      tokenData = {
        id: tokenId,
        symbol: tokenId.toUpperCase(),
        name: window.getTokenName ? window.getTokenName(tokenId) : tokenId.toUpperCase(),
        amount: 0,
        value: 0
      };
    }
    
    // Update token header info
    const symbolElement = document.getElementById('token-symbol');
    if (symbolElement) {
      symbolElement.textContent = tokenData.symbol;
    }
    
    const nameElement = document.getElementById('token-name');
    if (nameElement) {
      nameElement.textContent = tokenData.name;
    }
    
    // Update token icon
    const iconElement = document.getElementById('token-detail-icon');
    if (iconElement) {
      iconElement.src = window.getTokenLogoUrl ? window.getTokenLogoUrl(tokenData.id) : tokenData.icon;
    }
    
    // Update balance info
    const amountElement = document.getElementById('token-amount');
    if (amountElement) {
      amountElement.textContent = `${tokenData.amount} ${tokenData.symbol}`;
    }
    
    const valueElement = document.getElementById('token-value');
    if (valueElement) {
      valueElement.textContent = `$${tokenData.value.toFixed(2)}`;
    }
  }
  
  // Fix receive screen
  function fixReceiveScreen() {
    const receiveScreen = document.getElementById('receive-screen');
    if (!receiveScreen) return;
    
    // Enhanced receive screen with token selection
    receiveScreen.innerHTML = `
      <div class="screen-header">
        <button class="back-button" aria-label="Go back">
          <i class="fas fa-arrow-left"></i>
        </button>
        <h2>Receive</h2>
        <div class="placeholder-icon"></div>
      </div>
      
      <div class="search-container">
        <div class="search-bar token-search">
          <i class="fas fa-search"></i>
          <input type="text" id="receive-token-search" placeholder="Search" aria-label="Search tokens">
        </div>
      </div>
      
      <div class="networks-filter">
        <div class="all-networks">
          All Networks <i class="fas fa-chevron-down"></i>
        </div>
      </div>
      
      <div id="receive-token-list" class="token-list">
        <!-- Popular tokens -->
        <div class="token-list-section">
          <div class="token-list-header">Popular</div>
          <div class="token-list-items" id="popular-tokens"></div>
        </div>
        
        <!-- All crypto -->
        <div class="token-list-section">
          <div class="token-list-header">All crypto</div>
          <div class="token-list-items" id="all-crypto-tokens"></div>
        </div>
      </div>
    `;
    
    // Style the receive screen elements
    const searchContainer = receiveScreen.querySelector('.search-container');
    if (searchContainer) {
      searchContainer.style.padding = '12px 16px';
      searchContainer.style.backgroundColor = '#FFFFFF';
    }
    
    const searchBar = receiveScreen.querySelector('.search-bar');
    if (searchBar) {
      searchBar.style.display = 'flex';
      searchBar.style.alignItems = 'center';
      searchBar.style.backgroundColor = '#F5F5F5';
      searchBar.style.borderRadius = '10px';
      searchBar.style.padding = '8px 12px';
    }
    
    const searchIcon = receiveScreen.querySelector('.search-bar i');
    if (searchIcon) {
      searchIcon.style.marginRight = '8px';
      searchIcon.style.color = '#999';
    }
    
    const searchInput = receiveScreen.querySelector('#receive-token-search');
    if (searchInput) {
      searchInput.style.flex = '1';
      searchInput.style.border = 'none';
      searchInput.style.background = 'none';
      searchInput.style.outline = 'none';
      searchInput.style.fontSize = '16px';
    }
    
    const networksFilter = receiveScreen.querySelector('.networks-filter');
    if (networksFilter) {
      networksFilter.style.padding = '8px 16px';
      networksFilter.style.borderBottom = '1px solid #F5F5F5';
      networksFilter.style.backgroundColor = '#FFFFFF';
    }
    
    const allNetworks = receiveScreen.querySelector('.all-networks');
    if (allNetworks) {
      allNetworks.style.display = 'inline-block';
      allNetworks.style.padding = '8px 12px';
      allNetworks.style.borderRadius = '16px';
      allNetworks.style.backgroundColor = '#F5F5F5';
      allNetworks.style.fontSize = '14px';
      allNetworks.style.cursor = 'pointer';
    }
    
    const tokenListSections = receiveScreen.querySelectorAll('.token-list-section');
    tokenListSections.forEach(section => {
      section.style.marginTop = '8px';
      section.style.backgroundColor = '#FFFFFF';
    });
    
    const tokenListHeaders = receiveScreen.querySelectorAll('.token-list-header');
    tokenListHeaders.forEach(header => {
      header.style.padding = '16px';
      header.style.fontSize = '18px';
      header.style.fontWeight = '600';
    });
    
    // Connect back button
    const backButton = receiveScreen.querySelector('.back-button');
    if (backButton) {
      backButton.addEventListener('click', function() {
        navigateToScreen('wallet-screen');
      });
    }
    
    // Populate token lists
    populateReceiveTokenList();
  }
  
  // Populate receive token list
  function populateReceiveTokenList() {
    // Define popular tokens
    const popularTokens = ['BTC', 'ETH', 'SOL', 'BNB'];
    
    // Define all crypto tokens
    const allCryptoTokens = ['USDT', 'TRX', 'POL', 'UNI', 'XRP', 'TWT'];
    
    // Get token container elements
    const popularContainer = document.getElementById('popular-tokens');
    const allCryptoContainer = document.getElementById('all-crypto-tokens');
    
    if (!popularContainer || !allCryptoContainer) return;
    
    // Clear existing lists
    popularContainer.innerHTML = '';
    allCryptoContainer.innerHTML = '';
    
    // Generate address for each token
    const addresses = {
      'BTC': 'bc1qltf...fsxp4p',
      'ETH': '0xC65B6...E90a51',
      'SOL': 'B8WVMQL...rCs4jB',
      'BNB': '0xC65B6...E90a51',
      'USDT': '0xC65B6...E90a51',
      'TRX': 'TZ3gtUo...xghKtX',
      'POL': '0xC65B6...E90a51',
      'UNI': '0xC65B6...E90a51',
      'XRP': 'rsSmpFn...hiBWxT',
      'TWT': '0xC65B6...E90a51'
    };
    
    // Add popular tokens
    popularTokens.forEach(token => {
      const tokenItem = createTokenReceiveItem(token, addresses[token] || '0x...');
      popularContainer.appendChild(tokenItem);
    });
    
    // Add all crypto tokens
    allCryptoTokens.forEach(token => {
      const tokenItem = createTokenReceiveItem(token, addresses[token] || '0x...');
      allCryptoContainer.appendChild(tokenItem);
    });
    
    // Add event listeners for all token items
    const tokenItems = document.querySelectorAll('.receive-token-item');
    tokenItems.forEach(item => {
      item.addEventListener('click', function() {
        const tokenSymbol = item.getAttribute('data-token');
        showReceiveQRScreen(tokenSymbol);
      });
    });
  }
  
  // Create token item for receive screen
  function createTokenReceiveItem(tokenSymbol, address) {
    const tokenItem = document.createElement('div');
    tokenItem.className = 'receive-token-item';
    tokenItem.setAttribute('data-token', tokenSymbol);
    
    // Get token data
    const tokenName = window.getTokenName ? window.getTokenName(tokenSymbol.toLowerCase()) : tokenSymbol;
    const tokenNetwork = window.getTokenNetwork ? window.getTokenNetwork(tokenSymbol.toLowerCase()) : 'Unknown';
    
    // Set token content
    tokenItem.innerHTML = `
      <div class="token-icon">
        <img src="${window.getTokenLogoUrl ? window.getTokenLogoUrl(tokenSymbol.toLowerCase()) : ''}" alt="${tokenSymbol}">
      </div>
      <div class="token-info">
        <div class="token-symbol">${tokenSymbol}</div>
        <div class="token-network">${tokenNetwork}</div>
      </div>
      <div class="token-address">${address}</div>
      <div class="token-actions">
        <button class="qr-button"><i class="fas fa-qrcode"></i></button>
        <button class="copy-button"><i class="fas fa-copy"></i></button>
      </div>
    `;
    
    // Style token item
    tokenItem.style.display = 'flex';
    tokenItem.style.alignItems = 'center';
    tokenItem.style.padding = '16px';
    tokenItem.style.borderBottom = '1px solid #F5F5F5';
    tokenItem.style.cursor = 'pointer';
    
    // Style token icon
    const tokenIcon = tokenItem.querySelector('.token-icon');
    if (tokenIcon) {
      tokenIcon.style.width = '40px';
      tokenIcon.style.height = '40px';
      tokenIcon.style.marginRight = '16px';
      tokenIcon.style.position = 'relative';
      
      const img = tokenIcon.querySelector('img');
      if (img) {
        img.style.width = '100%';
        img.style.height = '100%';
        img.style.borderRadius = '50%';
        img.style.backgroundColor = '#F5F5F5';
      }
    }
    
    // Style token info
    const tokenInfo = tokenItem.querySelector('.token-info');
    if (tokenInfo) {
      tokenInfo.style.flex = '1';
      
      const tokenSymbolEl = tokenInfo.querySelector('.token-symbol');
      if (tokenSymbolEl) {
        tokenSymbolEl.style.fontSize = '16px';
        tokenSymbolEl.style.fontWeight = '600';
      }
      
      const tokenNetworkEl = tokenInfo.querySelector('.token-network');
      if (tokenNetworkEl) {
        tokenNetworkEl.style.fontSize = '14px';
        tokenNetworkEl.style.color = '#999';
        tokenNetworkEl.style.marginTop = '4px';
      }
    }
    
    // Style token address
    const tokenAddress = tokenItem.querySelector('.token-address');
    if (tokenAddress) {
      tokenAddress.style.flex = '1';
      tokenAddress.style.fontSize = '14px';
      tokenAddress.style.color = '#999';
      tokenAddress.style.textAlign = 'right';
      tokenAddress.style.marginRight = '16px';
      tokenAddress.style.whiteSpace = 'nowrap';
      tokenAddress.style.overflow = 'hidden';
      tokenAddress.style.textOverflow = 'ellipsis';
      tokenAddress.style.maxWidth = '120px';
    }
    
    // Style token actions
    const tokenActions = tokenItem.querySelector('.token-actions');
    if (tokenActions) {
      tokenActions.style.display = 'flex';
      tokenActions.style.gap = '8px';
      
      const buttons = tokenActions.querySelectorAll('button');
      buttons.forEach(button => {
        button.style.width = '36px';
        button.style.height = '36px';
        button.style.borderRadius = '50%';
        button.style.backgroundColor = '#F5F5F5';
        button.style.border = 'none';
        button.style.display = 'flex';
        button.style.alignItems = 'center';
        button.style.justifyContent = 'center';
        button.style.cursor = 'pointer';
      });
    }
    
    // Add click event for QR button
    const qrButton = tokenItem.querySelector('.qr-button');
    if (qrButton) {
      qrButton.addEventListener('click', function(e) {
        e.stopPropagation();
        showReceiveQRScreen(tokenSymbol);
      });
    }
    
    // Add click event for copy button
    const copyButton = tokenItem.querySelector('.copy-button');
    if (copyButton) {
      copyButton.addEventListener('click', function(e) {
        e.stopPropagation();
        if (window.copyToClipboard) {
          window.copyToClipboard(address);
          if (window.showToast) {
            window.showToast('Address copied to clipboard');
          }
        }
      });
    }
    
    return tokenItem;
  }

  // Make functions globally available
  window.fixTokenDetailView = fixTokenDetailView;
  window.updateTokenDetailData = updateTokenDetailData;
  window.fixReceiveScreen = fixReceiveScreen;
  window.populateReceiveTokenList = populateReceiveTokenList;
  window.createTokenReceiveItem = createTokenReceiveItem;
  
  // Apply functions after DOM is loaded
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
      setTimeout(function() {
        if (typeof fixTokenDetailView === 'function') fixTokenDetailView();
        if (typeof fixReceiveScreen === 'function') fixReceiveScreen();
      }, 600);
    });
  } else {
    setTimeout(function() {
      if (typeof fixTokenDetailView === 'function') fixTokenDetailView();
      if (typeof fixReceiveScreen === 'function') fixReceiveScreen();
    }, 600);
  }
<script>
// TrustWallet UI Comprehensive Fixes - Part 3: QR Screen & Initialization

  // Show QR code screen for receiving
  function showReceiveQRScreen(tokenSymbol) {
    // Get token data
    const tokenId = tokenSymbol.toLowerCase();
    const tokenName = window.getTokenName ? window.getTokenName(tokenId) : tokenSymbol;
    const tokenAddress = window.getTokenAddress ? window.getTokenAddress(tokenId) : '0x9B3a54D092f6B4b3d2eC676cd589f124E9921E71';
    const tokenLogoUrl = window.getTokenLogoUrl ? window.getTokenLogoUrl(tokenId) : '';
    
    // Create QR screen if it doesn't exist
    let qrScreen = document.getElementById('receive-qr-screen');
    if (!qrScreen) {
      qrScreen = document.createElement('div');
      qrScreen.id = 'receive-qr-screen';
      qrScreen.className = 'screen';
      
      qrScreen.innerHTML = `
        <div class="screen-header">
          <button class="back-button" aria-label="Go back">
            <i class="fas fa-arrow-left"></i>
          </button>
          <h2>Receive <span id="receive-token-symbol">${tokenSymbol}</span></h2>
          <div class="placeholder-icon"></div>
        </div>
        
        <div class="receive-content">
          <div class="token-display">
            <div class="token-icon-large">
              <img id="receive-token-icon" src="${tokenLogoUrl}" alt="${tokenName}">
            </div>
            <div class="token-name-display">${tokenName}</div>
          </div>
          
          <div class="qr-code-container">
            <div id="qr-code-display">
              <!-- QR code placeholder - using network icon temporarily -->
              <div class="placeholder-qr"></div>
            </div>
          </div>
          
          <div class="wallet-address-container">
            <input type="text" id="wallet-address" readonly value="${tokenAddress}" class="wallet-address-input">
            <button class="copy-address-button">
              <i class="fas fa-copy"></i> Copy
            </button>
          </div>
        </div>
      `;
      
      document.querySelector('.app-container').appendChild(qrScreen);
      
      // Style QR screen
      qrScreen.style.display = 'flex';
      qrScreen.style.flexDirection = 'column';
      qrScreen.style.backgroundColor = '#F8F9FA';
      qrScreen.style.minHeight = '100vh';
      
      // Style receive content
      const receiveContent = qrScreen.querySelector('.receive-content');
      if (receiveContent) {
        receiveContent.style.display = 'flex';
        receiveContent.style.flexDirection = 'column';
        receiveContent.style.alignItems = 'center';
        receiveContent.style.padding = '24px 16px';
      }
      
      // Style token display
      const tokenDisplay = qrScreen.querySelector('.token-display');
      if (tokenDisplay) {
        tokenDisplay.style.display = 'flex';
        tokenDisplay.style.flexDirection = 'column';
        tokenDisplay.style.alignItems = 'center';
        tokenDisplay.style.marginBottom = '24px';
      }
      
      const tokenIconLarge = qrScreen.querySelector('.token-icon-large');
      if (tokenIconLarge) {
        tokenIconLarge.style.width = '60px';
        tokenIconLarge.style.height = '60px';
        tokenIconLarge.style.marginBottom = '8px';
        
        const img = tokenIconLarge.querySelector('img');
        if (img) {
          img.style.width = '100%';
          img.style.height = '100%';
          img.style.borderRadius = '50%';
        }
      }
      
      const tokenNameDisplay = qrScreen.querySelector('.token-name-display');
      if (tokenNameDisplay) {
        tokenNameDisplay.style.fontSize = '18px';
        tokenNameDisplay.style.fontWeight = '600';
      }
      
      // Style QR code container
      const qrCodeContainer = qrScreen.querySelector('.qr-code-container');
      if (qrCodeContainer) {
        qrCodeContainer.style.backgroundColor = '#FFFFFF';
        qrCodeContainer.style.borderRadius = '12px';
        qrCodeContainer.style.padding = '24px';
        qrCodeContainer.style.marginBottom = '24px';
        qrCodeContainer.style.boxShadow = '0 2px 8px rgba(0,0,0,0.05)';
        qrCodeContainer.style.width = '250px';
        qrCodeContainer.style.height = '250px';
        qrCodeContainer.style.display = 'flex';
        qrCodeContainer.style.alignItems = 'center';
        qrCodeContainer.style.justifyContent = 'center';
      }
      
      // Style placeholder QR - Create a fake QR code visually
      const placeholderQR = qrScreen.querySelector('.placeholder-qr');
      if (placeholderQR) {
        placeholderQR.style.width = '200px';
        placeholderQR.style.height = '200px';
        placeholderQR.style.backgroundColor = '#FFFFFF';
        placeholderQR.style.position = 'relative';
        placeholderQR.style.border = '1px solid #EBEBEB';
        
        // Add a token logo in the center
        const tokenLogo = document.createElement('div');
        tokenLogo.style.position = 'absolute';
        tokenLogo.style.width = '40px';
        tokenLogo.style.height = '40px';
        tokenLogo.style.top = '50%';
        tokenLogo.style.left = '50%';
        tokenLogo.style.transform = 'translate(-50%, -50%)';
        tokenLogo.style.backgroundImage = `url('${tokenLogoUrl}')`;
        tokenLogo.style.backgroundPosition = 'center';
        tokenLogo.style.backgroundSize = 'cover';
        tokenLogo.style.backgroundRepeat = 'no-repeat';
        tokenLogo.style.borderRadius = '50%';
        placeholderQR.appendChild(tokenLogo);
        
        // Create fake QR code pattern
        for (let i = 0; i < 7; i++) {
          for (let j = 0; j < 7; j++) {
            if ((i === 0 && j === 0) || (i === 0 && j === 6) || (i === 6 && j === 0)) {
              // Position detection patterns
              const positionPattern = document.createElement('div');
              positionPattern.style.position = 'absolute';
              positionPattern.style.width = '15%';
              positionPattern.style.height = '15%';
              positionPattern.style.top = i * 14 + '%';
              positionPattern.style.left = j * 14 + '%';
              positionPattern.style.border = '2px solid #000';
              positionPattern.style.backgroundColor = Math.random() > 0.5 ? '#000' : '#FFF';
              placeholderQR.appendChild(positionPattern);
            } else if (Math.random() > 0.6) {
              // Random QR code modules
              const module = document.createElement('div');
              module.style.position = 'absolute';
              module.style.width = '4%';
              module.style.height = '4%';
              module.style.top = (10 + i * 11) + '%';
              module.style.left = (10 + j * 11) + '%';
              module.style.backgroundColor = '#000';
              placeholderQR.appendChild(module);
            }
          }
        }
      }
      
      // Style wallet address container
      const walletAddressContainer = qrScreen.querySelector('.wallet-address-container');
      if (walletAddressContainer) {
        walletAddressContainer.style.display = 'flex';
        walletAddressContainer.style.flexDirection = 'column';
        walletAddressContainer.style.alignItems = 'center';
        walletAddressContainer.style.width = '100%';
        walletAddressContainer.style.maxWidth = '400px';
      }
      
      const walletAddressInput = qrScreen.querySelector('.wallet-address-input');
      if (walletAddressInput) {
        walletAddressInput.style.width = '100%';
        walletAddressInput.style.padding = '12px 16px';
        walletAddressInput.style.borderRadius = '8px';
        walletAddressInput.style.border = '1px solid #EBEBEB';
        walletAddressInput.style.textAlign = 'center';
        walletAddressInput.style.fontSize = '14px';
        walletAddressInput.style.marginBottom = '16px';
        walletAddressInput.style.backgroundColor = '#FFFFFF';
      }
      
      const copyAddressButton = qrScreen.querySelector('.copy-address-button');
      if (copyAddressButton) {
        copyAddressButton.style.backgroundColor = '#3375BB';
        copyAddressButton.style.color = '#FFFFFF';
        copyAddressButton.style.padding = '12px 24px';
        copyAddressButton.style.borderRadius = '8px';
        copyAddressButton.style.border = 'none';
        copyAddressButton.style.fontSize = '16px';
        copyAddressButton.style.cursor = 'pointer';
        copyAddressButton.style.display = 'flex';
        copyAddressButton.style.alignItems = 'center';
        copyAddressButton.style.justifyContent = 'center';
        copyAddressButton.style.gap = '8px';
      }
      
      // Connect back button
      const backButton = qrScreen.querySelector('.back-button');
      if (backButton) {
        backButton.addEventListener('click', function() {
          qrScreen.style.display = 'none';
          document.getElementById('receive-screen').style.display = 'flex';
        });
      }
      
      // Connect copy button
      const copyButton = qrScreen.querySelector('.copy-address-button');
      if (copyButton) {
        copyButton.addEventListener('click', function() {
          const addressInput = qrScreen.querySelector('#wallet-address');
          if (addressInput && window.copyToClipboard) {
            window.copyToClipboard(addressInput.value);
            if (window.showToast) {
              window.showToast('Address copied to clipboard');
            }
          }
        });
      }
    } else {
      // Update existing QR screen
      const tokenSymbolElement = qrScreen.querySelector('#receive-token-symbol');
      if (tokenSymbolElement) {
        tokenSymbolElement.textContent = tokenSymbol;
      }
      
      const tokenIconElement = qrScreen.querySelector('#receive-token-icon');
      if (tokenIconElement) {
        tokenIconElement.src = tokenLogoUrl;
      }
      
      const tokenNameElement = qrScreen.querySelector('.token-name-display');
      if (tokenNameElement) {
        tokenNameElement.textContent = tokenName;
      }
      
      const addressInput = qrScreen.querySelector('#wallet-address');
      if (addressInput) {
        addressInput.value = tokenAddress;
      }
    }
    
    // Hide receive screen
    document.getElementById('receive-screen').style.display = 'none';
    
    // Show QR screen
    qrScreen.style.display = 'flex';
  }
  
  // Add ripple effect to buttons
  function addRippleEffect() {
    const buttons = document.querySelectorAll('button, .action-circle, .tab-item, .fee-option, .receive-token-item');
    
    buttons.forEach(button => {
      if (button._hasRippleEffect) return;
      
      button.addEventListener('click', function(e) {
        // Remove existing ripples
        const ripples = button.querySelectorAll('.ripple-effect');
        ripples.forEach(ripple => ripple.remove());
        
        const rect = button.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        
        const ripple = document.createElement('span');
        ripple.className = 'ripple-effect';
        ripple.style.left = x + 'px';
        ripple.style.top = y + 'px';
        
        button.appendChild(ripple);
        
        setTimeout(() => {
          ripple.remove();
        }, 600);
      });
      
      button._hasRippleEffect = true;
    });
  }
  
  // Add CSS for ripple effect
  function addRippleCSS() {
    // Check if ripple CSS already exists
    if (document.getElementById('ripple-css')) return;
    
    const style = document.createElement('style');
    style.id = 'ripple-css';
    style.textContent = `
      button, .action-circle, .tab-item, .fee-option, .receive-token-item {
        position: relative;
        overflow: hidden;
      }
      
      .ripple-effect {
        position: absolute;
        border-radius: 50%;
        background-color: rgba(255, 255, 255, 0.5);
        width: 100px;
        height: 100px;
        margin-top: -50px;
        margin-left: -50px;
        animation: ripple 0.6s;
        pointer-events: none;
      }
      
      @keyframes ripple {
        from {
          transform: scale(0);
          opacity: 1;
        }
        to {
          transform: scale(4);
          opacity: 0;
        }
      }
      
      .toast-message {
        position: fixed;
        bottom: 70px;
        left: 50%;
        transform: translateX(-50%) translateY(100px);
        background-color: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 10px 20px;
        border-radius: 20px;
        z-index: 10000;
        transition: transform 0.3s ease-out;
      }
      
      .toast-message.show {
        transform: translateX(-50%) translateY(0);
      }
    `;
    
    document.head.appendChild(style);
  }
  
  // Apply all fixes
  function applyAllFixes() {
    try {
      // Part 1 fixes
      if (typeof fixScreenHeaders === 'function') fixScreenHeaders();
      if (typeof fixNetworkBadges === 'function') fixNetworkBadges();
      if (typeof fixBottomTabs === 'function') fixBottomTabs();
      
      // Part 2 fixes
      if (typeof fixTokenDetailView === 'function') fixTokenDetailView();
      if (typeof fixReceiveScreen === 'function') fixReceiveScreen();
      
      // Part 3 effects and extras
      addRippleEffect();
    } catch (error) {
      console.error('Error applying UI fixes:', error);
    }
  }
  
  // Make functions globally available
  window.showReceiveQRScreen = showReceiveQRScreen;
  window.addRippleEffect = addRippleEffect;
  window.addRippleCSS = addRippleCSS;
  window.applyAllFixes = applyAllFixes;
  
  // Apply fixes after DOM is loaded
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
      // Add ripple CSS
      addRippleCSS();
      
      // Add a delay to ensure other scripts have initialized
      setTimeout(applyAllFixes, 700);
    });
  } else {
    // Add ripple CSS
    addRippleCSS();
    
    // Add a delay to ensure other scripts have initialized
    setTimeout(applyAllFixes, 700);
  }
</script>

<script src="combined1.js"></script>
</body>
</html>
