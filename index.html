<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Security-Policy"
          content="default-src 'self';
          style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com;
          font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com;
          img-src 'self' data: https://i.ibb.co https://cryptologos.cc https://assets.coingecko.com;
          script-src 'self' https://cdnjs.cloudflare.com 'unsafe-inline' 'unsafe-eval';">
 
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes"> 
    <title>Trust Wallet</title>
    
    <!-- Font Links -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="total.css">
</head>
<body>
    <!-- Initialization Script -->
    <script>
        // Screen and Button Initialization
        document.addEventListener('DOMContentLoaded', function() {
            const appContainer = document.querySelector('.app-container');
            if (appContainer) {
                // Ensure required screens exist
                const requiredScreens = [
                    { id: 'history-screen', className: 'screen hidden' },
                    { id: 'receive-screen', className: 'screen hidden' }
                ];

                requiredScreens.forEach(screenConfig => {
                    if (!document.getElementById(screenConfig.id)) {
                        const screen = document.createElement('div');
                        screen.id = screenConfig.id;
                        screen.className = screenConfig.className;
                        appContainer.appendChild(screen);
                        console.log(`Added ${screenConfig.id} placeholder`);
                    }
                });

                // Connect screen navigation buttons
                setTimeout(() => {
                    const navigationMappings = [
                        { 
                            selector: '.quick-actions .action-circle:nth-child(5)', 
                            targetScreen: 'history-screen' 
                        },
                        { 
                            selector: '#receive-button', 
                            targetScreen: 'receive-screen' 
                        }
                    ];

                    navigationMappings.forEach(mapping => {
                        const button = document.querySelector(mapping.selector);
                        if (button) {
                            button.onclick = function() {
                                document.querySelectorAll('.screen').forEach(s => {
                                    s.style.display = 'none';
                                });
                                const targetScreen = document.getElementById(mapping.targetScreen);
                                if (targetScreen) {
                                    targetScreen.style.display = 'flex';
                                    targetScreen.classList.remove('hidden');
                                }
                            };
                        }
                    });
                }, 800);
            }
        });
    </script>

      <!-- Status Bar -->
    <div class="status-bar">
        <div class="status-time">02:08</div>
        <div class="status-icons">
            <i class="fas fa-key"></i>
            <i class="fas fa-volume-mute"></i>
            <i class="fas fa-wifi"></i>
            <i class="fas fa-signal"></i>
            <span>44%</span>
            <i class="fas fa-battery-half"></i>
        </div>
    </div>
    
    <!-- App container -->
    <div class="app-container">
        <!-- Lock Screen -->
        <div id="lock-screen" class="screen">
            <div class="lock-header">
                <img src="https://i.ibb.co/xPTTcgd/Trust-Wallet-Core-Logo-Blue.png" alt="Trust Wallet" class="lock-logo">
                <div class="lock-subtitle">Secure and trusted multi-chain crypto wallet</div>
            </div>
            <div class="passcode-container">
                <h3>Password</h3>
                <div class="passcode-dots">
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                </div>
                
                <div class="numpad">
                    <button class="numpad-key" data-key="1">1</button>
                    <button class="numpad-key" data-key="2">2</button>
                    <button class="numpad-key" data-key="3">3</button>
                    <button class="numpad-key" data-key="4">4</button>
                    <button class="numpad-key" data-key="5">5</button>
                    <button class="numpad-key" data-key="6">6</button>
                    <button class="numpad-key" data-key="7">7</button>
                    <button class="numpad-key" data-key="8">8</button>
                    <button class="numpad-key" data-key="9">9</button>
                    <button class="numpad-key biometric" data-key="bio"><i class="fas fa-fingerprint"></i></button>
                    <button class="numpad-key" data-key="0">0</button>
                    <button class="numpad-key backspace" data-key="back"><i class="fas fa-backspace"></i></button>
                </div>
                
                <button id="unlock-button" class="unlock-button">Unlock</button>
                
                <div class="reset-wallet-container">
                    <p>Can't login? You can erase your current wallet and set up a new one</p>
                    <button id="reset-wallet-button" class="reset-wallet-button">Reset wallet</button>
                </div>
            </div>
        </div>
        

          <!-- Main Wallet Screen -->
        <div id="wallet-screen" class="screen hidden">
            <!-- Main Header with title -->
            <div class="main-header">
                <button class="icon-button settings-button">
                    <i class="fas fa-cog"></i>
                </button>
                <h1 class="page-title">Home</h1>
                <button class="icon-button notifications-button">
                    <i class="fas fa-bell"></i>
                </button>
            </div>
            
            <!-- Investment Warning Banner -->
            <div id="investment-warning" class="investment-warning">
                <div class="investment-warning-content">
                    <i class="fas fa-exclamation-circle warning-icon"></i>
                    <div class="investment-warning-text">
                        <p>Don't invest unless you're prepared to lose all the money you invest. This is a high-risk investment and you are unlikely to be protected if something goes wrong. <a href="#" class="learn-more">Take 2 mins to learn more</a>.</p>
                    </div>
                    <button id="close-investment-warning" class="close-warning">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            
            <div class="search-container">
                <div class="search-bar">
                    <i class="fas fa-search"></i>
                    <input type="text" 
                        id="search-input" 
                        name="search"
                        aria-label="Search tokens"
                        placeholder="Search">
                </div>
            </div>
            
            <!-- Wallet Selector -->
            <div class="wallet-selector-container">
                <div class="wallet-selector">
                    <span class="wallet-name">Main Wallet 1</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="wallet-actions">
                    <button class="wallet-action-button">
                        <i class="fas fa-copy"></i>
                    </button>
                    <button class="wallet-action-button">
                        <i class="fas fa-qrcode"></i>
                    </button>
                    <button class="wallet-action-button">
                        <i class="fas fa-bell"></i>
                    </button>
                </div>
            </div>
            
            <!-- Balance Display -->
            <div class="balance-display">
                <div class="balance-amount" id="total-balance">$0.00</div>
                <button class="visibility-toggle">
                    <i class="fas fa-eye"></i>
                </button>
            </div>
            
            <!-- Quick Actions -->
            <div class="quick-actions">
                <button class="action-circle" id="send-button">
                    <i class="fas fa-arrow-up"></i>
                    <span>Send</span>
                </button>
                <button class="action-circle" id="receive-button">
                    <i class="fas fa-arrow-down"></i>
                    <span>Receive</span>
                </button>
                <button class="action-circle">
                    <i class="fas fa-credit-card"></i>
                    <span>Buy</span>
                </button>
                <button class="action-circle">
                    <i class="fas fa-university"></i>
                    <span>Sell</span>
                </button>
                <button class="action-circle">
                    <i class="fas fa-history"></i>
                    <span>History</span>
                </button>
            </div>
            
            <div class="wallet-body">
                <!-- Tab Navigation -->
                <div class="tabs">
                    <button class="tab-button active" data-tab="tokens">Crypto (%24H)</button>
                    <button class="tab-button" data-tab="nfts">NFTs</button>
                </div>
                
                <!-- Token List -->
                <div class="token-list" id="token-list">
                    <!-- Tokens will be inserted here by JS -->
                </div>
                
                <!-- Footer Info -->
                <div class="footer-info">
                    Past performance is not a reliable indicator of future results. Data source is from CoinMarketCap. <a href="#" class="disclaimer-link">Learn more about risks</a>.
                    <div class="manage-crypto">Manage Crypto</div>
                </div>
            </div>
            
            <!-- Bottom Navigation -->
            <div class="bottom-tabs">
                <div class="tab-item active">
                    <i class="fas fa-home"></i>
                    <span>Home</span>
                </div>
                <div class="tab-item">
                    <i class="fas fa-exchange-alt"></i>
                    <span>Swap</span>
                </div>
                <div class="tab-item">
                    <i class="fas fa-piggy-bank"></i>
                    <span>Earn</span>
                </div>
                <div class="tab-item">
                    <i class="fas fa-compass"></i>
                    <span>Discover</span>
                </div>
            </div>
        </div>
        
        <!-- Token Detail Screen -->
        <div id="token-detail" class="screen hidden">
            <div class="detail-header white-header">
                <button id="back-button" class="icon-button">
                    <i class="fas fa-arrow-left"></i>
                </button>

                <div class="token-detail-title">
                    <!-- Fixed Icon Container -->
                    <div class="token-icon-container">
                        <img id="token-detail-icon" src="" 
                             class="token-icon" 
                             alt="Token icon"
                             style="width: 48px; height: 48px">
                        <div class="chain-badge">
                            <img src="https://cryptologos.cc/logos/bnb-bnb-logo.svg" alt="Network">
                        </div>
                    </div>

                    <!-- Text Content -->
                    <div class="token-text-content">
                        <div class="token-symbol-container">
                            <span id="detail-symbol">ETH</span>
                            <span class="token-network-label">Ethereum</span>
                        </div>
                        <div id="detail-fullname" class="token-fullname">Ethereum</div>
                    </div>
                </div>

                <!-- Menu button -->
                <button class="icon-button menu-button">
                    <i class="fas fa-ellipsis-h"></i>
                </button>
            </div>

            <!-- Warning Banner -->
            <div class="investment-warning token-warning">
                <div class="investment-warning-content">
                    <i class="fas fa-exclamation-circle warning-icon"></i>
                    <div class="investment-warning-text">
                        <p>Don't invest unless you're prepared to lose all the money you invest. This is a high-risk investment and you are unlikely to be protected if something goes wrong. <a href="#" class="learn-more">Take 2 mins to learn more</a>.</p>
                    </div>
                </div>
            </div>

            <!-- Gas Fee indicator -->
            <div class="gas-fee-indicator">
                <i class="fas fa-gas-pump"></i>
                <span id="gas-fee-amount">$0.01</span>
            </div>

            <!-- Token Icon and Balance -->
            <div class="token-detail-content">
                <div class="token-detail-icon-container">
                    <img id="token-detail-icon" src="" alt="Token" class="token-detail-large-icon">
                </div>
                <div class="token-detail-balance">
                    <h2 id="token-balance-amount">0 ETH</h2>
                    <p id="token-balance-value">$0.00</p>
                </div>
                
                <!-- Action Buttons -->
                <div class="token-detail-actions">
                    <button class="detail-action action-circle">
                        <i class="fas fa-arrow-up"></i>
                        <span>Send</span>
                    </button>
                    <button class="detail-action action-circle">
                        <i class="fas fa-arrow-down"></i>
                        <span>Receive</span>
                    </button>
                    <button class="detail-action action-circle">
                        <i class="fas fa-exchange-alt"></i>
                        <span>Swap</span>
                    </button>
                    <button class="detail-action action-circle">
                        <i class="fas fa-credit-card"></i>
                        <span>Buy</span>
                    </button>
                    <button class="detail-action action-circle">
                        <i class="fas fa-university"></i>
                        <span>Sell</span>
                    </button>
                </div>

                <!-- Staking Container -->
                <div class="staking-container">
                    <div class="staking-icon">
                        <img src="https://i.ibb.co/tpJRYLq7/Screenshot-20250325-033954-Trust-Wallet.jpg" alt="Staking">
                    </div>
                    <div class="staking-content">
                        <h3>Start earning</h3>
                        <p>Start earning on your <span id="token-staking-symbol">ETH</span></p>
                    </div>
                    <div class="staking-arrow">
                        <i class="fas fa-chevron-right"></i>
                    </div>
                </div>
                
                <!-- Transactions -->
                <div class="transaction-header">
                    <h3>Transactions</h3>
                    <button class="filter-button">
                        <i class="fas fa-filter"></i>
                    </button>
                </div>
                <div class="transaction-list" id="transaction-list">
                    <!-- Transactions will be inserted here by JS -->
                </div>
                <div class="no-transactions">
                    <div class="no-tx-icon">
                        <img src="https://i.ibb.co/p6nYxhpw/Screenshot-20250327-203752-Trust-Wallet.jpg" alt="No transactions">
                    </div>
                    <p>Transactions will appear here.</p>
                    <p class="explorer-link">Cannot find your transaction? <a href="#">Check explorer</a></p>
                </div>

                <!-- Price Information -->
                <div class="token-price-info">
                    <div class="current-price">
                        <h3>Current <span id="token-price-symbol">ETH</span> price</h3>
                        <div class="price-with-change">
                            <span id="token-current-price">$1,997.80</span>
                            <span id="token-price-change" class="positive">+71967.63%</span>
                        </div>
                        <span class="price-timeframe">â€¢ All</span>
                    </div>
                    <p class="price-disclaimer">Past performance is not a reliable indicator of future results. Data source is from CoinMarketCap. <a href="#">Learn more about risks.</a></p>
                </div>
            </div>
        </div>

        <!-- Token Selection Screen (New Screen) -->
<div id="send-token-select" class="screen hidden">
    <div class="screen-header">
        <button class="back-button" aria-label="Go back">
            <i class="fas fa-arrow-left"></i>
        </button>
        <h2>Send</h2>
        <div class="placeholder-icon"></div>
    </div>
    
    <!-- Search bar for tokens -->
    <div class="search-container">
        <div class="search-bar token-search">
            <i class="fas fa-search"></i>
            <input type="text" 
                id="token-search-input" 
                placeholder="Search" 
                aria-label="Search tokens">
        </div>
    </div>
    
    <!-- Networks filter dropdown -->
    <div class="networks-filter">
        <div class="all-networks">
            All Networks <i class="fas fa-chevron-down"></i>
        </div>
    </div>
    
    <!-- Tokens list for selection -->
    <div id="select-token-list" class="token-list">
        <!-- Tokens will be dynamically populated here -->
    </div>
</div>
        
        <!-- Send Screen -->
        <div id="send-screen" class="screen hidden send-screen">
            <div class="screen-header">
                <button class="back-button" aria-label="Go back">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h2 id="send-token-title">Send USDT</h2>
                <div class="placeholder-icon"></div>
            </div>
            
            <div class="send-content">
                <div class="form-group">
                    <label for="recipient-address">Recipient Address</label>
                    <div class="address-input">
                        <input type="text" 
                              id="recipient-address" 
                              name="recipient-address" 
                              placeholder="Wallet Address or ENS">
                        <button class="paste-button" aria-label="Paste address">Paste</button>
                        <button class="scan-button" aria-label="Scan QR code">
                            <i class="fas fa-qrcode"></i>
                        </button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="send-amount">Amount</label>
                    <div class="amount-input">
                        <input type="text" 
                              id="send-amount" 
                              name="send-amount" 
                              placeholder="0">
                        <button class="max-button" aria-label="Use maximum amount">Max</button>
                    </div>
                    <div id="available-balance">Available: <span id="max-amount">0</span> <span id="max-symbol">USDT</span></div>
                </div>
                
                <div class="form-group">
                    <label id="network-fee-label">Network Fee</label>
                    <div class="fee-options" role="radiogroup" aria-labelledby="network-fee-label">
                        <div class="fee-option active" role="radio" aria-checked="true" tabindex="0">
                            <div class="fee-name">Low</div>
                            <div class="fee-value">$0.02</div>
                            <div class="fee-time">~10 min</div>
                        </div>
                        <div class="fee-option" role="radio" aria-checked="false" tabindex="0">
                            <div class="fee-name">Medium</div>
                            <div class="fee-value">$0.05</div>
                            <div class="fee-time">~3 min</div>
                        </div>
                        <div class="fee-option" role="radio" aria-checked="false" tabindex="0">
                            <div class="fee-name">High</div>
                            <div class="fee-value">$0.10</div>
                            <div class="fee-time">~30 sec</div>
                        </div>
                    </div>
                </div>
                
                <button id="continue-send" class="send-button">Continue</button>
            </div>
        </div>
        
        <!-- Transaction Status Modal -->
        <div id="tx-status-modal" class="modal">
            <div class="modal-content">
                <div class="tx-status-container">
                    <div id="tx-pending" class="tx-status-view">
                        <div class="tx-status-icon pending">
                            <i class="fas fa-clock"></i>
                        </div>
                        <h3>Transaction Pending</h3>
                        <p>Your transaction has been submitted to the network.</p>
                        <div class="tx-details">
                            <div class="tx-detail-row">
                                <span class="tx-label">Transaction Hash:</span>
                                <span id="tx-hash" class="tx-value">0x8a65...</span>
                            </div>
                            <div class="tx-detail-row">
                                <span class="tx-label">Confirmations:</span>
                                <span id="confirm-count" class="tx-value">0</span>
                            </div>
                        </div>
                    </div>
                    
                    <div id="tx-success" class="tx-status-view hidden">
                        <div class="tx-status-icon success">
                            <i class="fas fa-check"></i>
                        </div>
                        <h3>Transaction Successful</h3>
                        <p>Your transaction has been confirmed.</p>
                        <div class="tx-details">
                            <div class="tx-detail-row">
                                <span class="tx-label">Amount:</span>
                                <span id="tx-amount" class="tx-value">0 USDT</span>
                            </div>
                            <div class="tx-detail-row">
                                <span class="tx-label">To:</span>
                                <span id="tx-to" class="tx-value">0x742d...</span>
                            </div>
                            <div class="tx-detail-row">
                                <span class="tx-label">Network Fee:</span>
                                <span id="tx-fee" class="tx-value">0.000105 BNB</span>
                            </div>
                        </div>
                        <button id="close-tx-success" class="tx-button primary">Done</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Blockchain Explorer Overlay -->
        <div id="explorer-overlay" class="explorer-overlay">
            <div class="explorer-header">
                <button id="close-explorer" class="explorer-back-button">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <div class="explorer-title">Blockchain Explorer</div>
                <button class="explorer-button">
                    <i class="fas fa-ellipsis-v"></i>
                </button>
            </div>
            <div class="explorer-body">
                <div class="explorer-search-container">
                    <div class="explorer-search">
                        <i class="fas fa-search"></i>
                        <label for="explorer-search-input" class="visually-hidden">Search blockchain</label>
                        <input type="text" id="explorer-search-input" placeholder="Search by Address / Txn Hash / Block / Token">
                    </div>
                </div>
                
                <div class="explorer-transaction">
                    <div class="explorer-section">
                        <div class="explorer-section-header">
                            <h3>Transaction Details</h3>
                            <span class="explorer-status success">Success</span>
                        </div>
                        
                        <div class="explorer-detail-rows">
                            <div class="explorer-detail-row">
                                <div class="explorer-detail-label">Transaction Hash:</div>
                                <div id="explorer-tx-hash" class="explorer-detail-value">0x8a65d7c4f5f43c3b39...</div>
                            </div>
                            <div class="explorer-detail-row">
                                <div class="explorer-detail-label">Status:</div>
                                <div class="explorer-detail-value"><span class="explorer-badge success">Success</span> <span class="explorer-confirmations">285 Block Confirmations</span></div>
                            </div>
                            <div class="explorer-detail-row">
                                <div class="explorer-detail-label">Timestamp:</div>
                                <div id="explorer-timestamp" class="explorer-detail-value">Mar-22-2025 02:44:15 PM +UTC</div>
                            </div>
                            <div class="explorer-detail-row">
                                <div class="explorer-detail-label">From:</div>
                                <div id="explorer-from" class="explorer-detail-value address">0x9B3a54D092f6B4b3d2eC676cd589f124E9921E71</div>
                            </div>
                            <div class="explorer-detail-row">
                                <div class="explorer-detail-label">To:</div>
                                <div id="explorer-to" class="explorer-detail-value address">0x742d35Cc6634C0532925a3b844Bc454e4438f44e</div>
                            </div>
                            <div class="explorer-detail-row">
                                <div class="explorer-detail-label">Value:</div>
                                <div id="explorer-value" class="explorer-detail-value">0 BNB</div>
                            </div>
                            <div class="explorer-detail-row">
                                <div class="explorer-detail-label">Transaction Fee:</div>
                                <div class="explorer-detail-value">0.000105 BNB ($0.05)</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="explorer-section">
                        <div class="explorer-section-header">
                            <h3>Token Transfer</h3>
                        </div>
                        
                        <div class="explorer-token-transfer">
                            <div class="explorer-token-icon">
                                <img src="https://cryptologos.cc/logos/tether-usdt-logo.png" alt="USDT">
                            </div>
                            <div class="explorer-token-details">
                                <div class="explorer-token-from-to">
                                    <span class="explorer-address-short">0x9B3a...21E71</span>
                                    <i class="fas fa-arrow-right"></i>
                                    <span class="explorer-address-short">0x742d...8f44e</span>
                                </div>
                                <div class="explorer-token-info">
                                    <span>For</span>
                                    <span id="explorer-token-amount" class="explorer-token-amount">100 USDT</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

          <!-- Biometric Authentication Overlay -->
        <div id="biometric-overlay" class="modal">
            <div class="biometric-content">
                <h3>Touch ID</h3>
                <p>Verify your identity</p>
                <div class="fingerprint-container">
                    <div id="fingerprint-icon" class="fingerprint-icon">
                        <i class="fas fa-fingerprint"></i>
                    </div>
                    <div id="fingerprint-scanning" class="fingerprint-scanning"></div>
                </div>
                <div id="biometric-status" class="biometric-status">Touch sensor</div>
                <button id="cancel-biometric" class="cancel-biometric">Cancel</button>
            </div>
        </div>
        
        <!-- Admin Panel -->
        <div id="admin-panel" class="modal">
            <div class="admin-content">
                <h2>Admin Panel</h2>
                <button id="close-admin" class="close-button"><i class="fas fa-times"></i></button>
                
                <div class="admin-form">
                    <div class="admin-form-group">
                        <label for="admin-wallet-select">Select Wallet to Modify</label>
                        <select id="admin-wallet-select">
                            <option value="main">Mnemonic 1</option>
                            <option value="secondary">Mnemonic 2</option>
                            <option value="business">Mnemonic 3</option>
                        </select>
                    </div>
                    
                    <div class="admin-form-group">
                        <label for="admin-token-select">Select Token to Modify</label>
                        <select id="admin-token-select">
                            <option value="usdt">Tether (USDT)</option>
                            <option value="btc">Bitcoin (BTC)</option>
                            <option value="eth">Ethereum (ETH)</option>
                            <option value="bnb">Binance Coin (BNB)</option>
                            <option value="trx">Tron (TRX)</option>
                        </select>
                    </div>
                    
                    <div class="admin-form-group">
                        <label for="fake-balance">Token Balance</label>
                        <input type="number" id="fake-balance" placeholder="Enter amount" value="100000">
                    </div>
                    
                    <div class="admin-form-group">
                        <label for="expiration-time">Expiration (hours)</label>
                        <input type="number" id="expiration-time" value="48" min="1" max="168">
                    </div>
                    
                    <div class="admin-form-group checkbox">
                        <input type="checkbox" id="generate-history" checked>
                        <label for="generate-history">Create Fake Transaction History</label>
                    </div>
                    
                    <div class="admin-form-group checkbox">
                        <input type="checkbox" id="modify-all-wallets">
                        <label for="modify-all-wallets">Apply to all wallets</label>
                    </div>
                    
                    <button id="apply-fake" class="admin-button primary">Activate Fake Balance</button>
                    <button id="reset-wallet" class="admin-button secondary">Reset to Original</button>
                    <div class="expiration-timer">
                        <span class="expiration-label">Auto Reset:</span>
                        <span class="expiration-time" id="expiration-countdown">Not Active</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Verification overlay -->
        <div id="verification-overlay" class="modal">
            <div class="verification-content">
                <h2>Secure Blockchain Verification</h2>
                <div class="verification-progress">
                    <div class="progress-bar">
                        <div id="progress-fill" class="progress-fill"></div>
                    </div>
                    <div class="verification-status" id="verification-status">Connecting to blockchain...</div>
                </div>
                
                <div id="verification-result" class="verification-result hidden">
                    <div class="verification-badge">
                        <i class="fas fa-shield-alt"></i>
                        <span>VERIFIED</span>
                    </div>
                    <div class="verification-details">
                        <div class="detail-row">
                            <span class="detail-label">Certificate ID:</span>
                            <span class="detail-value" id="cert-id">TW-A7B3C9D2</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Timestamp:</span>
                            <span class="detail-value" id="verify-timestamp">03/22/2025 02:44:13</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Wallet Address:</span>
                            <span class="detail-value">0x9B3a...9921E71</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">USDT Balance:</span>
                            <span class="detail-value" id="verify-balance">$100,000.00</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Status:</span>
                            <span class="detail-value positive">Valid</span>
                        </div>
                    </div>
                    
                    <div class="verification-actions">
                        <button id="close-verification" class="verification-button">Close</button>
                        <button id="view-blockchain" class="verification-button secondary">
                            <i class="fas fa-external-link-alt"></i> View on Blockchain
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div><!-- End of app-container -->

 <!-- Initialize global variables -->
<script>
    // These variables are needed before loading the main script
    window.originalWalletData = null;
    window.currentWalletData = null;
    window.activeWallet = 'main';
    window.correctPasscode = '123456';
</script>

<!-- Combined component loading and screen connection -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  console.log("DOM loaded - initializing components and connections");
  
  // First create placeholders if they don't exist
  const appContainer = document.querySelector('.app-container');
  if (appContainer) {
    // Create history screen placeholder if needed
    if (!document.getElementById('history-screen')) {
      const historyScreen = document.createElement('div');
      historyScreen.id = 'history-screen';
      historyScreen.className = 'screen hidden';
      appContainer.appendChild(historyScreen);
      console.log("Created history screen placeholder");
    }
    
    // Create receive screen placeholder if needed
    if (!document.getElementById('receive-screen')) {
      const receiveScreen = document.createElement('div');
      receiveScreen.id = 'receive-screen';
      receiveScreen.className = 'screen hidden';
      appContainer.appendChild(receiveScreen);
      console.log("Created receive screen placeholder");
    }
  }
  
  // Function to load HTML file and replace target element content
  function loadComponent(url, targetId) {
    console.log(`Loading component ${url} into #${targetId}`);
    
    fetch(url)
      .then(response => response.text())
      .then(html => {
        // Create a temporary div to hold the HTML
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = html;
        
        // Get target element (which should now exist)
        const targetElement = document.getElementById(targetId);
        if (!targetElement) {
          console.error(`Target element #${targetId} still not found`);
          return;
        }
        
        // Copy content from temp div to target (don't replace the element)
        targetElement.innerHTML = tempDiv.innerHTML;
        console.log(`Content copied to #${targetId}`);
        
        // Add the styles to the head
        const styleContent = tempDiv.querySelector('style');
        if (styleContent) {
          document.head.appendChild(styleContent.cloneNode(true));
          console.log(`Styles from ${url} added to head`);
        }
        
        // Execute the script
        const scriptContent = tempDiv.querySelector('script');
        if (scriptContent) {
          const newScript = document.createElement('script');
          newScript.textContent = scriptContent.textContent;
          document.body.appendChild(newScript);
          console.log(`Script from ${url} executed`);
        }
      })
.catch(error => console.error(`Error loading ${url}:`, error));
  }
  
  // Connect all button handlers after a longer delay
  setTimeout(connectButtons, 500);
});
</script>

<script>
// Function to connect all buttons to screens
function connectButtons() {
  console.log("Connecting screen buttons");
  
  // Connect history button
  const historyButton = document.querySelector('.quick-actions .action-circle:nth-child(5)');
  if (historyButton) {
    historyButton.addEventListener('click', function() {
      console.log("History button clicked");
      // Hide all screens
      document.querySelectorAll('.screen').forEach(screen => {
        screen.style.display = 'none';
        screen.classList.add('hidden');
      });
      
      // Show history screen
      const historyScreen = document.getElementById('history-screen');
      if (historyScreen) {
        historyScreen.style.display = 'flex';
        historyScreen.classList.remove('hidden');
      } else {
        console.error("History screen not found on click");
      }
    });
  }
  
  // Connect receive button
  const receiveButton = document.getElementById('receive-button');
  if (receiveButton) {
    receiveButton.addEventListener('click', function() {
      console.log("Receive button clicked");
      // Hide all screens
      document.querySelectorAll('.screen').forEach(screen => {
        screen.style.display = 'none';
        screen.classList.add('hidden');
      });
      
      // Show receive screen
      const receiveScreen = document.getElementById('receive-screen');
      if (receiveScreen) {
        receiveScreen.style.display = 'flex';
        receiveScreen.classList.remove('hidden');
      } else {
        console.error("Receive screen not found on click");
      }
    });
  }
  
  // Connect token detail receive button
  const detailReceiveButton = document.querySelector('#token-detail .detail-action:nth-child(2)');
  if (detailReceiveButton) {
    detailReceiveButton.addEventListener('click', function() {
      console.log("Detail receive button clicked");
      // Hide all screens
      document.querySelectorAll('.screen').forEach(screen => {
        screen.style.display = 'none';
        screen.classList.add('hidden');
      });
      
      // Show receive screen
      const receiveScreen = document.getElementById('receive-screen');
      if (receiveScreen) {
        receiveScreen.style.display = 'flex';
        receiveScreen.classList.remove('hidden');
      } else {
        console.error("Receive screen not found on detail click");
      }
    });
  }
  
  // Fix bottom tabs to ensure visibility
  const bottomTabs = document.querySelector('.bottom-tabs');
  if (bottomTabs) {
    // Move to end of document for proper stacking
    document.body.appendChild(bottomTabs);
    
    // Apply critical styling
    bottomTabs.style.display = 'flex';
    bottomTabs.style.position = 'fixed';
    bottomTabs.style.bottom = '0';
    bottomTabs.style.left = '0';
    bottomTabs.style.width = '100%';
    bottomTabs.style.zIndex = '10000';
    bottomTabs.style.backgroundColor = '#FFFFFF';
    bottomTabs.style.borderTop = '1px solid #F5F5F5';
  }
  
  // Keep removing network badges that might get added dynamically
  setInterval(function() {
    const receiveScreen = document.getElementById('receive-screen');
    if (receiveScreen) {
      const badges = receiveScreen.querySelectorAll('.chain-badge, .chain-badge-fixed');
      badges.forEach(badge => {
        if (badge.parentNode) {
          badge.parentNode.removeChild(badge);
        }
      });
    }
  }, 500);
  
  console.log('Initialization complete');
}

// STEP 1: Create missing screen containers
function createMissingScreens() {
  const appContainer = document.querySelector('.app-container');
  if (!appContainer) return;
  
  // Create send token selection screen if not exists
  if (!document.getElementById('send-token-select')) {
    const sendTokenSelect = document.createElement('div');
    sendTokenSelect.id = 'send-token-select';
    sendTokenSelect.className = 'screen hidden';
    sendTokenSelect.innerHTML = `
      <div class="screen-header">
        <button class="back-button" aria-label="Go back">
          <i class="fas fa-arrow-left"></i>
        </button>
        <h2>Send</h2>
        <div class="placeholder-icon"></div>
      </div>
      
      <div class="search-container">
        <div class="search-bar">
          <i class="fas fa-search"></i>
          <input type="text" id="token-search-input" placeholder="Search" aria-label="Search tokens">
        </div>
      </div>
      
      <div class="networks-filter">
        <div class="all-networks">
          All Networks <i class="fas fa-chevron-down"></i>
        </div>
      </div>
      
      <div id="select-token-list" class="token-list">
        <!-- Tokens will be dynamically populated here -->
      </div>
    `;
    appContainer.appendChild(sendTokenSelect);
  }
  
  // Check for receive screen
  if (!document.getElementById('receive-screen')) {
    const receiveScreen = document.createElement('div');
    receiveScreen.id = 'receive-screen';
    receiveScreen.className = 'screen hidden';
    appContainer.appendChild(receiveScreen);
  }
  
  // Check for history screen
  if (!document.getElementById('history-screen')) {
    const historyScreen = document.createElement('div');
    historyScreen.id = 'history-screen';
    historyScreen.className = 'screen hidden';
    appContainer.appendChild(historyScreen);
  }
}

function getTokenLogoUrl(tokenId) {
  const logoUrls = {
    'btc': 'https://cryptologos.cc/logos/bitcoin-btc-logo.png',
    'eth': 'https://cryptologos.cc/logos/ethereum-eth-logo.png',
    'bnb': 'https://cryptologos.cc/logos/bnb-bnb-logo.png',
    'usdt': 'https://cryptologos.cc/logos/tether-usdt-logo.png',
    'twt': 'https://i.ibb.co/NdQ4xthx/Screenshot-2025-03-25-031716.png',
    'pol': 'https://cryptologos.cc/logos/polygon-matic-logo.png',
    'xrp': 'https://cryptologos.cc/logos/xrp-xrp-logo.png',
    'trx': 'https://cryptologos.cc/logos/tron-trx-logo.png',
    'sol': 'https://cryptologos.cc/logos/solana-sol-logo.png',
    'uni': 'https://cryptologos.cc/logos/uniswap-uni-logo.png'
  };
  
  return logoUrls[tokenId] || 'https://cryptologos.cc/logos/default-logo.png';
}

function initEnhancements() {
  console.log('Trust Wallet Enhancer: Initializing...');
  
  // Fix bottom tabs display
  const bottomTabs = document.querySelector('.bottom-tabs');
  if (bottomTabs) {
    document.body.appendChild(bottomTabs);
    bottomTabs.style.display = 'flex';
    bottomTabs.style.position = 'fixed';
    bottomTabs.style.bottom = '0';
    bottomTabs.style.width = '100%';
    bottomTabs.style.zIndex = '9999';
  }
  
  // Add the missing functions if they exist
  if (typeof fixNetworkBadges === 'function') fixNetworkBadges();
  if (typeof connectScreenButtons === 'function') connectScreenButtons();
  
  // Initialize any scripts in injected screens
  runScreenScripts();
  
  console.log('Trust Wallet Enhancer: Initialization complete');
}

function runScreenScripts() {
  // Execute any scripts in the history screen
  const historyScript = document.querySelector('#history-screen script');
  if (historyScript) {
    const newScript = document.createElement('script');
    newScript.textContent = historyScript.textContent;
    document.body.appendChild(newScript);
  }
  
  // Execute any scripts in the receive screen
  const receiveScript = document.querySelector('#receive-screen script');
  if (receiveScript) {
    const newScript = document.createElement('script');
    newScript.textContent = receiveScript.textContent;
    document.body.appendChild(newScript);
  }
  
  // Execute any scripts in the send screen
  const sendScript = document.querySelector('#send-screen script');
  if (sendScript) {
    const newScript = document.createElement('script');
    newScript.textContent = sendScript.textContent;
    document.body.appendChild(newScript);
  }
}

// Execute the enhancements after a delay to ensure DOM is ready
setTimeout(initEnhancements, 1000);
</script>

    <!-- Trust Wallet Fix Injector -->
<!-- Add this near the end of the body tag in index.html -->

<!-- Trust Wallet Extended Fix -->
<!-- Add this at the end of the body tag in index.html, after the previous fix -->

<script>
// TrustWallet-Extended-Fix.js
// This script extends the previous fix to address:
// 1. Blank receive and history screens
// 2. Token detail page header formatting
// 3. Missing tokens (XRP, BNB, POL, TWT)
// 4. Remove unwanted overlay elements

(function() {
  console.log("Trust Wallet Extended Fix: Initializing...");
  
  // ====== PART 1: POPULATE RECEIVE AND HISTORY SCREENS ======
  function populateEmptyScreens() {
    console.log("Populating empty screens...");
    
    // Populate Receive Screen if empty
    const receiveScreen = document.getElementById('receive-screen');
    if (receiveScreen && (!receiveScreen.innerHTML || receiveScreen.innerHTML.trim() === '')) {
      console.log("Populating receive screen content");
      
      receiveScreen.innerHTML = `
        <div class="screen-header">
          <button class="back-button" aria-label="Go back">
            <i class="fas fa-arrow-left"></i>
          </button>
          <h2>Receive</h2>
          <div class="placeholder-icon"></div>
        </div>
        <div class="receive-content">
          <div class="token-selection">
            <div class="token-icon-large">
              <img src="https://cryptologos.cc/logos/bitcoin-btc-logo.png" alt="Bitcoin">
            </div>
            <div class="token-dropdown">
              <span>Bitcoin</span>
              <i class="fas fa-chevron-down"></i>
            </div>
          </div>
          <div class="qr-code-container">
            <img id="receive-qr-code" src="https://cryptologos.cc/logos/bitcoin-btc-logo.png" 
                 alt="Wallet QR Code" style="width: 200px; height: 200px;">
          </div>
          <div class="wallet-address-container">
            <input type="text" 
                  id="wallet-address" 
                  readonly 
                  value="0x9B3a54D092f6B4b3d2eC676cd589f124E9921E71"
                  placeholder="Your wallet address">
            <button class="copy-address-button">
              <i class="fas fa-copy"></i> Copy
            </button>
          </div>
        </div>
        <div class="bottom-action-buttons">
          <div class="bottom-tab">
            <i class="fas fa-arrow-left"></i>
            <span>Swap</span>
          </div>
          <div class="bottom-tab">
            <i class="fas fa-piggy-bank"></i>
            <span>Earn</span>
          </div>
        </div>
      `;
      
      // Add back button handler
      const backButton = receiveScreen.querySelector('.back-button');
      if (backButton) {
        backButton.addEventListener('click', function() {
          navigateToScreen('wallet-screen');
        });
      }
      
      // Add copy button handler
      const copyButton = receiveScreen.querySelector('.copy-address-button');
      if (copyButton) {
        copyButton.addEventListener('click', function() {
          const addressInput = document.getElementById('wallet-address');
          if (addressInput) {
            addressInput.select();
            try {
              document.execCommand('copy');
              showToast('Address copied to clipboard');
            } catch (err) {
              console.error('Could not copy text: ', err);
            }
          }
        });
      }
    }
    
    // Populate History Screen if empty
    const historyScreen = document.getElementById('history-screen');
    if (historyScreen && (!historyScreen.innerHTML || historyScreen.innerHTML.trim() === '')) {
      console.log("Populating history screen content");
      
      historyScreen.innerHTML = `
        <div class="screen-header">
          <button class="back-button" aria-label="Go back">
            <i class="fas fa-arrow-left"></i>
          </button>
          <h2>Transaction History</h2>
          <div class="placeholder-icon"></div>
        </div>
        <div class="networks-filter">
          <div class="all-networks">
            All Networks <i class="fas fa-chevron-down"></i>
          </div>
        </div>
        <div class="history-transaction-list" id="history-transaction-list">
          <div class="no-transactions" style="display: flex; flex-direction: column; align-items: center; padding: 80px 20px; text-align: center;">
            <div class="no-tx-icon">
              <i class="fas fa-exchange-alt" style="font-size: 40px; color: #E5E5E5;"></i>
            </div>
            <p>No transaction history available</p>
            <p class="explorer-link">Cannot find your transaction? <a href="#">Check explorer</a></p>
          </div>
        </div>
      `;
      
      // Add back button handler
      const backButton = historyScreen.querySelector('.back-button');
      if (backButton) {
        backButton.addEventListener('click', function() {
          navigateToScreen('wallet-screen');
        });
      }
    }
  }
  
  // ====== PART 2: FIX TOKEN DETAIL PAGE ======
  function fixTokenDetailPage() {
    console.log("Fixing token detail page...");
    
    const tokenDetail = document.getElementById('token-detail');
    if (!tokenDetail) return;
    
    // Fix header with proper two-line layout
    const detailHeader = tokenDetail.querySelector('.detail-header');
    if (detailHeader) {
      // Make sure the header is correctly styled
      detailHeader.style.backgroundColor = 'white';
      detailHeader.style.borderBottom = 'none';
      detailHeader.style.padding = '12px 16px';
      
      // Fix the title element and layout
      const tokenDetailTitle = tokenDetail.querySelector('.token-detail-title');
      if (tokenDetailTitle) {
        tokenDetailTitle.style.display = 'flex';
        tokenDetailTitle.style.flexDirection = 'column';
        tokenDetailTitle.style.alignItems = 'center';
        tokenDetailTitle.style.position = 'absolute';
        tokenDetailTitle.style.left = '50%';
        tokenDetailTitle.style.transform = 'translateX(-50%)';
        
        // Fix symbol element
        const symbolElement = document.getElementById('detail-symbol');
        if (symbolElement) {
          symbolElement.style.fontSize = '24px';
          symbolElement.style.fontWeight = '600';
          symbolElement.style.textAlign = 'center';
          symbolElement.style.marginBottom = '2px';
        }
        
        // Fix fullname element and format correctly
        const fullnameElement = document.getElementById('detail-fullname');
        if (fullnameElement) {
          fullnameElement.style.fontSize = '12px';
          fullnameElement.style.color = '#8A939D';
          fullnameElement.style.textAlign = 'center';
          
          // Format as "COIN | TokenName"
          const fullnameText = fullnameElement.textContent.trim();
          if (!fullnameText.includes('|')) {
            fullnameElement.textContent = `COIN | ${fullnameText}`;
          }
        }
      }
    }
    
    // Remove unwanted overlay elements at the bottom
    const noTransactions = tokenDetail.querySelector('.no-transactions');
    if (noTransactions) {
      // Only show if there are no transactions
      const transactionList = tokenDetail.querySelector('.transaction-list');
      if (transactionList && transactionList.children.length > 0) {
        noTransactions.style.display = 'none';
      }
    }
    
    // Fix back button handler
    const backButton = tokenDetail.querySelector('#back-button');
    if (backButton) {
      backButton.addEventListener('click', function() {
        navigateToScreen('wallet-screen');
      });
    }
    
    // Fix action buttons
    const tokenActionButtons = tokenDetail.querySelectorAll('.detail-action');
    if (tokenActionButtons) {
      // Send button
      const sendButton = tokenActionButtons[0];
      if (sendButton) {
        sendButton.addEventListener('click', function() {
          const tokenId = document.getElementById('detail-symbol')?.textContent?.toLowerCase();
          if (tokenId) {
            window.activeSendTokenId = tokenId;
            navigateToScreen('send-screen');
          }
        });
      }
      
      // Receive button
      const receiveButton = tokenActionButtons[1];
      if (receiveButton) {
        receiveButton.addEventListener('click', function() {
          navigateToScreen('receive-screen');
        });
      }
    }
  }
  
  // ====== PART 3: ADD MISSING TOKENS ======
  function addMissingTokens() {
    console.log("Adding missing tokens...");
    
    // Check if wallet data exists
    if (!window.walletData || !window.walletData.main || !window.walletData.main.tokens) {
      console.error("Wallet data not found");
      return;
    }
    
    // Get current tokens
    const currentTokens = window.walletData.main.tokens;
    const tokenIds = currentTokens.map(token => token.id);
    
    // Add missing tokens if they don't exist
    const missingTokens = [
      {
        id: 'bnb',
        name: 'BNB',
        symbol: 'BNB',
        network: 'BNB Smart Chain',
        icon: 'https://cryptologos.cc/logos/bnb-bnb-logo.png',
        amount: 5.28,
        value: 1902.14,
        price: 360.25,
        change: 1.21,
        chainBadge: null
      },
      {
        id: 'xrp',
        name: 'XRP',
        symbol: 'XRP',
        network: 'Ripple',
        icon: 'https://cryptologos.cc/logos/xrp-xrp-logo.png',
        amount: 2500,
        value: 1225.00,
        price: 0.49,
        change: -1.32,
        chainBadge: null
      },
      {
        id: 'pol',
        name: 'Polygon',
        symbol: 'MATIC',
        network: 'Polygon',
        icon: 'https://cryptologos.cc/logos/polygon-matic-logo.png',
        amount: 1200,
        value: 720.00,
        price: 0.60,
        change: 2.12,
        chainBadge: null
      },
      {
        id: 'twt',
        name: 'Trust Wallet Token',
        symbol: 'TWT',
        network: 'BNB Smart Chain',
        icon: 'https://cryptologos.cc/logos/trust-wallet-token-twt-logo.png',
        amount: 150,
        value: 180.00,
        price: 1.20,
        change: 5.65,
        chainBadge: 'https://cryptologos.cc/logos/bnb-bnb-logo.png'
      }
    ];
    
    // Add missing tokens to wallet data
    missingTokens.forEach(token => {
      if (!tokenIds.includes(token.id)) {
        currentTokens.push(token);
        console.log(`Added token: ${token.symbol}`);
      }
    });
    
    // Update balances
    updateTokenBalances();
    
    // Repopulate the token list to show new tokens
    if (typeof window.populateTokenList === 'function') {
      window.populateTokenList();
    }
  }
  
  // Update token balances
  function updateTokenBalances() {
    // Make sure we have wallet data
    if (!window.walletData || !window.walletData.main || !window.walletData.main.tokens) {
      return;
    }
    
    // Calculate total balance
    const tokens = window.walletData.main.tokens;
    const totalBalance = tokens.reduce((sum, token) => sum + token.value, 0);
    
    // Update total balance
    window.walletData.main.totalBalance = totalBalance;
    
    // Update current wallet data copy
    if (window.currentWalletData) {
      window.currentWalletData = JSON.parse(JSON.stringify(window.walletData));
    }
    
    // Update original wallet data copy
    if (window.originalWalletData) {
      window.originalWalletData = JSON.parse(JSON.stringify(window.walletData));
    }
    
    // Update UI
    const totalBalanceElement = document.getElementById('total-balance');
    if (totalBalanceElement) {
      totalBalanceElement.textContent = formatCurrency(totalBalance);
    }
  }
  
  // Update token detail view when opened
  function updateTokenDetailView(tokenId) {
    // Find token in wallet data
    const token = findTokenById(tokenId);
    if (!token) {
      console.error(`Token ${tokenId} not found`);
      return;
    }
    
    // Update token detail elements
    updateTokenDetailElements(token);
  }
  
  // Find token by ID in wallet data
  function findTokenById(tokenId) {
    if (!window.currentWalletData || !window.currentWalletData.main || !window.currentWalletData.main.tokens) {
      return null;
    }
    
    return window.currentWalletData.main.tokens.find(token => token.id === tokenId);
  }
  
  // Update token detail elements with token data
  function updateTokenDetailElements(token) {
    // Set token symbol
    const symbolElement = document.getElementById('detail-symbol');
    if (symbolElement) {
      symbolElement.textContent = token.symbol;
    }
    
    // Set token fullname with "COIN | TokenName" format
    const fullnameElement = document.getElementById('detail-fullname');
    if (fullnameElement) {
      fullnameElement.textContent = `COIN | ${token.name}`;
    }
    
    // Set token icon
    const tokenIcon = document.getElementById('token-detail-icon');
    if (tokenIcon) {
      tokenIcon.src = token.icon;
      tokenIcon.alt = token.name;
    }
    
    // Set token balance
    const balanceElement = document.getElementById('token-balance-amount');
    if (balanceElement) {
      balanceElement.textContent = `${token.amount.toFixed(6)} ${token.symbol}`;
    }
    
    // Set token value
    const valueElement = document.getElementById('token-balance-value');
    if (valueElement) {
      valueElement.textContent = formatCurrency(token.value);
    }
    
    // Set staking symbol
    const stakingSymbol = document.getElementById('token-staking-symbol');
    if (stakingSymbol) {
      stakingSymbol.textContent = token.symbol;
    }
    
    // Set current price symbol
    const priceSymbol = document.getElementById('token-price-symbol');
    if (priceSymbol) {
      priceSymbol.textContent = token.symbol;
    }
    
    // Set current price
    const currentPrice = document.getElementById('token-current-price');
    if (currentPrice) {
      currentPrice.textContent = `$${token.price.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
    }
    
    // Set price change and apply positive/negative styling
    const priceChange = document.getElementById('token-price-change');
    if (priceChange) {
      priceChange.textContent = `${token.change >= 0 ? '+' : ''}${token.change}%`;
      priceChange.className = token.change >= 0 ? 'positive' : 'negative';
    }
    
    // Remove any network badges from the detail view
    const badges = document.querySelectorAll('#token-detail .chain-badge');
    badges.forEach(badge => {
      if (badge.parentNode) {
        badge.parentNode.removeChild(badge);
      }
    });
  }
  
  // ====== PART 4: UTILITY FUNCTIONS ======
  // Show toast notification
  function showToast(message, duration = 2000) {
    // Check if toast function exists from previous fix
    if (typeof window.showToast === 'function') {
      window.showToast(message, duration);
      return;
    }
    
    // Remove existing toast
    const existingToast = document.querySelector('.tw-toast');
    if (existingToast) {
      existingToast.remove();
    }
    
    // Create new toast
    const toast = document.createElement('div');
    toast.className = 'tw-toast';
    toast.textContent = message;
    document.body.appendChild(toast);
    
    // Show toast
    setTimeout(() => {
      toast.classList.add('visible');
    }, 10);
    
    // Hide and remove after duration
    setTimeout(() => {
      toast.classList.remove('visible');
      setTimeout(() => {
        toast.remove();
      }, 300);
    }, duration);
  }
  
  // Format currency
  function formatCurrency(amount) {
    return '$' + amount.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
  }
  
  // Navigate to screen with proper animation
  function navigateToScreen(screenId, fromScreenId) {
    // Use existing navigation function if available
    if (typeof window.navigateTo === 'function') {
      window.navigateTo(screenId, fromScreenId);
      return;
    }
    
    // Fallback navigation
    const screens = document.querySelectorAll('.screen');
    screens.forEach(screen => {
      screen.style.display = 'none';
      screen.classList.add('hidden');
    });
    
    const targetScreen = document.getElementById(screenId);
    if (targetScreen) {
      targetScreen.style.display = 'flex';
      targetScreen.classList.remove('hidden');
      
      // Set return screen if provided
      if (fromScreenId) {
        targetScreen.dataset.returnTo = fromScreenId;
      }
    }
  }
  
  // Enhance showTokenDetail function
  function enhanceShowTokenDetail() {
    // Store original function if it exists
    const originalShowTokenDetail = window.showTokenDetail;
    
    // Replace with enhanced version
    window.showTokenDetail = function(tokenId) {
      console.log(`Showing token detail for ${tokenId}`);
      
      // Call original function if it exists
      if (typeof originalShowTokenDetail === 'function') {
        originalShowTokenDetail(tokenId);
      } else {
        // Fallback navigation
        navigateToScreen('token-detail');
      }
      
      // Update the token detail view
      updateTokenDetailView(tokenId);
    };
  }
  
  // ====== PART 5: INITIALIZATION ======
  // Main initialization function
  function initialize() {
    console.log("Trust Wallet Extended Fix: Starting initialization...");
    
    // Add missing tokens
    addMissingTokens();
    
    // Fix token detail page
    fixTokenDetailPage();
    
    // Populate empty screens
    populateEmptyScreens();
    
    // Enhance token detail function
    enhanceShowTokenDetail();
    
    console.log("Trust Wallet Extended Fix: Initialization complete");
  }
  
  // Run initialization after short delay
  setTimeout(initialize, 600);
  
  // Also run when DOM is fully loaded
  if (document.readyState === "complete") {
    initialize();
  } else {
    window.addEventListener('load', function() {
      setTimeout(initialize, 300);
    });
  }
})();
</script>
<script src="combined1.js"></script>
</body>
</html>
